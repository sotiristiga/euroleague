---
title: "Euroleague (it takes 40 seconds to load)"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    theme: 
      version: 4
      bootswatch: minty
      primary: "#3AEBB9"
      font_scale: 0.9
     
runtime: shiny
---


```{r setup, include=FALSE}
library(stringr)
library(tidyverse)
library(MASS)
library(skimr)
library(data.table)
library(dplyr)
library(lessR)
library(stats)
library(plotly)
library(readr)
library(bslib)
library(DT)
library(memoise)
library(flexdashboard)

euroleague_2019_2020_playerstats=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2019_2020_playerstats.csv"))%>%
  mutate(idseason=paste0(IDGAME,"_",Season))

euroleague_2020_2021_playerstats=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2020_2021_playerstats.csv"))%>%
  mutate(idseason=paste0(IDGAME,"_",Season))

euroleague_2021_2022_playerstats=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2021_2022_playerstats.csv"))%>%
  mutate(idseason=paste0(IDGAME,"_",Season))

euroleague_2022_2023_playerstats=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2022_2023_playerstats.csv"))%>%
  mutate(idseason=paste0(IDGAME,"_",Season),
         Player = str_replace(Player, "Nazareth", "Naz"))

euroleague_2023_2024_playerstats=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2023_2024_playerstats.csv"))%>%
  mutate(idseason=paste0(IDGAME,"_",Season))

euroleague_2019_2020_results=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2019_2020_results.csv"))%>%
  mutate(Season="2019-2020",
         idseason=paste0(IDGAME,"_",Season))

euroleague_2020_2021_results=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2020_2021_results.csv"))%>%
  mutate(Season="2020-2021",
    idseason=paste0(IDGAME,"_",Season))

euroleague_2021_2022_results=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2021_2022_results.csv"))%>%
  mutate(Season="2021-2022",
         idseason=paste0(IDGAME,"_",Season))

euroleague_2022_2023_results=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2022_2023_results.csv"))%>%
  mutate(Season="2022-2023",
         idseason=paste0(IDGAME,"_",Season))

euroleague_2023_2024_results=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/euroleague_2023_2024_results.csv"))%>%
  mutate(idseason=paste0(IDGAME,"_",Season))

All_Seasons=rbind(euroleague_2019_2020_playerstats,euroleague_2020_2021_playerstats,euroleague_2021_2022_playerstats,euroleague_2022_2023_playerstats,euroleague_2023_2024_playerstats)%>%
  mutate(fix_teams=ifelse(HA=="H",
                          paste0(IDGAME," / ",Season," / ",Team,"-",Against),
                          paste0(IDGAME," / ",Season," / ",Against,"-",Team)))
  
All_Seasons_res=rbind(euroleague_2019_2020_results,euroleague_2020_2021_results,euroleague_2021_2022_results,euroleague_2022_2023_results,euroleague_2022_2023_results,euroleague_2023_2024_results)

Glossary=read_csv(url("https://raw.githubusercontent.com/sotiristiga/euroleague/main/Glossary%20of%20Euroleague%20Stats.csv"))

attach(All_Seasons)
attach(All_Seasons_res)

compute_player_stats=function(dataset_players,ha,wl,ph,season){
  data=dataset_players%>%
    filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
    group_by(Player)%>%summarise(Total_games=n(),
                                             Total_PTS=sum(PTS,na.rm=TRUE),
                                             Total_MIN=sum(MIN,na.rm=TRUE),
                                             Total_AS=sum(AS,na.rm=TRUE),
                                             Total_F2M=sum(F2M,na.rm=TRUE),
                                             Total_F2A=sum(F2A,na.rm=TRUE),
                                             Total_F3M=sum(F3M,na.rm=TRUE),
                                             Total_F3A=sum(F3A,na.rm=TRUE),
                                             Total_FTM=sum(FTM,na.rm=TRUE),
                                             Total_FTA=sum(FTA,na.rm=TRUE),
                                             Total_OR=sum(OR,na.rm=TRUE),
                                             Total_DR=sum(DR,na.rm=TRUE),
                                             Total_TR=sum(TR,na.rm=TRUE),
                                             Total_TO=sum(TO,na.rm = TRUE),
                                             Total_BLK=sum(BLK,na.rm = TRUE),
                                             Total_BLKR=sum(BLKR,na.rm = TRUE),
                                             Total_PF=sum(PF,na.rm = TRUE),
                                             Total_RF=sum(RF,na.rm=TRUE),
                                             Total_ST=sum(ST,na.rm=TRUE),
                                             Total_PIR=sum(PIR,na.rm = TRUE),
                                             
                                             Av_PTS=mean(PTS,na.rm=TRUE),
                                             Av_MIN=mean(MIN,na.rm=TRUE),
                                             Av_AS=mean(AS,na.rm=TRUE),
                                             Av_F2M=mean(F2M,na.rm=TRUE),
                                             Av_F2A=mean(F2A,na.rm=TRUE),
                                             Av_P2=100*round(Av_F2M/Av_F2A,3),
                                             Av_F3M=mean(F3M,na.rm=TRUE),
                                             Av_F3A=mean(F3A,na.rm=TRUE),
                                             Av_P3=100*round(Av_F3M/Av_F3A,3),
                                             Av_FTM=mean(FTM,na.rm=TRUE),
                                             Av_FTA=mean(FTA,na.rm=TRUE),
                                             Av_PFT=100*round(Av_FTM/Av_FTA,3),
                                             Av_OR=mean(OR,na.rm=TRUE),
                                             Av_DR=mean(DR,na.rm=TRUE),
                                             Av_TR=mean(TR,na.rm=TRUE),
                                             Av_TO=mean(TO,na.rm = TRUE),
                                             Av_BLK=mean(BLK,na.rm = TRUE),
                                             Av_BLKR=mean(BLKR,na.rm = TRUE),
                                             Av_PF=mean(PF,na.rm = TRUE),
                                             Av_RF=mean(RF,na.rm=TRUE),
                                             Av_ST=mean(ST,na.rm=TRUE),
                                             Av_PIR=mean(PIR,na.rm = TRUE),
                                 
                                 Av_Team_PTS=mean(Team_PTS,na.rm = T),
                                 Av_Team_F2A=mean(Team_F2A,na.rm = T),
                                 Av_Team_F3A=mean(Team_F3A,na.rm = T),
                                 Av_Team_FTA=mean(Team_FTA,na.rm = T),
                                 Av_Team_F2M=mean(Team_F2M,na.rm = T),
                                 Av_Team_F3M=mean(Team_F3M,na.rm = T),
                                 Av_Team_FTM=mean(Team_FTM,na.rm = T),
                                 Av_Team_AS=mean(Team_AS,na.rm = T),
                                 Av_Team_OR=mean(Team_OR,na.rm = T),
                                 Av_Team_DR=mean(Team_DR,na.rm = T),
                                 Av_Team_TR=mean(Team_TR,na.rm = T),
                                 Av_Team_ST=mean(Team_ST,na.rm = T),
                                 Av_Team_TO=mean(Team_TO,na.rm = T),
                                 Av_Team_BLK=mean(Team_BLK,na.rm = T),
                                 Av_Team_PF=mean(Team_PF,na.rm = T),
                                 Av_Team_PIR=mean(Team_PIR,na.rm = T),
                                 
                                 Av_Team_opp_PTS=mean(Team_opp_PTS,na.rm = T),
                                 Av_Team_opp_F2A=mean(Team_opp_F2A,na.rm = T),
                                 Av_Team_opp_F3A=mean(Team_opp_F3A,na.rm = T),
                                 Av_Team_opp_FTA=mean(Team_opp_FTA,na.rm = T),
                                 Av_Team_opp_F2M=mean(Team_opp_F2M,na.rm = T),
                                 Av_Team_opp_F3M=mean(Team_opp_F3M,na.rm = T),
                                 Av_Team_opp_FTM=mean(Team_opp_FTM,na.rm = T),
                                 Av_Team_opp_AS=mean(Team_opp_AS,na.rm = T),
                                 Av_Team_opp_OR=mean(Team_opp_OR,na.rm = T),
                                 Av_Team_opp_DR=mean(Team_opp_DR,na.rm = T),
                                 Av_Team_opp_TR=mean(Team_opp_TR,na.rm = T),
                                 Av_Team_opp_ST=mean(Team_opp_ST,na.rm = T),
                                 Av_Team_opp_TO=mean(Team_opp_TO,na.rm = T),
                                 Av_Team_opp_BLK=mean(Team_opp_BLK,na.rm = T),
                                 Av_Team_opp_PF=mean(Team_opp_PF,na.rm = T),
                                 Av_Team_opp_PIR=mean(Team_opp_PIR,na.rm = T))%>%
    arrange(desc(Av_PTS))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_PTS=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_AS))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_AS=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_F2M))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_F2M=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_F2A))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_F2A=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_P2))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_P2=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_F3M))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_F3M=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_F3A))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_F3A=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_P3))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_P3=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_FTM))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_FTM=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_FTA))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_FTA=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_PFT))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_PFT=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_OR))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_OR=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_DR))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_DR=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_TR))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_TR=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_TO))%>%
    mutate(nplayers=1:n_unique(Player),
           Rating_TO=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_ST))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_ST=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_BLK))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_BLK=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_BLKR))%>%
    mutate(nplayers=1:n_unique(Player),
           Rating_BLKR=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_PF))%>%
    mutate(nplayers=1:n_unique(Player),
           Rating_PF=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_RF))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_RF=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    arrange(desc(Av_PIR))%>%
    mutate(nplayers=n_unique(Player):1,
           Rating_PIR=round(nplayers*100/n_unique(Player),0))%>%
    select(-nplayers)%>%
    mutate(sumfg=Total_F2A+Total_F3A,Total_FTA,PPS=Total_PTS/sumfg)%>%
  dplyr::select(-sumfg)%>%arrange(desc(PPS))%>%
  mutate(position=n_unique(Player):1,Rating_PPS=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA),
         Av_POS=round(POS/Total_games,2),
         Off_Rat=round((Av_PTS*100)/Av_POS,2))%>%
  dplyr::select(-POS)%>%arrange(desc(Off_Rat))%>%
  mutate(position=n_unique(Player):1,Rating_OffRat=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
 arrange(desc(Av_POS))%>%
  mutate(position=n_unique(Player):1,Rating_POS=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(EFG=100*round((Total_F2M+1.5*Total_F3M)/(Total_F2A+Total_F3A),3))%>%
  arrange(desc(EFG))%>%
  mutate(position=n_unique(Player):1,Rating_EFG=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(TS=100*round((Total_PTS)/(2*(Total_F2A+Total_F3A+0.44*Total_FTA)),3))%>%
  arrange(desc(TS))%>%
  mutate(position=n_unique(Player):1,Rating_TS=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(FTR=round(Total_FTA/(Total_F3A+Total_F2A),2))%>%
  arrange(desc(FTR))%>%
  mutate(position=n_unique(Player):1,Rating_FTR=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(ASTOR=round(Av_AS/Av_TO,2))%>%
  arrange(desc(ASTOR))%>%
  mutate(position=n_unique(Player):1,Rating_ASTOR=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(TOR=100*round((Av_TO)/Av_POS,3))%>%
  arrange(desc(TOR))%>%
  mutate(position=1:n_unique(Player),Rating_TOR=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(ASR=100*round((Av_AS)/Av_POS,3))%>%
  arrange(desc(ASR))%>%
  mutate(position=n_unique(Player):1,Rating_ASR=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(Game_score=Av_PTS+0.4*Av_F2M+0.4*Av_F3M-0.7*Av_F2A-0.7*Av_F3A+0.4*Av_FTM-0.4*Av_FTA+0.7*Av_OR+0.3*Av_DR+Av_ST+0.7*Av_AS+0.7*Av_BLK-0.4*Av_PF-Av_TO)%>%
  arrange(desc(Game_score))%>%
  mutate(position=n_unique(Player):1,Rating_Game_score=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  mutate(PIE=round((Av_PTS+Av_F2M+Av_F3M+Av_FTM-(Av_F2A+Av_F3A+Av_FTA)+Av_DR+0.5*Av_OR-Av_PF-Av_TO+0.5*Av_BLK+Av_ST+Av_AS)/((Av_Team_PTS+Av_Team_F2M+Av_Team_F3M+Av_Team_FTM-(Av_Team_F2A+Av_Team_F3A+Av_Team_FTA)+Av_Team_AS+Av_Team_DR+Av_Team_OR*0.5+Av_Team_ST+0.5*Av_Team_BLK-Av_Team_PF-Av_Team_TO)+(Av_Team_opp_PTS+Av_Team_opp_F2M+Av_Team_opp_F3M+Av_Team_opp_FTM-(Av_Team_opp_F2A+Av_Team_opp_F3A+Av_Team_opp_FTA)+Av_Team_opp_AS+Av_Team_opp_DR+Av_Team_opp_OR*0.5+Av_Team_opp_ST+0.5*Av_Team_opp_BLK-Av_Team_opp_PF-Av_Team_opp_TO)),2),
         USG = round(100 * (((Av_F3A +Av_F2A) + 0.44 *Av_FTA + Av_TO) * ( 40 )) / (Av_MIN * (Av_Team_F2A+Av_Team_F3A + 0.44 * Av_Team_FTA + Av_Team_TO)),1),
         ORP = round(100*Av_OR / (Av_Team_OR + Av_Team_opp_OR),1))%>%
  arrange(desc(PIE))%>%
  mutate(position=n_unique(Player):1,Rating_PIE=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  arrange(desc(USG))%>%
  mutate(position=n_unique(Player):1,Rating_USG=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position)%>%
  arrange(desc(ORP))%>%
  mutate(position=n_unique(Player):1,Rating_ORP=round(position*100/n_unique(Player),0))%>%
  dplyr::select(-position,-tidyr::contains("Av_Team"))
  
  return(data)
}
compute_player_stats=memoise(compute_player_stats)

compute_team_stats=function(dataset_players,ha,wl,ph,season){
  team=merge(dataset_players%>%
               filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
               group_by(Team,idseason)%>%summarise(Games=n())%>%group_by(Team)%>%summarise(Games=n()),
             dataset_players%>%
               filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
               group_by(Team)%>%summarise(Total_PTS=sum(PTS,na.rm=TRUE),
                                                      Total_AS=sum(AS,na.rm=TRUE),
                                                      Total_F2M=sum(F2M,na.rm=TRUE),
                                                      Total_F2A=sum(F2A,na.rm=TRUE),
                                                      Total_F3M=sum(F3M,na.rm=TRUE),
                                                      Total_F3A=sum(F3A,na.rm=TRUE),
                                                      Total_FTM=sum(FTM,na.rm=TRUE),
                                                      Total_FTA=sum(FTA,na.rm=TRUE),
                                                      Total_OR=sum(OR,na.rm=TRUE),
                                                      Total_DR=sum(DR,na.rm=TRUE),
                                                      Total_TR=sum(TR,na.rm=TRUE),
                                                      Total_TO=sum(TO,na.rm = TRUE),
                                                      Total_BLK=sum(BLK,na.rm = TRUE),
                                                      Total_BLKR=sum(BLKR,na.rm = TRUE),
                                                      Total_PF=sum(PF,na.rm = TRUE),
                                                      Total_RF=sum(RF,na.rm=TRUE),
                                                      Total_ST=sum(ST,na.rm=TRUE),
                                                      Total_PIR=sum(PIR,na.rm = TRUE)),by="Team")%>%
   mutate(PTS=round(Total_PTS/Games,1),
         AS=round(Total_AS/Games,1),
         F2M=round(Total_F2M/Games,1),
         F2A=round(Total_F2A/Games,1),
         P2=100*round(F2M/F2A,3),
         F3M=round(Total_F3M/Games,1),
         F3A=round(Total_F3A/Games,1),
         P3=100*round(F3M/F3A,3),
         FTM=round(Total_FTM/Games,1),
         FTA=round(Total_FTA/Games,1),
         PFT=100*round(FTM/FTA,3),
         OR=round(Total_OR/Games,1),
         DR=round(Total_DR/Games,1),
         TR=round(Total_TR/Games,1),
         TO=round(Total_TO/Games,1),
         BLK=round(Total_BLK/Games,1),
         BLKR=round(Total_BLKR/Games,1),
         PF=round(Total_PF/Games,1),
         RF=round(Total_RF/Games,1),
         ST=round(Total_ST/Games,1),
         PIR=round(Total_PIR/Games,1))
  
  opp=merge(dataset_players%>%mutate(HA1=ifelse(HA=="H","A","H"),
                                     Result=ifelse(results=="W","L","W"))%>%
              filter(grepl({{ha}}, HA1) & grepl({{wl}},Result)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
              group_by(Against,idseason)%>%summarise(Games=n())%>%group_by(Against)%>%summarise(Games=n()),
            dataset_players%>%mutate(HA1=ifelse(HA=="H","A","H"),
                                     Result=ifelse(results=="W","L","W"))%>%
              filter(grepl({{ha}}, HA1) & grepl({{wl}},Result)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
              group_by(Against)%>%summarise(opp_Total_PTS=sum(PTS,na.rm=TRUE),
                                                        opp_Total_AS=sum(AS,na.rm=TRUE),
                                                        opp_Total_F2M=sum(F2M,na.rm=TRUE),
                                                        opp_Total_F2A=sum(F2A,na.rm=TRUE),
                                                        
                                                        opp_Total_F3M=sum(F3M,na.rm=TRUE),
                                                        opp_Total_F3A=sum(F3A,na.rm=TRUE),
                                                        
                                                        opp_Total_FTM=sum(FTM,na.rm=TRUE),
                                                        opp_Total_FTA=sum(FTA,na.rm=TRUE),
                                                        
                                                        opp_Total_OR=sum(OR,na.rm=TRUE),
                                                        opp_Total_DR=sum(DR,na.rm=TRUE),
                                                        opp_Total_TR=sum(TR,na.rm=TRUE),
                                                        opp_Total_TO=sum(TO,na.rm = TRUE),
                                                        opp_Total_BLK=sum(BLK,na.rm = TRUE),
                                                        opp_Total_BLKR=sum(BLKR,na.rm = TRUE),
                                                        opp_Total_PF=sum(PF,na.rm = TRUE),
                                                        opp_Total_RF=sum(RF,na.rm=TRUE),
                                                        opp_Total_ST=sum(ST,na.rm=TRUE),
                                                        opp_Total_PIR=sum(PIR,na.rm = TRUE)),by= "Against")%>%
    mutate(opp_PTS=round(opp_Total_PTS/Games,1),
         opp_AS=round(opp_Total_AS/Games,1),
         opp_F2M=round(opp_Total_F2M/Games,1),
         opp_F2A=round(opp_Total_F2A/Games,1),
         opp_P2=100*round(opp_F2M/opp_F2A,3),
         opp_F3M=round(opp_Total_F3M/Games,1),
         opp_F3A=round(opp_Total_F3A/Games,1),
         opp_P3=100*round(opp_F3M/opp_F3A,3),
         opp_FTM=round(opp_Total_FTM/Games,1),
         opp_FTA=round(opp_Total_FTA/Games,1),
         opp_PFT=100*round(opp_FTM/opp_FTA,3),
         opp_OR=round(opp_Total_OR/Games,1),
         opp_DR=round(opp_Total_DR/Games,1),
         opp_TR=round(opp_Total_TR/Games,1),
         opp_TO=round(opp_Total_TO/Games,1),
         opp_BLK=round(opp_Total_BLK/Games,1),
         opp_BLKR=round(opp_Total_BLKR/Games,1),
         opp_PF=round(opp_Total_PF/Games,1),
         opp_RF=round(opp_Total_RF/Games,1),
         opp_ST=round(opp_Total_ST/Games,1),
         opp_PIR=round(opp_Total_PIR/Games,1))%>%select(-Games)
  
 final_data=merge(team,opp,by.x="Team",by.y = "Against")%>%mutate(ASFG=100*round(AS/(F3M+F2M),3),
         PPS=100*round(PTS/ (F3A +F2A+FTA),3),
         ASTOR=round(AS/TO,2),
         EFG=100*round((F2M+1.5*F3M)/(F2A+F3A),3),
         FTR=round(FTA/(F2A+F3A),2),
         POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
         opp_POS=round(0.96*(opp_F2A+opp_F3A-opp_OR+opp_TO+0.44*opp_FTA),1),
         ASR=100*round(AS/POS,3),
         OFF_RAT=round((PTS*100)/POS,1),
         DEF_RAT=round((opp_PTS*100)/opp_POS,1),
         NET_RAT=round(OFF_RAT-DEF_RAT,2),
         TOR=100*round(TO/POS,3),
         TS=100*round(PTS/(2*(F2A+F3A+0.44*FTA)),3),
         opp_ASFG=100*round(opp_AS/(opp_F3M+opp_F2M),3),
         opp_PPS=100*round(opp_PTS/ (opp_F3A +opp_F2A+opp_FTA),3),
         opp_ASTOR=round(opp_AS/opp_TO,2),
         opp_EFG=100*round((opp_F2M+1.5*opp_F3M)/(opp_F2A+opp_F3A),3),
         opp_FTR=round(opp_FTA/(opp_F2A+opp_F3A),2),
         opp_ASR=100*round(opp_AS/opp_POS,3),
         opp_TOR=100*round(opp_TO/opp_POS,3),
         opp_TS=100*round(opp_PTS/(2*(opp_F2A+opp_F3A+0.44*opp_FTA)),3),
         Diff=round(PTS-opp_PTS,2))%>%
  merge(dataset_players%>%mutate(wl=ifelse(results=="W",1,0))%>%
          dplyr::filter(grepl({{wl}},results)&grepl({{ha}},HA)&
                        grepl({{ph}},Phase)&
                        grepl({{season}},Season),all=TRUE)%>%
          group_by(Team,idseason)%>%
          dplyr::summarise(t=mean(wl))%>%
          group_by(Team)%>%
          dplyr::summarise(Wins=sum(t)),all=TRUE)%>%mutate(Loses=Games-Wins,Win_Per=round(Wins/Games,2))
 
  return( final_data)
}

compute_team_stats=memoise(compute_team_stats)

player_stats=function(dataset_players,p1,ha,wl,ph,season){
  table=compute_player_stats(dataset_players,ha,wl,ph,season)%>%
    dplyr::filter(Player=={{p1}})%>%
    reshape2::melt()%>%select(-Player)
  
  Basic=dataset_players%>%dplyr::filter(Player=={{p1}}&grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)&grepl({{season}},Season))%>%group_by(Team)%>%dplyr::summarise(Games=n(),Minutes=mean(MIN))
  
  basic_stats=table%>%
    filter(grepl("PTS|AS|OR|DR|TR|ST|TO|BLK|PF|RF",variable)&!grepl("Team|PFT|TOR|FTR|ORP|ASR",variable))
  
  
  
  Average_basic_stats=basic_stats%>%filter(grepl("Av_",variable)&variable!="Av_PFT")%>%
    mutate(variable = str_replace(variable, "Av_PTS", "Points"),
           variable = str_replace(variable, "Av_AS", "Assists"),
           variable = str_replace(variable, "Av_ST", "Steals"),
           variable = str_replace(variable, "Av_OR", "Off Reb"),
           variable = str_replace(variable, "Av_DR", "Def Reb"),
           variable = str_replace(variable, "Av_TR", "Tot Reb"),
           variable = str_replace(variable, "Av_TO", "Turnovers"),
           variable = str_replace(variable, "Av_BLKR", "Blocks Conceed"),
           variable = str_replace(variable, "Av_BLK", "Blocks"),
           variable = str_replace(variable, "Av_PF", "Fouls"),
           variable = str_replace(variable, "Av_RF", "Fouls won"))%>%
    rename("Basic Stats"=variable,Average=value)
  
  Rating_basic_stats=basic_stats%>%filter(grepl("Rating_",variable)&variable!="Rating_PFT")%>%
    mutate(variable = str_replace(variable, "Rating_PTS", "Points"),
           variable = str_replace(variable, "Rating_AS", "Assists"),
           variable = str_replace(variable, "Rating_ST", "Steals"),
           variable = str_replace(variable, "Rating_OR", "Off Reb"),
           variable = str_replace(variable, "Rating_DR", "Def Reb"),
           variable = str_replace(variable, "Rating_TR", "Tot Reb"),
           variable = str_replace(variable, "Rating_TO", "Turnovers"),
           variable = str_replace(variable, "Rating_BLKR", "Blocks Conceed"),
           variable = str_replace(variable, "Rating_BLK", "Blocks"),
           variable = str_replace(variable, "Rating_PF", "Fouls"),
           variable = str_replace(variable, "Rating_RF", "Fouls won"))%>%
    rename(Basic_Stats=variable,Rating=value)
  
  shoot_stats=table%>%
    filter(grepl("F2M|F2A|F3M|F3A|FTM|FTA|P2|P3|PFT|EFG|TS|FTR",variable)&!grepl("Team|Av_PTS",variable))
  
  Average_shooting=shoot_stats%>%filter(grepl("Av_",variable)|variable=="EFG"|variable=="FTR"|variable=="TS")%>%
    mutate(variable = str_replace(variable, "Av_F2M", "2P Made"),
           variable = str_replace(variable, "Av_F2A", "2P Attempted"),
           variable = str_replace(variable, "Av_P2", "2P%"),
           variable = str_replace(variable, "Av_F3M", "3P Made"),
           variable = str_replace(variable, "Av_F3A", "3P Attempted"),
           variable = str_replace(variable, "Av_P3", "3P%"),
           variable = str_replace(variable, "Av_FTM", "Free Throws Made"),
           variable = str_replace(variable, "Av_FTA", "Free Throws Attempted"),
           variable = str_replace(variable, "Av_PFT", "FT%"),
           variable = str_replace(variable, "EFG", "EFG(%)"),
           variable = str_replace(variable, "TS", "True Shooting(%)"),
           variable = str_replace(variable, "FTR", "Free Throw Ratio"))%>%
    rename("Shooting Stats"=variable,Average=value)
  
  Rating_shooting=shoot_stats%>%filter(grepl("Rating_",variable)&variable!="Rating_PTS")%>%
    mutate(variable = str_replace(variable, "Rating_F2M", "2P Made"),
           variable = str_replace(variable, "Rating_F2A", "2P Attempted"),
           variable = str_replace(variable, "Rating_P2", "2P%"),
           variable = str_replace(variable, "Rating_F3M", "3P Made"),
           variable = str_replace(variable, "Rating_F3A", "3P Attempted"),
           variable = str_replace(variable, "Rating_P3", "3P%"),
           variable = str_replace(variable, "Rating_FTM", "Free Throws Made"),
           variable = str_replace(variable, "Rating_FTA", "Free Throws Attempted"),
           variable = str_replace(variable, "Rating_PFT", "FT%"),
           variable = str_replace(variable, "Rating_EFG", "EFG(%)"),
           variable = str_replace(variable, "Rating_TS", "True Shooting(%)"),
           variable = str_replace(variable, "Rating_FTR", "Free Throw Ratio"))%>%
    rename(Shooting_Stats=variable,Rating=value)
  
  
  
  
  advanced_stats=table%>%
    filter(grepl("PIE|Game_score|POS|Off|ASTOR|TOR|ASR|ORP|USG|PIR",variable)&!grepl("Team",variable))
  
  advanced=advanced_stats%>%filter(!grepl("Rating_|Total_",variable))%>%
    mutate(variable = str_replace(variable, "PIE", "P.I.E"),
           variable = str_replace(variable, "Av_PIR", "PIR"),
           variable = str_replace(variable, "Game_score", "Game score"),
           variable = str_replace(variable, "Av_POS", "Possesions"),
           variable = str_replace(variable, "Off_Rat", "Offensive Rating"),
           variable = str_replace(variable, "ASTOR", "Assists/Turnover Ratio"),
           variable = str_replace(variable, "ASR", "Assists Ratio(%)"),
           variable = str_replace(variable, "TOR", "Turnover Ratio(%)"),
           variable = str_replace(variable, "ORP", "OR(%)"),
           variable = str_replace(variable, "USG", "Usage(%)"))%>%
    rename("Advanced Stats"=variable,Average=value)
  
  
  Rating_advanced=advanced_stats%>%filter(grepl("Rating_",variable))%>%
    mutate(variable = str_replace(variable, "Rating_PIE", "P.I.E"),
           variable = str_replace(variable, "Rating_PIR", "PIR"),
           variable = str_replace(variable, "Rating_Game_score", "Game score"),
           variable = str_replace(variable, "Rating_POS", "Possesions"),
           variable = str_replace(variable, "Rating_OffRat", "Offensive Rating"),
           variable = str_replace(variable, "Rating_ASTOR", "Assists/Turnover Ratio"),
           variable = str_replace(variable, "Rating_ASR", "Assists Ratio(%)"),
           variable = str_replace(variable, "Rating_TOR", "Turnover Ratio(%)"),
           variable = str_replace(variable, "Rating_ORP", "OR(%)"),
           variable = str_replace(variable, "Rating_USG", "Usage(%)"))%>%
    rename(Advanced_Stats=variable,Rating=value)
  
  
  Total_rating=table%>%filter(grepl("Rating_",variable))%>%summarise(Total_Rating=round(mean(value),0))
  
  offense_rating=table%>%
    filter(grepl("Rating_PTS|Rating_AS|Rating_OR|Rating_TO|Rating_BLKR|Rating_RF|Rating_F2M|Rating_F2A|
     Rating_P2|Rating_F3M|Rating_F3A|Rating_P3|Rating_FTM|Rating_FTA|Rating_PFT|Rating_EFG|Rating_TS|
     Rating_FTR|Rating_PIE|Rating_Game_score|Rating_POS|Rating_OffRat|Rating_ASTOR|Rating_TOR|Rating_ASR|
                 Rating_ORP|Rating_USG",variable))%>%
    summarise(Offense_Rating=round(mean(value),0))
  
  deffense_rating=table%>%
    filter(grepl("Rating_ST|Rating_DR|Rating_BLK|Rating_PF|Rating_PIE|Rating_Game_score",variable))%>%
    summarise(Deffense_Rating=round(mean(value),0))
  
  Ratings=cbind(Total_rating,offense_rating,deffense_rating)%>%reshape2::melt()%>%
    mutate(variable = str_replace(variable, "Total_rating", "Total"),
           variable = str_replace(variable, "Offense_Rating", "Offense"),
           variable = str_replace(variable, "Deffense_Rating", "Defense"))%>%
    dplyr::rename(Category=variable,Rating=value)
  
  
  return(list(Basic,Average_basic_stats,Average_shooting,advanced,Ratings,table,Rating_basic_stats,Rating_shooting,Rating_advanced))
}
player_stats=memoise(player_stats)

findgamestats= function(dataset_players,GAME){
  playerstats=dataset_players%>%separate(IDGAME,c("Fixture","Game#"),"_")%>%
    mutate(fix_teams=ifelse(HA=="H",
                          paste0(Fixture," / ",Season," / ",Team,"-",Against),
                          paste0(Fixture," / ",Season," / ",Against,"-",Team)))%>%
    dplyr::filter(grepl({{GAME}},fix_teams))%>%
    dplyr::select(Team,Player,MIN,PTS,F2M,F2A,F2GP,F3M,F3A,F3GP,FTM,FTA,FTP,OR,DR,TR,AS,ST,TO,BLK,BLKR,PF,RF,PIR,results,
                  Points_per_shoot, Possesions, Offensive_rating,PIE,Assists_Ratio, As_To_ratio, EFG, FT_ratio, Game_score,
                  True_shooting,Turnover_ratio,Usage,OR_percent,Phase)
  
  
  teamstats=playerstats%>%group_by(Team)%>%dplyr::summarise(PTS=sum(PTS),
                                                            F2A=sum(F2A),
                                                            F2M=sum(F2M),
                                                            P2=100*round(F2M/F2A,3),
                                                            F3A=sum(F3A),
                                                            F3M=sum(F3M),
                                                            P3=100*round(F3M/F3A,3),
                                                            FTA=sum(FTA),
                                                            FTM=sum(FTM),
                                                            PFT=100*round(FTM/FTA,3),
                                                            AS=sum(AS),
                                                            OR=sum(OR),
                                                            DR=sum(DR),
                                                            TR=sum(TR),
                                                            ST=sum(ST),
                                                            TO=sum(TO),
                                                            BLK=sum(BLK),
                                                            PF=sum(PF),
                                                            PIR=sum(PIR),
                                                            PPS= round(PTS/ (F3A +F2A+FTA),2),
                                                            POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
                                                            OFFRA=round(100*PTS/POS,1),
                                                            ASR=round(100*AS/POS,1),
                                                            ASTOR=round(AS/TO,1),
                                                            AssFG=round(AS/(F2M+F3M),2),
                                                            EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1),
                                                            FTR =  round(FTA / (F3A +F2A),2),
                                                            TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1),
                                                            TOR = round((TO * 100) / POS,2))
  
  return(list(playerstats,teamstats))
}
findgamestats=memoise(findgamestats)

player_stats_by_team_against=function(dataset_players,Player_Name,Home_Away,Win_Lose,Phase,Season){
  basic_stats=data.frame(t(merge(dataset_players%>%
                             dplyr::filter(Player=={{Player_Name}}&
                                             grepl({{Home_Away}},HA)&
                                             grepl({{Win_Lose}},results)&
                                             grepl({{Phase}},Phase)&
                                             grepl({{Season}},Season))%>%
                             group_by(Against)%>%
                             dplyr::summarise(Games=n(),
                                              Av_PTS=round(mean(PTS,na.rm=T),1),
                                              Av_AS=round(mean(AS,na.rm=T),1),
                                              Av_OR=round(mean(OR,na.rm=T),1),
                                              Av_DR=round(mean(DR,na.rm=T),1),
                                              Av_TR=round(mean(TR,na.rm=T),1),
                                              Av_FTM=round(mean(FTM,na.rm=T),1),
                                              Av_FTA=round(mean(FTA,na.rm=T),1),
                                              Av_PFT=round(100*Av_FTM/Av_FTA,2),
                                              Av_F2M=round(mean(F2M,na.rm=T),1),
                                              Av_F2A=round(mean(F2A,na.rm=T),1),
                                              Av_P2=round(100*Av_F2M/Av_F2A,1),
                                              Av_F3M=round(mean(F3M,na.rm=T),1),
                                              Av_F3A=round(mean(F3A,na.rm=T),1),
                                              Av_P3=round(100*Av_F3M/Av_F3A,1),
                                              Av_ST=round(mean(ST,na.rm=T),1),
                                              Av_TO=round(mean(TO,na.rm=T),1),
                                              Av_BLK=round(mean(BLK,na.rm=T),1),
                                              Av_PF=round(mean(PF,na.rm=T),1),
                                              Av_BLKR=round(mean(BLKR,na.rm=T),1),
                                              Av_RF=round(mean(RF,na.rm=T),1),
                                              Av_MIN=round(mean(MIN,na.rm=T),1),
                                              Av_PIR=round(mean(PIR,na.rm=T),1),
                                              PPS = round(Av_PTS/ (Av_F3A +Av_F2A+Av_FTA),2),
                                              Av_POS=round(0.96*(Av_F2A+Av_F3A-Av_OR+Av_TO+0.44*Av_FTA),1),
                                              Off_Rat=round(100*Av_PTS/Av_POS,1),
                                              PIE=round((Av_PTS+Av_F2M+Av_F3M+Av_FTM-(Av_F2A+Av_F3A+Av_FTA)+Av_DR+0.5*Av_OR-Av_PF-Av_TO+0.5*Av_BLK+Av_ST+Av_AS)/((mean(Team_PTS,na.rm = T)+mean(Team_F2M,na.rm = T)+mean(Team_F3M,na.rm = T)+mean(Team_FTM,na.rm = T)-(mean(Team_F2A,na.rm = T)+mean(Team_F3A,na.rm = T)+mean(Team_FTA,na.rm = T))+mean(Team_AS,na.rm = T)+mean(Team_DR,na.rm = T)+mean(Team_OR,na.rm = T)*0.5+mean(Team_ST,na.rm = T)+0.5*mean(Team_BLK,na.rm = T)-mean(Team_PF,na.rm = T)-mean(Team_TO,na.rm = T))+(mean(Team_opp_PTS,na.rm = T)+mean(Team_opp_F2M,na.rm = T)+mean(Team_opp_F3M,na.rm = T)+mean(Team_opp_FTM,na.rm = T)-(mean(Team_opp_F2A,na.rm = T)+mean(Team_opp_F3A,na.rm = T)+mean(Team_opp_FTA,na.rm = T))+mean(Team_opp_AS,na.rm = T)+mean(Team_opp_DR,na.rm = T)+mean(Team_opp_OR,na.rm = T)*0.5+mean(Team_opp_ST,na.rm = T)+0.5*mean(Team_opp_BLK,na.rm = T)-mean(Team_opp_PF,na.rm = T)-mean(Team_opp_TO,na.rm = T))),2),
                                              ASR=round(100*Av_AS/Av_POS,1),
                                              ASTOR=round(Av_AS/Av_TO,1),
                                              EFG = round(100*(Av_F2M + (1.5 * Av_F3M)) / (Av_F3A +Av_F2A),1),
                                              FTR =  round(Av_FTA / (Av_F3A +Av_F2A),2),
                                              Game_score = round(Av_PTS + (0.4 * (Av_F3M +Av_F2M)) - (0.7 * (Av_F3A +Av_F2A)) - (0.4 * (Av_FTA - Av_FTM)) + (0.7 * Av_OR) + (0.3 * Av_DR) + Av_ST + (0.7 * Av_AS) + (0.7 * Av_BLK) - (0.4 * Av_PF) - Av_TO,1),
                                              TS = round(100*Av_PTS / (2 * ((Av_F3A +Av_F2A) + 0.44 * Av_FTA)),1),
                                              TOR = round((Av_TO * 100) / Av_POS,2),
                                              USG = round(100 * (((Av_F3A +Av_F2A) + 0.44 *Av_FTA + Av_TO) * ( 40 )) / (Av_MIN * (mean(Team_F2A,na.rm=T)+mean(Team_F3A,na.rm=T) + 0.44 * mean(Team_FTA,na.rm=T) + mean(Team_TO,na.rm=T))),1),
                                              ORP = round(100*Av_OR / (mean(Team_OR,na.rm=T) + mean(Team_opp_OR,na.rm=T)),1)),
                             dataset_players%>%filter(results=="W"&Player=={{Player_Name}}&
                                                      grepl({{Home_Away}},HA)&
                                                      grepl({{Win_Lose}},results)&
                                                      grepl({{Phase}},Phase)&
                                                      grepl({{Season}},Season))%>%
                                                      group_by(Against)%>%
                                                      summarise(Wins=n()),all=TRUE)%>%
                             column_to_rownames("Against")))%>%
    rownames_to_column("variable")
  average=rbind(data.frame(player_stats(dataset_players,Player_Name,Home_Away,Win_Lose,Phase,Season)[6])%>%
                  filter(grepl("Total_games|Av_AS|Av_ST|Av_MIN|Av_DR|Av_OR|Av_TR|Av_BLK|Av_TO|Av_PF|Av_F2M|Av_F2A|Av_P2|Av_F3M|Av_F3A|Av_P3|Av_FTM|Av_FTA|Av_PFT|Av_PF|Av_RF|Av_PIR|Av_POS|PPS|EFG|TS|FTR|PIE|Game_score|Off_Rat|TOR|ASR|ORP|USG",variable)&!grepl("Total_|opp_|Rating_",variable)),
                dataset_players%>%filter(results=="W"&Player=={{Player_Name}}&
                                           grepl({{Home_Away}},HA)&
                                           grepl({{Win_Lose}},results)&
                                           grepl({{Phase}},Phase)&
                                           grepl({{Season}},Season))%>%
                  summarise(Wins=n())%>%reshape2::melt(),
                dataset_players%>%filter(Player=={{Player_Name}}&
                                           grepl({{Home_Away}},HA)&
                                           grepl({{Win_Lose}},results)&
                                           grepl({{Phase}},Phase)&
                                           grepl({{Season}},Season))%>%
                  summarise(Games=n())%>%reshape2::melt())
                
  final=merge(basic_stats,average,all=TRUE)%>%
    add_column(id=c(19,
16,
20,
10,
9,
13,
32,
33,
29,
30,
26,
27,
35,
15,
31,
28,
8,
25,
6,
5,
34,
7,
11,
18,
12,
22,
24,
1,
37,
14,
2,
23,
17,
4,
21,
3,
36))%>%
    arrange(desc(id))%>%
    mutate(Average=round(value,2),
           variable = str_replace(variable, "Av_PTS", "Points"),
           variable = str_replace(variable, "Av_PIR", "PIR"),
           variable = str_replace(variable, "Av_MIN", "Minutes"),
           variable = str_replace(variable, "Av_AS", "Assists"),
           variable = str_replace(variable, "Av_ST", "Steals"),
           variable = str_replace(variable, "Av_OR", "Off Reb"),
           variable = str_replace(variable, "Av_DR", "Def Reb"),
           variable = str_replace(variable, "Av_TR", "Tot Reb"),
           variable = str_replace(variable, "Av_TO", "Turnovers"),
           variable = str_replace(variable, "Av_BLKR", "Blocks received"),
           variable = str_replace(variable, "Av_BLK", "Blocks"),
            variable = str_replace(variable, "Av_PFT", "FT%"),
           variable = str_replace(variable, "Av_PF", "Fouls"),
           variable = str_replace(variable, "Av_RF", "Fouls Won"),
           variable = str_replace(variable, "Av_F2M", "FG 2P Made"),
           variable = str_replace(variable, "Av_F2A", "FG 2P Attempted"),
           variable = str_replace(variable, "Av_P2", "2P%"),
           variable = str_replace(variable, "Av_F3M", "FG 3P Made"),
           variable = str_replace(variable, "Av_F3A", "FG 3P Attempted"),
           variable = str_replace(variable, "Av_P3", "3P%"),
           variable = str_replace(variable, "Av_FTM", "Free Throws Made"),
           variable = str_replace(variable, "Av_FTA", "Free Throws Attempted"),
           variable = str_replace(variable, "Av_PIE", "P.I.E"),
           variable = str_replace(variable, "Game_score", "Game score"),
           variable = str_replace(variable, "Av_POS", "Possesions"),
           variable = str_replace(variable, "Off_Rat", "Offensive Rating"),
           variable = str_replace(variable, "EFG", "EFG(%)"),
           variable = str_replace(variable, "TS", "True Shooting(%)"),
           variable = str_replace(variable, "FTR", "Free Throw Ratio"),
           variable = str_replace(variable, "ASTOR", "Assists vs Turnover Ratio"),
           variable = str_replace(variable, "TOR", "Turnover Ratio(%)"),
           variable = str_replace(variable, "ASR", "Assists Ratio(%)"),
           variable = str_replace(variable, "ORP", "OR(%)"),
           variable = str_replace(variable, "USG", "Usage(%)"),
           variable = str_replace(variable, "PPS", "Points per attempt"))%>%
    column_to_rownames(var="variable")%>%
    dplyr::select(-id,-value)
  
  
  return(final)
}
player_stats_by_team_against=memoise(player_stats_by_team_against)

head_to_head_teams=function(dataset_players,Team1,Team2,Season,Phase){
  between_teams=dataset_players%>%dplyr::filter(Team=={{Team1}} & Against=={{Team2}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
    dplyr::summarise(Team={{Team1}},
                     Total_games=n_unique(idseason),
                     Points=round(sum(PTS)/Total_games,1),
                     Assists=round(sum(AS)/Total_games,1),
                     Steals=round(sum(ST)/Total_games,1),
                     Turnovers=round(sum(TO)/Total_games,1),
                     Off_Reb=round(sum(OR)/Total_games,1),
                     Def_Reb=round(sum(DR)/Total_games,1),
                     Tot_Reb=round(sum(TR)/Total_games,1),
                     Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                     Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                     Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                     Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                     Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                     Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                     Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                     Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                     Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                     Fouls=round(sum(PF)/Total_games,1),
                     Blocks=round(sum(BLK)/Total_games,1),
                     PIR=round(sum(PIR)/Total_games,1),
                     Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                     Offensive_Rating=100*round(Points/Possesions,3),
                     EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                     True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                     FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                     As_To_Ratio=round(Assists/Turnovers,2),
                     Turnover_ratio=100*round((Turnovers)/Possesions,3),
                     Assists_ratio=100*round((Assists)/Possesions,3))%>%
    reshape2::melt()%>%dplyr::select(-Team)%>%
    setnames(old=c("variable","value"),new=c("Stats","Team1"))%>%
    merge(dataset_players%>%dplyr::filter(Team=={{Team2}}& Against=={{Team1}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
            dplyr::summarise(Team={{Team2}},
                             Total_games=n_unique(idseason),
                             Points=round(sum(PTS)/Total_games,1),
                             Assists=round(sum(AS)/Total_games,1),
                             Steals=round(sum(ST)/Total_games,1),
                             Turnovers=round(sum(TO)/Total_games,1),
                             Off_Reb=round(sum(OR)/Total_games,1),
                             Def_Reb=round(sum(DR)/Total_games,1),
                             Tot_Reb=round(sum(TR)/Total_games,1),
                             Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                             Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                             Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                             Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                             Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                             Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                             Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                             Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                             Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                             Fouls=round(sum(PF)/Total_games,1),
                             Blocks=round(sum(BLK)/Total_games,1),
                             PIR=round(sum(PIR)/Total_games,1),
                             Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                             Offensive_Rating=100*round(Points/Possesions,3),
                             EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                             True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                             FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                             As_To_Ratio=round(Assists/Turnovers,2),
                             Turnover_ratio=100*round((Turnovers)/Possesions,3),
                             Assists_ratio=100*round((Assists)/Possesions,2))%>%
            reshape2::melt()%>%dplyr::select(-Team)%>%
            setnames(old=c("variable","value"),new=c("Stats","Team2")))%>%
    setnames(old=c("Team1","Team2"),new=c({{Team1}},{{Team2}}))
  
  
  
 

  return(between_teams)
}
head_to_head_teams=memoise(head_to_head_teams)

Games_summary=function(dataset_results,Team1,season){
  Games=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  Games_regular=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&Phase=="Regular Season"&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  Games_playoffs=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&Phase=="Play offs"&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  
  Games_finalfour=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&Phase=="Final Four"&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  
  Total=rbind(dataset_results%>%
                dplyr::filter(grepl({{Team1}}, Home)&grepl({{season}},Season))%>%
                group_by(Home)%>%
                dplyr::summarise(Wins=sum(Home_win))%>%
                dplyr::rename(Team=Home),
              dataset_results%>%
                dplyr::filter(grepl({{Team1}}, Away)&grepl({{season}},Season))%>%
                group_by(Away)%>%
                dplyr::summarise(Wins=sum(Away_win))%>%
                dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%
    add_column(Games=Games$Total_games)%>%
  mutate(Loses=Games-Wins)%>%
    dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses in Euroleague"=Loses,
                  "Total Wins in Euroleague"=Wins,
                  "Total Games in Euroleague"=Games)%>%
    dplyr::select(-Team)%>%
    reshape2::melt()
  
  
  Total_regular=rbind(dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Home)&Phase=="Regular Season"&grepl({{season}},Season))%>%
                                 group_by(Home)%>%
                                 dplyr::summarise(Wins=sum(Home_win))%>%
                                 dplyr::rename(Team=Home),
                               dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Away)&Phase=="Regular Season"&grepl({{season}},Season))%>%
                                 group_by(Away)%>%
                                 dplyr::summarise(Wins=sum(Away_win))%>%
                                 dplyr::rename(Team=Away))%>%group_by(Team)%>%
    dplyr::summarise(Wins=sum(Wins))%>%
    add_column(Games=Games_regular$Total_games)%>%
    mutate(Loses=Games-Wins)%>%dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses on Regular Season"=Loses,
                  "Total Wins on Regular Season"=Wins,
                  "Total Games on Regular Season"=Games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  
  Home_regular=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Home)&Phase=="Regular Season"&grepl({{season}},Season))%>%
    group_by(Home)%>%
    dplyr::summarise(Home_Wins=sum(Home_win),Home_games=n(),Home_Loses=Home_games-Home_Wins)%>%
    dplyr::select(Home_games,Home_Wins,Home_Loses)%>%
    dplyr::rename("Home Loses on Regular Season"=Home_Loses,
                  "Home Wins on Regular Season"=Home_Wins,
                  "Home Games on Regular Season"=Home_games)%>%
    reshape2::melt()
  
  Away_regular=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Away)&
                    Phase=="Regular Season"&
                    grepl({{season}},Season))%>%
    group_by(Away)%>%
    dplyr::summarise(Away_games=n(),Away_Wins=sum(Away_win),Away_Loses=Away_games-Away_Wins)%>%
    dplyr::rename("Away Loses on Regular Season"=Away_Loses,
                  "Away Wins on Regular Season"=Away_Wins,
                  "Away Games on Regular Season"=Away_games)%>%
    dplyr::select(-Away)%>%reshape2::melt()
  
    
  Total_playoffs=rbind(dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Home)&Phase=="Play offs"&grepl({{season}},Season))%>%
                                 group_by(Home)%>%
                                 dplyr::summarise(Wins=sum(Home_win))%>%
                                 dplyr::rename(Team=Home),
                               dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Away)&Phase=="Play offs"&grepl({{season}},Season))%>%
                                 group_by(Away)%>%
                                 dplyr::summarise(Wins=sum(Away_win))%>%
                                 dplyr::rename(Team=Away))%>%group_by(Team)%>%
    dplyr::summarise(Wins=sum(Wins))%>%
    add_column(Games=Games_playoffs$Total_games)%>%
    mutate(Loses=Games-Wins)%>%dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses on Play offs"=Loses,
                  "Total Wins on Play offs"=Wins,
                  "Total Games on Play offs"=Games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  
  Home_playoffs=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Home)&Phase=="Play offs"&grepl({{season}},Season))%>%
    group_by(Home)%>%
    dplyr::summarise(Home_games=n(),Home_Wins=sum(Home_win),Home_Loses=Home_games-Home_Wins)%>%
    dplyr::rename(Team=Home,
                  "Home Loses on Play offs"=Home_Loses,
                  "Home Wins on Play offs"=Home_Wins,
                  "Home Games on Play offs"=Home_games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  
  Away_playoffs=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Away)&Phase=="Play offs"&grepl({{season}},Season))%>%
    group_by(Away)%>%
    dplyr::summarise(Away_games=n(),Away_Wins=sum(Away_win),Away_Loses=Away_games-Away_Wins)%>%
    dplyr::rename(Team=Away,
                  "Away Loses on Play offs"=Away_Loses,
                  "Away Wins on Play offs"=Away_Wins,
                  "Away Games on Play offs"=Away_games)%>%
    dplyr::select(-Team)%>%reshape2::melt()  
  
  Total_finalfour=rbind(dataset_results%>%
                          dplyr::filter(grepl({{Team1}}, Home)&Phase=="Final Four"&grepl({{season}},Season))%>%
                          group_by(Home)%>%
                          dplyr::summarise(Wins=sum(Home_win))%>%
                          dplyr::rename(Team=Home),
                        dataset_results%>%
                          dplyr::filter(grepl({{Team1}}, Away)&Phase=="Final Four"&grepl({{season}},Season))%>%
                          group_by(Away)%>%
                          dplyr::summarise(Wins=sum(Away_win))%>%
                          dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%add_column(Games=Games_finalfour$Total_games)%>%
    mutate(Loses=Games-Wins)%>%
    dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses on Final Four"=Loses,
                  "Total Wins on Final Four"=Wins,
                  "Total Games on Final Four"=Games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  table=rbind(Total,Total_regular,Home_regular,Away_regular,Total_playoffs,Home_playoffs,Away_playoffs,Total_finalfour)%>%
    dplyr::rename(For=variable,Total=value)
  return(table)
}
Games_summary=memoise(Games_summary)

teamplayersstats=function(dataset_players,ha,wl,ph,season,Team){
  
  Total_games=dataset_players%>%filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season)& Team=={{Team}})%>%
  group_by(Team,Player)%>%summarise(G=n())

Total_seasons=dataset_players%>%filter(Team=={{Team}})%>%group_by(Player,Season)%>%summarise(a1=n())%>%group_by(Player)%>%summarise(S=n())

  Total_stats=dataset_players%>%filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season)& Team=={{Team}})%>%
  group_by(Player)%>%summarise(T_PTS=round(sum(PTS,na.rm=T),1),
                                                T_AS=round(sum(AS,na.rm=T),1),
                                                T_DR=round(sum(DR,na.rm=T),1),
                                                T_OR=round(sum(OR,na.rm=T),1),
                                                T_TR=round(sum(TR,na.rm=T),1),
                                                T_ST=round(sum(ST,na.rm=T),1),
                                                T_TO=round(sum(TO,na.rm=T),1),
                                                T_BLK=round(sum(BLK,na.rm=T),1),
                                                T_BLKR=round(sum(BLKR,na.rm=T),1),
                                                T_PF=round(sum(PF,na.rm=T),1),
                                                T_RF=round(sum(RF,na.rm=T),1),
                                                T_F2M=round(sum(F2M,na.rm=T),1),
                                                T_F2A=round(sum(F2A,na.rm=T),1),
                                                T_F3M=round(sum(F3M,na.rm=T),1),
                                                T_F3A=round(sum(F3A,na.rm=T),1),
                                                T_FTM=round(sum(FTM,na.rm=T),1),
                                                T_FTA=round(sum(FTA,na.rm=T),1),
                                                T_PIR=round(sum(PIR,na.rm=T),1),
                                                T_MIN=round(sum(MIN,na.rm=T),1),
                                                PTS=round(mean(PTS,na.rm=T),1),
                                                AS=round(mean(AS,na.rm=T),1),
                                                DR=round(mean(DR,na.rm=T),1),
                                                OR=round(mean(OR,na.rm=T),1),
                                                TR=round(mean(TR,na.rm=T),1),
                                                ST=round(mean(ST,na.rm=T),1),
                                                TO=round(mean(TO,na.rm=T),1),
                                                BLK=round(mean(BLK,na.rm=T),1),
                                                BLKR=round(mean(BLKR,na.rm=T),1),
                                                PF=round(mean(PF,na.rm=T),1),
                                                RF=round(mean(RF,na.rm=T),1),
                                                F2M=round(mean(F2M,na.rm=T),1),
                                                F2A=round(mean(F2A,na.rm=T),1),
                                                P2=100*round(F2M/F2A,3),
                                                F3M=round(mean(F3M,na.rm=T),1),
                                                F3A=round(mean(F3A,na.rm=T),1),
                                                P3=100*round(F3M/F3A,3),
                                                FTM=round(mean(FTM,na.rm=T),1),
                                                FTA=round(mean(FTA,na.rm=T),1),
                                                PFT=100*round(FTM/FTA,3),
                                                PIR=round(mean(PIR,na.rm=T),1),
                                                MIN=round(mean(MIN,na.rm=T),1),
                                                Team_PTS=round(mean(Team_PTS,na.rm=T),1),
                                           Team_AS=round(mean(Team_AS,na.rm=T),1),
                                           Team_DR=round(mean(Team_DR,na.rm=T),1),
                                           Team_OR=round(mean(Team_OR,na.rm=T),1),
                                           Team_TR=round(mean(Team_TR,na.rm=T),1),
                                           Team_ST=round(mean(Team_ST,na.rm=T),1),
                                           Team_TO=round(mean(Team_TO,na.rm=T),1),
                                           Team_BLK=round(mean(Team_BLK,na.rm=T),1),
                                           Team_PF=round(mean(Team_PF,na.rm=T),1),
                                           Team_F2M=round(mean(Team_F2M,na.rm=T),1),
                                           Team_F2A=round(mean(Team_F2A,na.rm=T),1),
                                           Team_F3M=round(mean(Team_F3M,na.rm=T),1),
                                           Team_F3A=round(mean(Team_F3A,na.rm=T),1),
                                           Team_FTM=round(mean(Team_FTM,na.rm=T),1),
                                           Team_FTA=round(mean(Team_FTA,na.rm=T),1),
                                           Team_opp_PTS=round(mean(Team_opp_PTS,na.rm=T),1),
                                           Team_opp_AS=round(mean(Team_opp_AS,na.rm=T),1),
                                           Team_opp_DR=round(mean(Team_opp_DR,na.rm=T),1),
                                           Team_opp_OR=round(mean(Team_opp_OR,na.rm=T),1),
                                           Team_opp_TR=round(mean(Team_opp_TR,na.rm=T),1),
                                           Team_opp_ST=round(mean(Team_opp_ST,na.rm=T),1),
                                           Team_opp_TO=round(mean(Team_opp_TO,na.rm=T),1),
                                           Team_opp_BLK=round(mean(Team_opp_BLK,na.rm=T),1),
                                           Team_opp_PF=round(mean(Team_opp_PF,na.rm=T),1),
                                           Team_opp_F2M=round(mean(Team_opp_F2M,na.rm=T),1),
                                           Team_opp_F2A=round(mean(Team_opp_F2A,na.rm=T),1),
                                           Team_opp_F3M=round(mean(Team_opp_F3M,na.rm=T),1),
                                           Team_opp_F3A=round(mean(Team_opp_F3A,na.rm=T),1),
                                           Team_opp_FTM=round(mean(Team_opp_FTM,na.rm=T),1),
                                           Team_opp_FTA=round(mean(Team_opp_FTA,na.rm=T),1))%>%
  mutate(PPS = round(PTS/ (F3A +F2A+FTA),2),
         POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
         OFFRA=round(100*PTS/POS,1),
         PIE=round((PTS+F2M+F3M+FTM-(F2A+F3A+FTA)+DR+0.5*OR-PF-TO+0.5*BLK+ST+AS)/((Team_PTS+Team_F2M+Team_F3M+Team_FTM-(Team_F2A+Team_F3A+Team_FTA)+Team_AS+Team_DR+Team_OR*0.5+Team_ST+0.5*Team_BLK-Team_PF-Team_TO)+(Team_opp_PTS+Team_opp_F2M+Team_opp_F3M+Team_opp_FTM-(Team_opp_F2A+Team_opp_F3A+Team_opp_FTA)+Team_opp_AS+Team_opp_DR+Team_opp_OR*0.5+Team_opp_ST+0.5*Team_opp_BLK-Team_opp_PF-Team_opp_TO)),2),
         ASR=round(100*AS/POS,1),
         ASTOR=round(AS/TO,1),
         EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1),
         FTR =  round(FTA / (F3A +F2A),2),
         GS = round(PTS + (0.4 * (F3M +F2M)) - (0.7 * (F3A +F2A)) - (0.4 * (FTA - FTM)) + (0.7 * OR) + (0.3 * DR) + ST + (0.7 * AS) + (0.7 * BLK) - (0.4 * PF) - TO,1),
         TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1),
         TOR = round((TO * 100) / POS,2),
         Usage = round(100 * (((F3A +F2A) + 0.44 *FTA + TO) * ( 40 )) / (MIN * (Team_F2A+Team_F3A + 0.44 *Team_FTA + Team_TO)),1),
         ORP = round(100*OR / (Team_OR +Team_opp_OR),1))

Total=merge(Total_stats,Total_seasons,all=TRUE)%>%merge(Total_games,all=TRUE)%>%filter(G>0)%>%
  dplyr::select(Player,G,S,MIN,PTS,AS,ASR,F2M,F2A,P2,F3M,F3A,P3,EFG,TS,
                FTM,FTA,PFT,FTR,DR,OR,ORP,TR,ST,TO,TOR,ASTOR,
                PF,RF,BLK,BLKR,PIR,PPS,POS,OFFRA,PIE,GS,Usage,
                T_MIN,T_PTS,T_AS,T_F2M,T_F2A,T_F3M,T_F3A,T_FTM,T_FTA,T_DR,T_OR,T_TR,
                T_ST,T_TO,T_PF,T_RF,T_BLK,T_BLKR,T_PIR)

return(Total)
}
teamplayersstats=memoise(teamplayersstats)

compute_best_stats=function(dataset_players,stat,season,phase,ha,result){
  compute_games=dataset_players%>%
            dplyr::filter(grepl({{season}},Season)&grepl({{phase}},Phase)&grepl({{ha}},HA)&grepl({{result}},results))%>%
    mutate(Name=paste0(Player," (",Team,"-",Season,") vs ",Against))%>%
            arrange(desc({{stat}}))%>%head(15)%>%add_column(Rank=c(1:15))%>%
    dplyr::select(Rank,Name,{{stat}})
  
  return(compute_games)
}
compute_best_stats=memoise(compute_best_stats)

period_points=function(dataset_results,Team_select,Season_select,Phase_select,ha_select,result_select){
points=rbind(dataset_results%>%
  dplyr::rename(Team=Home,Against=Away,Points=Home_Points,Conceed=Away_Points,
                Q1S=Q1H,Q2S=Q2H,Q3S=Q3H,Q4S=Q4H,EXS=EXH,
                Q1C=Q1A,Q2C=Q2A,Q3C=Q3A,Q4C=Q4A,EXC=EXA,Win1=Home_win)%>%
  mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="H",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),Win=ifelse(Win1==0,"L","W"))%>%
  dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Win,HA)%>%
    dplyr::filter(grepl({{Season_select}},Season)& grepl({{Phase_select}},Phase)& grepl({{ha_select}},HA)& grepl({{result_select}},Win)),
  dataset_results%>%
    dplyr::rename(Team=Away,Against=Home,Points=Away_Points,Conceed=Home_Points,
                  Q1S=Q1A,Q2S=Q2A,Q3S=Q3A,Q4S=Q4A,EXS=EXA,
                  Q1C=Q1H,Q2C=Q2H,Q3C=Q3H,Q4C=Q4H,EXC=EXH,Win1=Away_win)%>%
    mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="A",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),Win=ifelse(Win1==0,"L","W"))%>%
    dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Win,HA)%>%
    dplyr::filter(grepl({{Season_select}},Season)& grepl({{Phase_select}},Phase)& grepl({{ha_select}},HA)& grepl({{result_select}},Win)))%>%
  group_by(Team)%>%summarise(Q1S=round(mean(Q1S),1),Q1C=round(mean(Q1C),1),Q2S=round(mean(Q2S),1),Q2C=round(mean(Q2C),1),FHS=round(mean(FHS),1),FHC=round(mean(FHC),1),
                             Q3S=round(mean(Q3S),1),Q3C=round(mean(Q3C),1),Q4S=round(mean(Q4S),1),Q4C=round(mean(Q4C),1),SHS=round(mean(SHS),1),SHC=round(mean(SHC),1),
                             EXS=round(mean(EXS1,na.rm = TRUE),2),EXC=round(mean(EXC1,na.rm = TRUE),2))


reshape_period_points=points%>%reshape2::melt()%>%
  mutate(variable = str_replace(variable, "Q1S", "Q1 Scored"),
         variable = str_replace(variable, "Q1C", "Q1 Conceed"),
         variable = str_replace(variable, "Q2S", "Q2 Scored"),
         variable = str_replace(variable, "Q2C", "Q2 Conceed"),
         variable = str_replace(variable, "FHS", "First Half Scored"),
         variable = str_replace(variable, "FHC", "First Half Conceed"),
         variable = str_replace(variable, "Q3S", "Q3 Scored"),
         variable = str_replace(variable, "Q3C", "Q3 Conceed"),
         variable = str_replace(variable, "Q4S", "Q4 Scored"),
         variable = str_replace(variable, "Q4C", "Q4 Conceed"),
         variable = str_replace(variable, "SHS", "Second Half Scored"),
         variable = str_replace(variable, "SHC", "Second Half Conceed"),
         variable = str_replace(variable, "EXS", "ET Scored"),
         variable = str_replace(variable, "EXC", "ET Conceed"))%>%
  dplyr::filter(Team=={{Team_select}})%>%
  dplyr::select(-Team)%>%dplyr::rename(Period=variable,Points=value)



final_data=rbind(dataset_results%>%
        dplyr::rename(Team=Home,Against=Away,Points=Home_Points,Conceed=Away_Points,
                      Q1S=Q1H,Q2S=Q2H,Q3S=Q3H,Q4S=Q4H,EXS=EXH,
                      Q1C=Q1A,Q2C=Q2A,Q3C=Q3A,Q4C=Q4A,EXC=EXA,Win=Home_win)%>%
        mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="H",
               EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),
               Result=ifelse(Win==0,"L","W"))%>%
        dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Result,HA),
      dataset_results%>%
        dplyr::rename(Team=Away,Against=Home,Points=Away_Points,Conceed=Home_Points,
                      Q1S=Q1A,Q2S=Q2A,Q3S=Q3A,Q4S=Q4A,EXS=EXA,
                      Q1C=Q1H,Q2C=Q2H,Q3C=Q3H,Q4C=Q4H,EXC=EXH,Win=Away_win)%>%
        mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="A",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),
               Result=ifelse(Win==0,"L","W"))%>%
        dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,
                      Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Result,HA))%>%
  mutate(Q1R=ifelse(Q1S>Q1C,1,0),
         Q2R=ifelse(Q2S>Q2C,1,0),
         Q3R=ifelse(Q3S>Q3C,1,0),
         Q4R=ifelse(Q4S>Q4C,1,0),
         FHR=ifelse(FHS>FHC,1,0),
         SHR=ifelse(SHS>SHC,1,0),
         R=ifelse(Result=="W",1,0))%>%
  filter(grepl({{Season_select}},Season)&grepl({{Phase_select}},Phase)&grepl({{ha_select}},HA))%>%
  group_by(Team)%>%
  summarise(G=n(),
            Q1W=sum(Q1R,na.rm = TRUE),
            Q2W=sum(Q2R,na.rm = TRUE),
            Q3W=sum(Q3R,na.rm = TRUE),
            Q4W=sum(Q4R,na.rm = TRUE),
            FHW=sum(FHR,na.rm = TRUE),
            SHW=sum(SHR,na.rm = TRUE),
            W=sum(R,na.rm = TRUE),
            Q1W_W=sum(Q1R[R==1],na.rm = TRUE),
            Q2W_W=sum(Q2R[R==1],na.rm = TRUE),
            Q3W_W=sum(Q3R[R==1],na.rm = TRUE),
            Q4W_W=sum(Q4R[R==1],na.rm = TRUE),
            FHW_W=sum(FHR[R==1],na.rm = TRUE),
            SHW_W=sum(SHR[R==1],na.rm = TRUE))%>%
  select(Team,G,W,Q1W,Q1W_W,Q2W,Q2W_W,FHW,FHW_W,Q3W,Q3W_W,Q4W,Q4W_W,SHW,SHW_W)

return(list(points,reshape_period_points,final_data))
}
period_points=memoise(period_points)

team_stats_by_a_game=function(dataset_players,dataset_results,Team_select,ha,ph,wl,season){  
stats_team=merge(dataset_players%>%
   group_by(Team,idseason,Against,Phase)%>%
   summarise(PTS=sum(PTS,na.rm=TRUE),
             AS=sum(AS,na.rm=TRUE),
             F2M=sum(F2M,na.rm=TRUE),
             F2A=sum(F2A,na.rm=TRUE),
             P2=100*round(F2M/F2A,3),
             F3M=sum(F3M,na.rm=TRUE),
             F3A=sum(F3A,na.rm=TRUE),
             P3=100*round(F3M/F3A,3),
             FTM=sum(FTM,na.rm=TRUE),
             FTA=sum(FTA,na.rm=TRUE),
             PFT=100*round(FTM/FTA,3),
             OR=sum(OR,na.rm=TRUE),
             DR=sum(DR,na.rm=TRUE),
             TR=sum(TR,na.rm=TRUE),
             TO=sum(TO,na.rm = TRUE),
             BLK=sum(BLK,na.rm = TRUE),
             BLKR=sum(BLKR,na.rm = TRUE),
             PF=sum(PF,na.rm = TRUE),
             RF=sum(RF,na.rm=TRUE),
             ST=sum(ST,na.rm=TRUE),
             PIR=sum(PIR,na.rm = TRUE)),
   dataset_players%>%
     group_by(Team,idseason,Against)%>%
     summarise(opp_PTS=sum(PTS,na.rm=TRUE),
               opp_AS=sum(AS,na.rm=TRUE),
               opp_F2M=sum(F2M,na.rm=TRUE),
               opp_F2A=sum(F2A,na.rm=TRUE),
               opp_P2=100*round(opp_F2M/opp_F2A,3),
               opp_F3M=sum(F3M,na.rm=TRUE),
               opp_F3A=sum(F3A,na.rm=TRUE),
               opp_P3=100*round(opp_F3M/opp_F3A,3),
               opp_FTM=sum(FTM,na.rm=TRUE),
               opp_FTA=sum(FTA,na.rm=TRUE),
               opp_PFT=100*round(opp_FTM/opp_FTA,3),
               opp_OR=sum(OR,na.rm=TRUE),
               opp_DR=sum(DR,na.rm=TRUE),
               opp_TR=sum(TR,na.rm=TRUE),
               opp_TO=sum(TO,na.rm = TRUE),
               opp_ST=sum(ST,na.rm=TRUE),
               opp_PIR=sum(PIR,na.rm = TRUE))%>%
     dplyr::rename(Team=Against,Against=Team),all=TRUE)%>%
  merge(rbind(dataset_results%>%
                  dplyr::rename(Team=Home,Against=Away,Points=Home_Points,Conceed=Away_Points,
                                Q1S=Q1H,Q2S=Q2H,Q3S=Q3H,Q4S=Q4H,EXS=EXH,
                                Q1C=Q1A,Q2C=Q2A,Q3C=Q3A,Q4C=Q4A,EXC=EXA,Win=Home_win)%>%
                                mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="H",
                                       EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),
                                       Result=ifelse(Win==0,"L","W"))%>%
                                      dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Result,HA),
              dataset_results%>%
                                      dplyr::rename(Team=Away,Against=Home,Points=Away_Points,Conceed=Home_Points,
                                      Q1S=Q1A,Q2S=Q2A,Q3S=Q3A,Q4S=Q4A,EXS=EXA,
                                      Q1C=Q1H,Q2C=Q2H,Q3C=Q3H,Q4C=Q4H,EXC=EXH,Win=Away_win)%>%
                                      mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="A",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),
                                             Result=ifelse(Win==0,"L","W"))%>%
                                      dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,
                                                    Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Result,HA)),all=TRUE)%>%
  mutate(T_PTS=PTS+opp_PTS,T_AS=AS+opp_AS,T_F2M=F2M+opp_F2M,T_F2A=F2A+opp_F2A,T_F3M=F3M+opp_F3M,T_F3A=F3A+opp_F3A,
         T_FTM=FTM+opp_FTM,T_FTA=FTA+opp_FTA,T_OR=OR+opp_OR,T_DR=DR+opp_DR,T_TR=TR+opp_TR,T_TO=TO+opp_TO,T_ST=ST+opp_ST,
         T_BLK=BLK+BLKR,T_FL=PF+RF,Fixture=as.numeric(Fixture))%>%
  select(idseason,"Team","Season",Fixture,"Phase","Result","HA","Against","Q1S","Q2S","FHS","Q3S","Q4S","SHS","EXS1",
         "Q1C","Q2C","FHC","Q3C","Q4C","SHC",PTS,opp_PTS,T_PTS,AS,opp_AS,T_AS,"F2M","F2A","P2","opp_F2M","opp_F2A","opp_P2",T_F2M,T_F2A,"F3M","F3A","P3","opp_F3M","opp_F3A","opp_P3",T_F3M,T_F3A,"FTM","FTA",PFT,"opp_FTM","opp_FTA","opp_PFT",T_FTM,T_FTA,OR,opp_OR,T_OR,DR,opp_DR,T_DR,TR,opp_TR,T_TR,TO,opp_TO,T_TO,BLK,BLKR,T_BLK,PF,RF,T_FL,ST,opp_ST,T_ST,PIR,opp_PIR)%>%
  dplyr::filter(grepl({{ha}}, HA) & grepl({{wl}},Result)& grepl({{ph}},Phase)& grepl({{season}},Season))
  
stats_team=unique(stats_team)

teams_cummean=stats_team%>%
  arrange(Season,Fixture)%>%
  group_by(Team)%>%
  summarise(idseason=idseason,
    seqalong=seq_along(idseason),
            PTS_bef=round((cumsum(PTS)-PTS)/(seqalong-1),1),
            AS_bef=round((cumsum(AS)-AS)/(seqalong-1),1),
            F2M_bef=round((cumsum(F2M)-F2M)/(seqalong-1),1),
            F2A_bef=round((cumsum(F2A)-F2A)/(seqalong-1),1),
            P2_bef=100*round(F2M_bef/F2A_bef,3),
            F3M_bef=round((cumsum(F3M)-F3M)/(seqalong-1),1),
            F3A_bef=round((cumsum(F3A)-F3A)/(seqalong-1),1),
            P3_bef=100*round(F3M_bef/F3A_bef,3),
            FTM_bef=round((cumsum(FTM)-FTM)/(seqalong-1),1),
            FTA_bef=round((cumsum(FTA)-FTA)/(seqalong-1),1),
            PFT_bef=100*round(FTM_bef/FTA_bef,3),
            OR_bef=round((cumsum(OR)-OR)/(seqalong-1),1),
            DR_bef=round((cumsum(DR)-DR)/(seqalong-1),1),
            TR_bef=round((cumsum(TR)-TR)/(seqalong-1),1),
            TO_bef=round((cumsum(TO)-TO)/(seqalong-1),1),
            BLK_bef=round((cumsum(BLK)-BLK)/(seqalong-1),1),
            PF_bef=round((cumsum(PF)-PF)/(seqalong-1),1),
            ST_bef=round((cumsum(ST)-ST)/(seqalong-1),1),
            PIR_bef=round((cumsum(PIR)-PIR)/(seqalong-1),1),
            PTS_con_bef=round((cumsum(opp_PTS)-opp_PTS)/(seqalong-1),1),
            AS_con_bef=round((cumsum(opp_AS)-opp_AS)/(seqalong-1),1),
            F2M_con_bef=round((cumsum(opp_F2M)-opp_F2M)/(seqalong-1),1),
            F2A_con_bef=round((cumsum(opp_F2A)-opp_F2A)/(seqalong-1),1),
            P2_con_bef=100*round(F2M_con_bef/F2A_con_bef,3),
            F3M_con_bef=round((cumsum(opp_F3M)-opp_F3M)/(seqalong-1),1),
            F3A_con_bef=round((cumsum(opp_F3A)-opp_F3A)/(seqalong-1),1),
            P3_con_bef=100*round(F3M_con_bef/F3A_con_bef,3),
            FTM_con_bef=round((cumsum(opp_FTM)-opp_FTM)/(seqalong-1),1),
            FTA_con_bef=round((cumsum(opp_FTA)-opp_FTA)/(seqalong-1),1),
            PFT_con_bef=100*round(FTM_con_bef/FTA_con_bef,3),
            OR_con_bef=round((cumsum(opp_OR)-opp_OR)/(seqalong-1),1),
            DR_con_bef=round((cumsum(opp_DR)-opp_DR)/(seqalong-1),1),
            TR_con_bef=round((cumsum(opp_TR)-opp_TR)/(seqalong-1),1),
            TO_con_bef=round((cumsum(opp_TO)-opp_TO)/(seqalong-1),1),
            BLK_con_bef=round((cumsum(BLKR)-BLKR)/(seqalong-1),1),
            PF_con_bef=round((cumsum(RF)-RF)/(seqalong-1),1),
            ST_con_bef=round((cumsum(opp_ST)-opp_ST)/(seqalong-1),1),
            PIR_con_bef=round((cumsum(opp_PIR)-opp_PIR)/(seqalong-1),1))


against_cummean=stats_team%>%
  arrange(Season,Fixture)%>%
  group_by(Against)%>%
  summarise(idseason=idseason,
            seqalong=seq_along(Fixture),
            opp_PTS_con_bef=round((cumsum(PTS)-PTS)/(seqalong-1),1),
            opp_AS_con_bef=round((cumsum(AS)-AS)/(seqalong-1),1),
            opp_F2M_con_bef=round((cumsum(F2M)-F2M)/(seqalong-1),1),
            opp_F2A_con_bef=round((cumsum(F2A)-F2A)/(seqalong-1),1),
            opp_P2_con_bef=100*round(opp_F2M_con_bef/opp_F2A_con_bef,3),
            opp_F3M_con_bef=round((cumsum(F3M)-F3M)/(seqalong-1),1),
            opp_F3A_con_bef=round((cumsum(F3A)-F3A)/(seqalong-1),1),
            opp_P3_con_bef=100*round(opp_F3M_con_bef/opp_F3A_con_bef,3),
            opp_FTM_con_bef=round((cumsum(FTM)-FTM)/(seqalong-1),1),
            opp_FTA_con_bef=round((cumsum(FTA)-FTA)/(seqalong-1),1),
            opp_PFT_con_bef=100*round(opp_FTM_con_bef/opp_FTA_con_bef,3),
            opp_OR_con_bef=round((cumsum(OR)-OR)/(seqalong-1),1),
            opp_DR_con_bef=round((cumsum(DR)-DR)/(seqalong-1),1),
            opp_TR_con_bef=round((cumsum(TR)-TR)/(seqalong-1),1),
            opp_TO_con_bef=round((cumsum(TO)-TO)/(seqalong-1),1),
            opp_BLK_con_bef=round((cumsum(BLK)-BLK)/(seqalong-1),1),
            opp_PF_con_bef=round((cumsum(PF)-PF)/(seqalong-1),1),
            opp_ST_con_bef=round((cumsum(ST)-ST)/(seqalong-1),1),
            opp_PIR_con_bef=round((cumsum(PIR)-PIR)/(seqalong-1),1),
            opp_PTS_bef=round((cumsum(opp_PTS)-opp_PTS)/(seqalong-1),1),
            opp_AS_bef=round((cumsum(opp_AS)-opp_AS)/(seqalong-1),1),
            opp_F2M_bef=round((cumsum(opp_F2M)-opp_F2M)/(seqalong-1),1),
            opp_F2A_bef=round((cumsum(opp_F2A)-opp_F2A)/(seqalong-1),1),
            opp_P2_bef=100*round(opp_F2M_bef/opp_F2A_bef,3),
            opp_F3M_bef=round((cumsum(opp_F3M)-opp_F3M)/(seqalong-1),1),
            opp_F3A_bef=round((cumsum(opp_F3A)-opp_F3A)/(seqalong-1),1),
            opp_P3_bef=100*round(opp_F3M_bef/opp_F3A_bef,3),
            opp_FTM_bef=round((cumsum(opp_FTM)-opp_FTM)/(seqalong-1),1),
            opp_FTA_bef=round((cumsum(opp_FTA)-opp_FTA)/(seqalong-1),1),
            opp_PFT_bef=100*round(opp_FTM_bef/opp_FTA_bef,3),
            opp_OR_bef=round((cumsum(opp_OR)-opp_OR)/(seqalong-1),1),
            opp_DR_bef=round((cumsum(opp_DR)-opp_DR)/(seqalong-1),1),
            opp_TR_bef=round((cumsum(opp_TR)-opp_TR)/(seqalong-1),1),
            opp_TO_bef=round((cumsum(opp_TO)-opp_TO)/(seqalong-1),1),
            opp_BLK_bef=round((cumsum(BLKR)-BLKR)/(seqalong-1),1),
            opp_PF_bef=round((cumsum(RF)-RF)/(seqalong-1),1),
            opp_ST_bef=round((cumsum(opp_ST)-opp_ST)/(seqalong-1),1),
            opp_PIR_bef=round((cumsum(opp_PIR)-opp_PIR)/(seqalong-1),1))


final_data=merge(stats_team,teams_cummean,by=c("idseason",'Team'))%>%merge(against_cummean,by=c('idseason','Against'))%>%
  select("Team","Season",Fixture,"Phase","Result","HA","Against","Q1S","Q2S","FHS","Q3S","Q4S","SHS","EXS1",
         "Q1C","Q2C","FHC","Q3C","Q4C","SHC",
         PTS,opp_PTS,T_PTS,PTS_bef,PTS_con_bef,opp_PTS_bef,opp_PTS_con_bef,
         AS,opp_AS,T_AS,AS_bef,AS_con_bef,opp_AS_bef,opp_AS_con_bef,
         "F2M","F2A","P2","opp_F2M","opp_F2A","opp_P2",T_F2M,T_F2A,
         F2M_bef,F2M_con_bef,opp_F2M_bef,opp_F2M_con_bef,
         F2A_bef,F2A_con_bef,opp_F2A_bef,opp_F2A_con_bef,
         P2_bef,P2_con_bef,opp_P2_bef,opp_P2_con_bef,
         "F3M","F3A","P3","opp_F3M","opp_F3A","opp_P3",T_F3M,T_F3A,
         F3M_bef,F3M_con_bef,opp_F3M_bef,opp_F3M_con_bef,
         F3A_bef,F3A_con_bef,opp_F3A_bef,opp_F3A_con_bef,
         P3_bef,P3_con_bef,opp_P3_bef,opp_P3_con_bef,
         "FTM","FTA",PFT,"opp_FTM","opp_FTA","opp_PFT",T_FTM,T_FTA,
         FTM_bef,FTM_con_bef,opp_FTM_bef,opp_FTM_con_bef,
         FTA_bef,FTA_con_bef,opp_FTA_bef,opp_FTA_con_bef,
         PFT_bef,PFT_con_bef,opp_PFT_bef,opp_PFT_con_bef,
         OR,opp_OR,T_OR,OR_bef,opp_OR_bef,OR_con_bef,opp_OR_con_bef,
         DR,opp_DR,T_DR,DR_bef,DR_con_bef,opp_DR_bef,opp_DR_con_bef,
         TR,opp_TR,T_TR,TR_bef,TR_con_bef,opp_TR_bef,opp_TR_con_bef,
         TO,opp_TO,T_TO,TO_bef,TO_con_bef,opp_TO_bef,opp_TO_con_bef,
         BLK,BLKR,T_BLK,BLK_bef,BLK_con_bef,opp_BLK_bef,opp_BLK_con_bef,
         PF,RF,T_FL,PF_bef,PF_con_bef,opp_PF_bef,opp_PF_con_bef,
         ST,opp_ST,T_ST,ST_bef,ST_con_bef,opp_ST_bef,opp_ST_con_bef,
         PIR,opp_PIR,PIR_bef,PIR_con_bef,opp_PIR_bef,opp_PIR_con_bef)%>%
  filter(Team=={{Team_select}})%>%select(-Team)


return(final_data)
}
team_stats_by_a_game=memoise(team_stats_by_a_game)

players_stats_by_a_against_team=function(dataset_players,Against_team,Home_Away,Win_Lose,Phase,Season){
 data=dataset_players%>%mutate(Win=ifelse(results=="W",1,0))%>%filter(Against=={{Against_team}}&
                       grepl({{Home_Away}},HA)&
                       grepl({{Win_Lose}},results)&
                       grepl({{Phase}},Phase)&
                       grepl({{Season}},Season))%>%group_by(Player)%>%
                                               summarise(G=n(),
                                                   W=sum(Win),
                                                   PTS=round(mean(PTS,na.rm = T),1),
                                                   AS=round(mean(AS,na.rm=T),1),
                                                   OR=round(mean(OR,na.rm=T),1),
                                                   DR=round(mean(DR,na.rm=T),1),
                                                   TR=round(mean(TR,na.rm=T),1),
                                                   FTM=round(mean(FTM,na.rm=T),1),
                                                   FTA=round(mean(FTA,na.rm=T),1),
                                                   PFT=round(100*FTM/FTA,2),
                                                   F2M=round(mean(F2M,na.rm=T),1),
                                                   F2A=round(mean(F2A,na.rm=T),1),
                                                   P2=round(100*F2M/F2A,1),
                                                   F3M=round(mean(F3M,na.rm=T),1),
                                                   F3A=round(mean(F3A,na.rm=T),1),
                                                   P3=round(100*F3M/F3A,1),
                                                   ST=round(mean(ST,na.rm=T),1),
                                                   TO=round(mean(TO,na.rm=T),1),
                                                   BLK=round(mean(BLK,na.rm=T),1),
                                                   PF=round(mean(PF,na.rm=T),1),
                                                   BLKR=round(mean(BLKR,na.rm=T),1),
                                                   RF=round(mean(RF,na.rm=T),1),
                                                   MIN=round(mean(MIN,na.rm=T),1),
                                                   PIR=round(mean(PIR,na.rm=T),1),
                                                   PPS = round(PTS/ (F3A +F2A+FTA),2),
                                                   POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
                                                   OFFRA=round(100*PTS/POS,1),
                                                   ASR=round(100*AS/POS,1),
                                                   ATOR=round(AS/TO,1),
                                                   EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1),
                                                   FTR =  round(FTA / (F3A +F2A),2),
                                                   GS = round(PTS + (0.4 * (F3M +F2M)) - (0.7 * (F3A +F2A)) - (0.4 * (FTA - FTM)) + (0.7 * OR) + (0.3 * DR) + ST + (0.7 * AS) + (0.7 * BLK) - (0.4 * PF) - TO,1),
                                                   TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1),
                                                   TOR = round((TO * 100) / POS,2),
                                                   USG = round(100 * (((F3A +F2A) + 0.44 *FTA + TO) * ( 40 )) / (MIN * (mean(Team_F2A,na.rm=T)+mean(Team_F3A,na.rm=T) + 0.44 * mean(Team_FTA,na.rm=T) + mean(Team_TO,na.rm=T))),1),
                                                   ORP = round(100*OR / (mean(Team_OR,na.rm=T) + mean(Team_opp_OR,na.rm=T)),1))
return(data)
}
players_stats_by_a_against_team=memoise(players_stats_by_a_against_team)

rating_teams=function(dataset_players,Team_select,Season_select,Phase_select,Result_select,ha_select){
  
  rating_compute=compute_team_stats(dataset_players,ha_select,Result_select,Phase_select,Season_select)%>%
    dplyr::select(-tidyr::contains("Total_"),-Games)%>%
    
    arrange(desc(PTS))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_PTS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(AS))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_AS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(F2M))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_F2M=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(F2A))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_F2A=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(P2))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_P2=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(F3M))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_F3M=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(F3A))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_F3A=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(P3))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_P3=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(FTM))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_FTM=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(FTA))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_FTA=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(PFT))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_PFT=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(OR))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_OR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(DR))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_DR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(TO))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_TO=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(ST))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_ST=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(BLK))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_BLK=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(BLKR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_BLKR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(PF))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_PF=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(RF))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_RF=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    
    arrange(desc(opp_PTS))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_PTS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_AS))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_AS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_F2M))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_F2M=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_F2A))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_F2A=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_P2))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_P2=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_F3M))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_F3M=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_F3A))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_F3A=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_P3))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_P3=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_FTM))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_FTM=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_FTA))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_FTA=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_PFT))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_PFT=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_OR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_OR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_DR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_DR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_TO))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_opp_TO=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_ST))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_ST=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(ASFG))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_ASFG=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_ASFG))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_ASFG=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(PPS))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_PPS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_PPS))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_PPS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(ASTOR))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_ASTOR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_ASTOR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_ASTOR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(FTR))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_FTR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_FTR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_FTR =round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(POS))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_POS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_POS))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_POS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(ASR))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_ASR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_ASR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_ASR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(OFF_RAT))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_OffRat=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(DEF_RAT))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_DefRat=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(TOR))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_TOR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_TOR))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_opp_TOR=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(TS))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_TS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_TS))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_TS=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(EFG))%>%
    mutate(nplayers=n_unique(Team):1,
           Rating_EFG=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    
    arrange(desc(opp_EFG))%>%
    mutate(nplayers=1:n_unique(Team),
           Rating_opp_EFG=round(nplayers*100/n_unique(Team),0))%>%
    select(-nplayers)%>%
    dplyr::select(Team,tidyr::contains("Rating_"))%>%
    reshape2::melt()%>%
    mutate(variable=str_replace(variable,"Rating_",""))%>%
    filter(Team=={{Team_select}})%>%select(-Team)
  
  offense=rating_compute%>%
    filter(variable=='PTS'|
             variable=='AS'|
             variable=='F2M'|
             variable=='F2A'|
             variable=='P2'|
             variable=='F3M'|
             variable=='F3A'|
             variable=='P3'|
             variable=='FTM'|
             variable=='FTA'|
             variable=='PFT'|
             variable=='OR'|
             variable=='TO'|
             variable=='BLKR'|
             variable=='RF'|
             variable=='ST'|
             variable=='PPS'|
             variable=='OffRat'|
             variable=='POS'|
             variable=='EFG'|
             variable=='TS'|
             variable=='FTR'|
             variable=='ASTOR'|
             variable=='TOR'|
             variable=='ASR'|
             variable=='ORP'|
             variable=='opp_DR'|
             variable=='opp_ST'|
             variable=='ASFG')%>%
    summarise(Category="Offense",
              Rating=round(mean(value,na.rm=TRUE),0))
  
  defense=rating_compute%>%
    filter(variable=='DR'|
             variable=='BLK'|
             variable=='PF'|
             variable=='opp_PTS'|
             variable=='opp_AS'|
             variable=='opp_F2M'|
             variable=='opp_F2A'|
             variable=='opp_P2'|
             variable=='opp_F3M'|
             variable=='opp_F3A'|
             variable=='opp_P3'|
             variable=='opp_FTM'|
             variable=='opp_FTA'|
             variable=='opp_PFT'|
             variable=='opp_OR'|
             variable=='opp_TO'|
             variable=='opp_ASFG'|
             variable=='opp_PPS'|
             variable=='opp_ASTOR'|
             variable=='opp_FTR'|
             variable=='opp_POS'|
             variable=='opp_ASR'|
             variable=='DefRat'|
             variable=='opp_TOR'|
             variable=='opp_TS'|
             variable=='opp_EFG')%>%
    summarise(Category="Defense",
              Rating=round(mean(value,na.rm=TRUE),0))
  
  Total=rating_compute%>%summarise(Category="Total",
                                   Rating=round(mean(value,na.rm=TRUE),0))
  
  All=rbind(offense,defense,Total)
  
  return(All)
}
rating_teams=memoise(rating_teams)

compute_stats_team_rename=function(dataset_players,ha,wl,ph,season){
  final_data=compute_team_stats(dataset_players,ha,wl,ph,season)%>%reshape2::melt()%>%
  mutate(variable1=str_replace(variable,"_"," "),
         variable1=str_replace(variable1,"PTS","Points"),
         variable1=str_replace(variable1,"AS","Assists"),
         variable1=str_replace(variable1,"DR","Def Reb"),
         variable1=str_replace(variable1,"OR","Off Reb"),
         variable1=str_replace(variable1,"TR","Total Reb"),
         variable1=str_replace(variable1,"ST","Steals"),
         variable1=str_replace(variable1,"TO","Turnovers"),
         variable1=str_replace(variable1,"BLKR","Blocks"),
         variable1=str_replace(variable1,"BLK","Blocks"),
         variable1=str_replace(variable1,"RF","Fouls"),
         variable1=str_replace(variable1,"F2M","2P made"),
         variable1=str_replace(variable1,"F2A","2P attempted"),
         variable1=str_replace(variable1,"P2","2P(%)"),
         variable1=str_replace(variable1,"F3M","3P made"),
         variable1=str_replace(variable1,"F3A","3P attempted"),
         variable1=str_replace(variable1,"P3","3P(%)"),
         variable1=str_replace(variable1,"FTM","Free throw made"),
         variable1=str_replace(variable1,"FTA","Free throw attempted"),
         variable1=str_replace(variable1,"PFT","FT(%)"),
         variable1=str_replace(variable1,"FTR","Free throw Ratio"),
         variable1=str_replace(variable1,"TS","True Shooting"),
         variable1=str_replace(variable1,"PPS","Points per Shoot"),
         variable1=str_replace(variable1,"PF","Fouls"),
         variable1=str_replace(variable1, "ASR", "Assists Ratio"),
         variable1 =str_replace(variable1, "OFF RAT", "Offensive Rating"),
         variable1 =str_replace(variable1, "EFG", "EFG(%)"),
         variable1 =str_replace(variable1, "POS", "Possesions"),
         variable1 =str_replace(variable1, "TOR", "Turnover Ratio"),
         variable1 =str_replace(variable1, "opp ", ""),
         variable1 =str_replace(variable1, "AssistsFG", "Assisted Field Goal"),
         variable1 =str_replace(variable1, "AssistsR", "Assists Ratio"),
         variable1 =str_replace(variable1, "AssistsTurnoversff Reb", "Assists/Turnovers Ratio"),
         variable1 =str_replace(variable1, "DEF RAT", "Offensive Rating"),
         variable1 =str_replace(variable1, "Turnoversff Reb", "Turnovers Ratio"))
  
  return(final_data)
  
}
compute_stats_team_rename=memoise(compute_stats_team_rename)


games_between_teams=function(dataset_players,Team1_select,Team2_select,Phase_select,Season_select,home_away1_select,home_away2_select){
  
  final_data=cbind(data.frame(rbind(dataset_players%>%
                                      filter(grepl(paste0({{Team1_select}},"-",{{Team2_select}},"|",{{Team2_select}},"-",{{Team1_select}}),fix_teams)&grepl({{Phase_select}},Phase)&grepl({{Season_select}},Season))%>%
                                      group_by(idseason,Team,results,HA)%>%
                                      summarise(G=n())%>%
                                      group_by(Team,results,HA)%>%
                                      summarise(Wins=n())%>%
                                      filter(results!="L")%>%
                                      select(-results)%>%filter(grepl({{home_away1_select}},HA)&Team=={{Team1_select}}),
                                    dataset_players%>%
                                      filter(grepl(paste0({{Team1_select}},"-",{{Team2_select}},"|",{{Team2_select}},"-",{{Team1_select}}),fix_teams)&grepl({{Phase_select}},Phase)&grepl({{Season_select}},Season))%>%
                                      group_by(idseason,Team,results,HA)%>%
                                      summarise(G=n())%>%
                                      group_by(Team,results,HA)%>%
                                      summarise(Wins=n())%>%
                                      filter(results!="L")%>%
                                      select(-results)%>%filter(grepl({{home_away2_select}},HA)&Team=={{Team2_select}})))%>%select(-results,-HA),
                   rbind(dataset_players%>%
                           filter(grepl(paste0({{Team1_select}},"-",{{Team2_select}},"|",{{Team2_select}},"-",{{Team1_select}}),fix_teams)&grepl({{Phase_select}},Phase)&grepl({{Season_select}},Season))%>%
                           group_by(idseason,Team,results,HA)%>%
                           summarise(G=n())%>%
                           group_by(Team,results,HA)%>%
                           summarise(Wins=n())%>%
                           filter(results!="L")%>%
                           select(-results)%>%filter(grepl({{home_away1_select}},HA)&Team=={{Team1_select}}),
                         dataset_players%>%
                           filter(grepl(paste0({{Team1_select}},"-",{{Team2_select}},"|",{{Team2_select}},"-",{{Team1_select}}),fix_teams)&grepl({{Phase_select}},Phase)&grepl({{Season_select}},Season))%>%
                           group_by(idseason,Team,results,HA)%>%
                           summarise(G=n())%>%
                           group_by(Team,results,HA)%>%
                           summarise(Wins=n())%>%
                           filter(results!="L")%>%
                           select(-results)%>%filter(grepl({{home_away2_select}},HA)&Team=={{Team2_select}}))%>%
                     group_by(results)%>%
                     summarise(Games=sum(Wins))%>%select(-results))%>%group_by(Team)%>%
    summarise(Wins=sum(Wins),
              Games=max(Games))

return(final_data)
  
}
games_between_teams=memoise(games_between_teams)


```

# Stats Leaders (Average Stats){data-navmenu="Player Stats"}

## {.sidebar}

### {data-height=900}

```{r}
season_basic_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("season_basic_stats",label="Select Season",choices = season_basic_stats,selected = "2023-2024")))

phase_basic_stats=rev(c("Regular Season","Play In","Play offs","Final Four",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("phase_basic_stats",label="Phase",choices=phase_basic_stats)))

results_basic_stats=rev(c("W","L",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("results_basic_stats",label="Result",choices=results_basic_stats)))

home_away_basic_stats=rev(c("H","A",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("home_away_basic_stats",label="Home or Away ",choices=home_away_basic_stats)))

mainPanel(width = 10,
div(style="height:70px",numericInput("Games_basic_stats","Games",min=0,max=300,value=10)))
mainPanel(width = 10,
div(style="height:70px",numericInput("Total_shoots_basic_stats","Total Shoots",min=0,max=2000,value=50)))

```


## Column {.tabset} 


### Points

```{r eval=TRUE}

renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
  compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%
              dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_PTS))%>%head(15)%>%rename(PTS=Av_PTS)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PTS)},error=function(e)     
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### Assists
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_AS))%>%head(15)%>%rename(AS=Av_AS)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,AS)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### 2 Points made
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_F2M))%>%head(15)%>%rename(F2M=Av_F2M)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,F2M)},error=function(e)      
    "Sorry, there is no data for your requested combination.                       
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### 2 Points attempt
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_F2A))%>%head(15)%>%rename(F2A=Av_F2A)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,F2A)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### 2 Points(%)
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats&Total_F2A>input$Total_shoots_basic_stats)%>%
  arrange(desc(Av_P2))%>%head(15)%>%rename(P2=Av_P2)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,P2)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### 3 Points made
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_F3M))%>%head(15)%>%rename(F3M=Av_F3M)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,F3M)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### 3 Points attempt
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_F3A))%>%head(15)%>%rename(F3A=Av_F3A)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,F3A)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### 3 Points(%)
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats&Total_F3A>input$Total_shoots_basic_stats)%>%
  arrange(desc(Av_P3))%>%head(15)%>%rename(P3=Av_P3)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,P3)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### Free throws made
```{r eval=TRUE}
  renderTable(tryCatch({   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_FTM))%>%head(15)%>%rename(FTM=Av_FTM)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,FTM)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Free throws attempt
```{r eval=TRUE}
  renderTable(tryCatch({   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_FTA))%>%head(15)%>%rename(FTA=Av_FTA)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,FTA)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Free throws(%)
```{r eval=TRUE}
  renderTable(tryCatch({   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats&Total_FTA>input$Total_shoots_basic_stats)%>%
  arrange(desc(Av_PFT))%>%head(15)%>%rename(PFT=Av_PFT)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PFT)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Offensive Rebounds
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_OR))%>%head(15)%>%rename(OR=Av_OR)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,OR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```


### Defensive Rebounds
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_DR))%>%head(15)%>%rename(DR=Av_DR)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,DR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```


### Total Rebounds
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_TR))%>%head(15)%>%rename(TR=Av_TR)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,TR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### Steals
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_ST))%>%head(15)%>%rename(ST=Av_ST)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,ST)},error=function(e)      
    "Sorry, there is no data for your requested combination.                       
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### Blocks made
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_BLK))%>%head(15)%>%rename(BLK=Av_BLK)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,BLK)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### Blocks received
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_BLKR))%>%head(15)%>%rename(BLKR=Av_BLKR)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,BLKR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Fouls made
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_PF))%>%head(15)%>%rename(PF=Av_PF)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PF)},error=function(e)      
    "Sorry, there is no data for your requested combination.                       
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```
### Fouls received
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_RF))%>%head(15)%>%rename(RF=Av_RF)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,RF)},error=function(e)      
    "Sorry, there is no data for your requested combination.                       
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Turnovers
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_TO))%>%head(15)%>%rename(TO=Av_TO)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,TO)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### PIR
```{r eval=TRUE}
  renderTable(tryCatch({   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_PIR))%>%head(15)%>%rename(PIR=Av_PIR)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PIR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Minutes
```{r eval=TRUE}
 renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_MIN))%>%head(15)%>%rename(MIN=Av_MIN)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,MIN)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Possession
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Av_POS))%>%head(15)%>%rename(POS=Av_POS)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,POS)},error=function(e)     
    "Sorry, there is no data for your requested combination.                       
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Offensive Rating
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(Off_Rat))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Off_Rat)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Offensive Rebounds(%)
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(ORP))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,ORP)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Assists Ratio
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(ASR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,ASR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Assists/Turnover Ratio
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(ASTOR!=Inf &Total_games>=input$Games_basic_stats)%>%
 arrange(desc(ASTOR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,ASTOR)},error=function(e)      
   "Sorry, there is no data for your requested combination.                        
 Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Turnovers ratio
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%arrange(desc(TOR))%>%
  head(15)%>%add_column(Rank=c(1:15))%>%
  select(Rank,Player,TOR)},error=function(e)      
  "Sorry, there is no data for your requested combination.                       
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Points per attempt
```{r eval=TRUE}
  renderTable(tryCatch({   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  arrange(desc(PPS))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PPS)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Free throws Ratio
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats&Total_FTA>input$Total_shoots_basic_stats)%>%
  arrange(desc(FTR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,FTR)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### USG(%)
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats& (Total_F2A+Total_F3A)>=input$Total_shoots_basic_stats)%>%
  arrange(desc(USG))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,USG)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### EFG(%)
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats& (Total_F2A+Total_F3A)>=input$Total_shoots_basic_stats)%>%
  arrange(desc(EFG))%>%head(15)%>%add_column(Rank=c(1:15))%>%select(Rank,Player,EFG)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### TS(%)
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats& (Total_F2A+Total_F3A)>=input$Total_shoots_basic_stats)%>%
  arrange(desc(TS))%>%head(15)%>%add_column(Rank=c(1:15))%>%select(Rank,Player,TS)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```


### Percent of 2 Points attempted
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,
         PA3P=round(Total_F3A/sumfg,3)*100,
         PA2P=round(Total_F2A/sumfg,3)*100,
         PAFT=round(Total_FTA/sumfg,3)*100)%>%dplyr::filter(sumfg>=input$Total_shoots_basic_stats)%>%
  arrange(desc(PA2P))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PA2P)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```


### Percent of Free throws attempted
```{r eval=TRUE}
  renderTable(tryCatch({   compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,
         PA3P=round(Total_F3A/sumfg,3)*100,
         PA2P=round(Total_F2A/sumfg,3)*100,
         PAFT=round(Total_FTA/sumfg,3)*100)%>%dplyr::filter(sumfg>=input$Total_shoots_basic_stats)%>%
  arrange(desc(PAFT))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PAFT)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

### Percent of 3 Points that attempts
```{r eval=TRUE}
  renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)
    compute_player_stats(All_Seasons,input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(Total_games>=input$Games_basic_stats)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,
         PA3P=round(Total_F3A/sumfg,3)*100,
         PA2P=round(Total_F2A/sumfg,3)*100,
         PAFT=round(Total_FTA/sumfg,3)*100)%>%dplyr::filter(sumfg>=input$Total_shoots_basic_stats)%>%
  arrange(desc(PA3P))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,PA3P)},error=function(e)      
    "Sorry, there is no data for your requested combination.                        
  Please change your input selections"),hover=TRUE,bordered=TRUE,digits=1,spacing="l")

```

# Stats Leaders (Total Stats) {data-navmenu="Player Stats"}

## {.sidebar}

```{r}
season_basic_stats_total=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_basic_stats_total",label="Select Season",choices = season_basic_stats_total,selected = "2023-2024")

phase_basic_stats_total=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_basic_stats_total",label="Phase",choices=phase_basic_stats_total)
results_basic_stats_total=rev(c("W","L",""))
selectInput("results_basic_stats_total",label="Result",choices=results_basic_stats_total)

home_away_basic_stats_total=rev(c("H","A",""))
selectInput("home_away_basic_stats_total",label="Home or Away",choices=home_away_basic_stats_total)

```


## Column {.tabset}

### Points

```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_PTS))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_PTS)%>%rename(PTS=Total_PTS)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### Defensive Rebounds
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_DR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_DR)}%>%rename(DR=Total_DR),error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### Offensive Rebounds
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_OR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_OR)%>%rename(OR=Total_OR)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### Total Rebounds
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_TR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_TR)%>%rename(TR=Total_TR)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```

### Assists
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_AS))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_AS)%>%rename(AS=Total_AS)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```
### Steals
```{r eval=TRUE}

renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_ST))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_ST)%>%rename(ST=Total_ST)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### Turnovers
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_TO))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_TO)%>%rename(TO=Total_TO)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Minutes
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_MIN))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_MIN)%>%rename(MIN=Total_MIN)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Blocks
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_BLK))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_BLK)%>%rename(BLK=Total_BLK)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Blocks Received
```{r eval=TRUE}

renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_BLKR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_BLKR)%>%rename(BLKR=Total_BLKR)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```
### Fouls
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_PF))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_PF)%>%rename(PF=Total_PF)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```

### Fouls Received

```{r eval=TRUE}

renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_RF))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_RF)%>%rename(RF=Total_RF)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```
### 2 Points Made
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F2M))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_F2M)%>%rename(F2M=Total_F2M)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```

### 2 Points Attempted
```{r eval=TRUE}

renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F2A))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_F2A)%>%rename(F2A=Total_F2A)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```

### 3 Points Made
```{r eval=TRUE}

renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F3M))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_F3M)%>%rename(F3M=Total_F3M)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### 3 Points Attempted
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F3A))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_F3A)%>%rename(F3A=Total_F3A)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```
### Free Throws Made
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_FTM))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_FTM)%>%rename(FTM=Total_FTM)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```
### Free Throws Attempted
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_FTA))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_FTA)%>%rename(FTA=Total_FTA)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```
### PIR
```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_PIR))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_PIR)%>%rename(PIR=Total_PIR)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```

### Possesions

```{r eval=TRUE}
renderTable(tryCatch({compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)
    compute_player_stats(All_Seasons,input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>% mutate(Total_POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA))%>%
  arrange(desc(Total_POS))%>%head(15)%>%add_column(Rank=c(1:15))%>%dplyr::select(Rank,Player,Total_POS)%>%rename(POS=Total_POS)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)

```


# Record stats {data-navmenu="Player Stats"}

## {.sidebar}
### {data-height=200}
```{r}
season_best_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_best_stats",label="Select Season",choices = season_best_stats)

phase_best_stats=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_best_stats",label="Phase",choices=phase_best_stats)

results_best_stats=rev(c("W","L",""))
selectInput("results_best_stats",label="Result",choices=results_best_stats)

home_away_best_stats=rev(c("H","A",""))
selectInput("home_away_best_stats",label="Home or Away ",choices=home_away_best_stats)

```
## Column {.tabset}
### Points
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,PTS,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  compute_best_stats(All_Seasons,PTS,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Minutes
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,MIN,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  compute_best_stats(All_Seasons,MIN,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### 2 Points Made
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,F2M,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,F2M,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### 2 Points Attempted
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,F2A,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,F2A,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### 3 Points Made
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,F3M,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,F3M,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### 3 Points Attempted
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,F3A,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,F3A,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```

### Free Throws Made
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,FTM,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,FTM,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Free Throws Attempted
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,FTA,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,FTA,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Offensive Rebounds
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,OR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,OR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Defensive Rebounds
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,DR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,DR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Total Rebounds
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,TR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,TR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Assists
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,AS,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,AS,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Blocks
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,BLK,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,BLK,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Blocks Received
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,BLKR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,BLKR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Steals
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,ST,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,ST,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Turnovers
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,TO,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,TO,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### Fouls Received
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,RF,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,RF,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```
### PIR
```{r}
renderTable(tryCatch({compute_best_stats(All_Seasons,PIR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats)
  data.frame(compute_best_stats(All_Seasons,PIR,input$season_best_stats,input$phase_best_stats,input$home_away_best_stats,input$results_best_stats))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",digits=0)
```



# Search Player {data-navmenu="Player Stats"}
## {.sidebar}
```{r}
players_search_player=rev(unique(All_Seasons%>%dplyr::select(Player))%>%arrange(Player))
selectInput("players_search_player",label="Select Player",choices = players_search_player,selected = "Mike  James")

season_search_player=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_search_player",label="Select Season",choices = season_search_player)

phase_search_player=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_search_player",label="Phase",choices=phase_search_player)

home_away_search_player=rev(c("H","A",""))
selectInput("home_away_search_player",label="Home or Away",choices=home_away_search_player)

results_search_player=rev(c("W","L",""))
selectInput("results_search_player",label="Result",choices=results_search_player)

```
## Column {data-width="10"}
### {data-height=500}

```{r}
mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
    gauge(data.frame(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[5])%>%filter(Category=="Offense"))$Rating,
      min = 0, max = 100, label="Offense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      ))},error=function(e) 
  "Sorry, there is no data for your requested combination. 
                      Please change your input selections"))))

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
    gauge(data.frame(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[5])%>%filter(Category=="Defense"))$Rating,
      min = 0, max = 100, label="Defense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      ))},error=function(e) 
  "Sorry, there is no data for your requested combination. 
                      Please change your input selections"))))

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
    gauge(data.frame(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[5])%>%filter(Category=="Total_Rating"))$Rating,
      min = 0, max = 100, label="Overall", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      ))},error=function(e) 
  "Sorry, there is no data for your requested combination. 
                      Please change your input selections"))))
```

## Column {data-width="10"}
### {data-height=250}

```{r}
mainPanel(width = 20,
div(style="height:400px",renderTable(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
  data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[1])},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))
mainPanel(width = 20,
div(style="height:400px",renderTable(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
  data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[2])},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))



```

## Column {data-width="10"}

### {data-height=300}

```{r}
mainPanel(width = 20,
div(style="height:400px",renderTable(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
  data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[3])},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))

mainPanel(width = 20,
div(style="height:400px",renderTable(tryCatch({player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)
  data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[4])},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))
```


## Column {data-width="20"}


### {data-height=200}
```{r}

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
div(style="height:200px",renderPlotly(plot_ly(type = 'scatterpolar',
                     r=data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[7])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[7])$Basic_Stats,
        fill = 'toself',hoverinfo='r',
        hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = input$players_search_player)%>%
  layout(
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0,100),
        tickmode = "array",
        tickvals = c(0, 25,50, 100),
        angle= 0,
        tickangle = 4
      )))
    ),
    showlegend = F
  ))
```

### {data-height=200}
```{r}

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
div(style="height:200px",renderPlotly(plot_ly(type = 'scatterpolar',
                     r=data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[8])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[8])$Shooting_Stats,
        fill = 'toself',hoverinfo='r',
        hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = input$players_search_player)%>%
  layout(
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0,100),
        tickmode = "array",
        tickvals = c(0, 25,50, 100),
        angle= 0,
        tickangle = 4
      )))
    ),
    showlegend = F
  ))
```

### {data-height=200}
```{r}

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
div(style="height:200px",renderPlotly(plot_ly(type = 'scatterpolar',
                     r=data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[9])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[9])$Advanced_Stats,
        fill = 'toself',hoverinfo='r',
        hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = input$players_search_player)%>%
  layout(
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0,100),
        tickmode = "array",
        tickvals = c(0, 25,50, 100),
        angle= 0,
        tickangle = 4
      )))
    ),
    showlegend = F
  ))
```


# Compare Players {data-navmenu="Player Stats"}
## {.sidebar}
###  {data-height=900}
<font style="font-size: 20px">First Player</font>

```{r}
players1_compare_players=rev(unique(All_Seasons%>%dplyr::select(Player)%>%add_row(Player="")%>%arrange(Player)))
mainPanel(width = 10,
div(style="height:70px",selectInput("players1_compare_players",label="Select Player",choices = players1_compare_players,selected = "Chris  Jones")))

season1_compare_players=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("season1_compare_players",label="Select Season",choices = season1_compare_players)))

phase1_compare_players=rev(c("Regular Season","Play In","Play offs","Final Four",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("phase1_compare_players",label="Phase",choices=phase1_compare_players)))

home_away1_compare_players=rev(c("H","A",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("home_away1_compare_players",label="Home or Away",choices=home_away1_compare_players)))

results1_compare_players=rev(c("W","L",""))
mainPanel(width = 10,
div(style="height:100px",selectInput("results1_compare_players",label="Result",choices=results1_compare_players)))


```


<font style="font-size: 20px">Second Player</font>

```{r}
players2_compare_players=rev(unique(All_Seasons%>%dplyr::select(Player)%>%add_row(Player="")%>%arrange(Player)))
mainPanel(width = 10,
div(style="height:70px",selectInput("players2_compare_players",label="Select Player",choices = players2_compare_players,selected = "Keenan  Evans")))

season2_compare_players=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("season2_compare_players",label="Select Season",choices = season2_compare_players)))

phase2_compare_players=rev(c("Regular Season","Play In","Play offs","Final Four",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("phase2_compare_players",label="Phase",choices=phase2_compare_players)))

home_away2_compare_players=rev(c("H","A",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("home_away2_compare_players",label="Home or Away",choices=home_away2_compare_players)))

results2_compare_players=rev(c("W","L",""))
mainPanel(width = 10,
div(style="height:100px",selectInput("results2_compare_players",label="Result",choices=results2_compare_players)))

```
## Column {data-width=7}
### {data-height="205px"}
```{r}
renderValueBox(valueBox(value=tags$p(input$players1_compare_players, style = "font-size: 65%;")))

```

```{r}
renderValueBox(valueBox(value=tags$p(input$home_away1_compare_players, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$results1_compare_players, style = "font-size: 65%;")))

```

```{r}
renderValueBox(valueBox(value=tags$p(input$phase1_compare_players, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$season1_compare_players, style = "font-size: 65%;")))
                                      
```

### {data-height=50}
```{r}
mainPanel(width = 20,
div(style="height:200px",
renderTable(tryCatch({player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)
  data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[1])%>%
                    dplyr::select(Team,Games,Minutes)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))

mainPanel(width = 20, tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(
      gauge(data.frame(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[5])%>%filter(Category=="Offense"))[,2],
      min = 0, max = 100, label="Offense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
      
mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[5])%>%filter(Category=="Defense"))[,2],
      min = 0, max = 100, label="Defense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[5])%>%filter(Category=="Total_Rating"))[,2],
      min = 0, max = 100, label="Overall", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
```

## Column {data-width=7}
### {data-height="205px"}
```{r}

renderValueBox(valueBox(value=tags$p(input$players2_compare_players, style = "font-size: 65%;")))

```

```{r}
renderValueBox(valueBox(value=tags$p(input$home_away2_compare_players, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$results2_compare_players, style = "font-size: 65%;")))

```

```{r}
renderValueBox(valueBox(value=tags$p(input$phase2_compare_players, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$season2_compare_players, style = "font-size: 65%;")))
                                      
```

### {data-height=50}
```{r}
mainPanel(width = 20,
div(style="height:200px",
renderTable(tryCatch({player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)
  data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[1])%>%
                    dplyr::select(Team,Games,Minutes)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))


mainPanel(width = 20, tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(
      gauge(data.frame(data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[5])%>%filter(Category=="Offense"))[,2],
      min = 0, max = 100, label="Offense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
      
mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[5])%>%filter(Category=="Defense"))[,2],
      min = 0, max = 100, label="Defense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))

mainPanel(width = 20,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[5])%>%filter(Category=="Total_Rating"))[,2],
      min = 0, max = 100, label="Overall", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
```

## Column {data-width="800"}


### {data-height=250}
```{r}

mainPanel(width = 110,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
div(style="height:250px",renderPlotly(plot_ly(type = 'scatterpolar',
                    
        fill = 'toself',hoverinfo='r')%>%
           add_trace(
    r=data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[7])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[7])$Basic_Stats,
    hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players," ",input$season1_compare_players," ",input$phase1_compare_players)) %>%
    add_trace(
    r=data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[7])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[7])$Basic_Stats,
    hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players," ",input$season2_compare_players," ",input$phase2_compare_players))%>%
  layout(legend = list(orientation = 'h',x = 0, y = -0.5),
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0,100),
        tickmode = "array",
        tickvals = c(0, 25,50, 100),
        angle= 0,
        tickangle = 4
      )))
    )
  ))
```
### {data-height=250}
```{r}


mainPanel(width = 80,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
div(style="height:180px",renderPlotly(plot_ly(type = 'scatterpolar',
                    
        fill = 'toself',hoverinfo='r')%>%
           add_trace(
    r=data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[8])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[8])$Shooting_Stats,
    hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players," ",input$season1_compare_players," ",input$phase1_compare_players),
    showlegend = FALSE
  ) %>%
    add_trace(
    r=data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[8])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[8])$Shooting_Stats,
    hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players," ",input$season2_compare_players," ",input$phase2_compare_players),
    showlegend = FALSE)%>%
  layout(
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0,100),
        tickmode = "array",
        tickvals = c(0, 25,50, 100),
        angle= 0,
        tickangle = 4
      )))
    )
  ))
```
### {data-height=250}
```{r}
mainPanel(width = 80,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
div(style="height:200px",renderPlotly(plot_ly(type = 'scatterpolar',
                    
        fill = 'toself',hoverinfo='r')%>%
           add_trace(
    r=data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[9])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[9])$Advanced_Stats,
    hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players," ",input$season1_compare_players," ",input$phase1_compare_players),
    showlegend = FALSE) %>%
    add_trace(
    r=data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[9])$Rating,
                     theta=data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[9])$Advanced_Stats,
    hovertemplate = 'Rating: %{r:.0f}<extra></extra>',name = paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players," ",input$season2_compare_players," ",input$phase2_compare_players),
    showlegend = FALSE)%>%
  layout(
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0,100),
        tickmode = "array",
        tickvals = c(0, 25,50, 100),
        angle= 0,
        tickangle = 4
      )))
    )
  ))
```



## Column {.tabset}

### Basic Stats {data-height=600}
```{r}
mainPanel(width = 20,
div(style="height:600px",
renderTable(tryCatch({player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)
  merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[2])%>%
        setnames(old=c("Average"),new=c("Average1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[2])%>%
        setnames(old=c("Average"),new=c("Average2")),all=TRUE)%>%
  mutate(id=c(10,5,4,8,2,1,9,11,6,7,3))%>%
    arrange(desc(id))%>%
  dplyr::select(-id)%>%
    setnames(old=c("Average1","Average2"),new=c(paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players," ",input$season1_compare_players," ",input$phase1_compare_players),
                                                paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players," ",input$season2_compare_players," ",input$phase2_compare_players)))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",digits=1)))
```
### Shooting Stats {data-height=600}
```{r}
mainPanel(width = 110,
div(style="height:600px",
renderTable(tryCatch({player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)
  merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[3])%>%
        setnames(old=c("Average"),new=c("Average1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[3])%>%
        setnames(old=c("Average"),new=c("Average2")),all=TRUE)%>%
mutate(id=c(11,12,10,8,9,7,2,3,5,6,4,1))%>%arrange(desc(id))%>%
  dplyr::select(-id)%>%
    setnames(old=c("Average1","Average2"),new=c(paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players," ",input$season1_compare_players," ",input$phase1_compare_players),
                                                paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players," ",input$season2_compare_players," ",input$phase2_compare_players)))},error=function(e) 
  "Sorry, there is no data for your requested combination. 
                      Please change your input selections")
,hover=TRUE,bordered=TRUE,spacing="xs",digits=1)))
```


### Advanced Stats {data-height=600}
```{r}

mainPanel(width = 110,
div(style="height:600px",
renderTable(tryCatch({player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)
  merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[4])%>%
        setnames(old=c("Average"),new=c("Average1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[4])%>%
        setnames(old=c("Average"),new=c("Average2")),all=TRUE)%>%
  mutate(id=c(10,9,5,7,1,5,6,8,2,3))%>%arrange(desc(id))%>%
  dplyr::select(-id)%>%
    setnames(old=c("Average1","Average2"),new=c(paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players," ",input$season1_compare_players," ",input$phase1_compare_players),
                                                paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players," ",input$season2_compare_players," ",input$phase2_compare_players)))},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",digits=1)))
```


# Player stats by team {data-navmenu="Player Stats"}

## {.sidebar}
```{r}
players_by_team=rev(unique(All_Seasons%>%select(Team)%>%add_row(Team="")%>%arrange(Team)))
selectInput("players_by_team",label="Select Team",choices = players_by_team,selected = "")

season_by_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_by_team",label="Select Season",choices = season_by_team)

phase_by_team=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_by_team",label="Phase",choices=phase_by_team)

home_away_by_team=rev(c("H","A",""))
selectInput("home_away_by_team",label="Home or Away",choices=home_away_by_team)

results_by_team=rev(c("W","L",""))
selectInput("results_by_team",label="Result",choices=results_by_team)
```

## Column {data-width="25"}
### {data-height=900}
```{r}
renderDataTable(teamplayersstats(All_Seasons,input$home_away_by_team,input$results_by_team,input$phase_by_team,input$season_by_team,input$players_by_team)%>%mutate(P2=round(P2,1),                                                                                                                                     P3=round(P3,1),
                                                                                                                                                                    PFT=round(PFT,1)),rownames=FALSE,
  options = list(scrollY = "800px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '200px',className = 'dt-center', targets = "_all"))))
```


# Player stats against each team {data-navmenu="Player Stats"}

## {.sidebar}

```{r}
players_against_each_team=rev(unique(All_Seasons%>%select(Player)%>%add_row(Player="")%>%arrange(Player)))
selectInput("players_against_each_team",label="Select Player",choices = players_against_each_team,selected = "Mike  James")

season_against_each_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_against_each_team",label="Select Season",choices = season_against_each_team)

phase_against_each_team=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_against_each_team",label="Phase",choices=phase_against_each_team)

home_away_against_each_team=rev(c("H","A",""))
selectInput("home_away_against_each_team",label="Home or Away",choices=home_away_against_each_team)

results_against_each_team=rev(c("W","L",""))
selectInput("results_against_each_team",label="Result",choices=results_against_each_team)
```

## Column {data-width="50"}

###

```{r}
renderTable(player_stats_by_team_against(All_Seasons,input$players_against_each_team,input$home_away_against_each_team,input$results_against_each_team,input$phase_against_each_team,input$season_against_each_team),rownames = TRUE,hover=TRUE,bordered=TRUE,spacing="xs",digits=1)
```

# Player stats against a team {data-navmenu="Player Stats"}

## {.sidebar}

```{r}
team_stats_against_a_team=rev(unique(All_Seasons%>%select(Team)%>%add_row(Team="")%>%arrange(Team)))
selectInput("team_stats_against_a_team",label="Select Team",choices = team_stats_against_a_team,selected="")

season_stats_against_a_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_stats_against_a_team",label="Select Season",choices = season_stats_against_a_team,selected = "2023-2024")

phase_stats_against_a_team=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_stats_against_a_team",label="Phase",choices=phase_stats_against_a_team)

home_away_stats_against_a_team=rev(c("H","A",""))
selectInput("home_away_stats_against_a_team",label="Home or Away",choices=home_away_stats_against_a_team)

results_stats_against_a_team=rev(c("W","L",""))
selectInput("results_stats_against_a_team",label="Result",choices=results_stats_against_a_team)


```

## Column {data-width="50"}
### {data-height=900}
```{r}
renderDataTable(players_stats_by_a_against_team(All_Seasons,input$team_stats_against_a_team,input$home_away_stats_against_a_team,input$results_stats_against_a_team,input$phase_stats_against_a_team,input$season_stats_against_a_team),rownames=FALSE,
  options = list(scrollY = "800px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '200px',className = 'dt-center', targets = "_all"))))
```

# Player stats by a game {data-navmenu="Player Stats"}

## {.sidebar}
```{r}
players_player_stats_by_a_game=rev(unique(All_Seasons%>%select(Player)%>%add_row(Player="")%>%arrange(Player)))
selectInput("players_player_stats_by_a_game",label="Select Player",choices = players_player_stats_by_a_game,selected = "")

season_player_stats_by_a_game=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_player_stats_by_a_game",label="Select Season",choices = season_player_stats_by_a_game)

phase_player_stats_by_a_game=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_player_stats_by_a_game",label="Phase",choices=phase_player_stats_by_a_game)

home_away_player_stats_by_a_game=rev(c("H","A",""))
selectInput("home_away_player_stats_by_a_game",label="Home or Away",choices=home_away_player_stats_by_a_game)

results_player_stats_by_a_game=rev(c("W","L",""))
selectInput("results_player_stats_by_a_game",label="Result",choices=results_player_stats_by_a_game)


```
## Column {data-width="80"}
### {data-height=900}
```{r}
renderDataTable(All_Seasons%>%dplyr::filter(grepl(input$season_player_stats_by_a_game,Season)&grepl(input$home_away_player_stats_by_a_game,HA)&grepl(input$results_player_stats_by_a_game,results)&grepl(input$phase_player_stats_by_a_game,Phase)&Player==input$players_player_stats_by_a_game)%>%separate(IDGAME,c("Fixture","Game#"),"_")%>%
                  mutate(PRA=PTS+TR+AS,PR=PTS+TR,PA=PTS+AS,RA=TR+AS,PB=PTS+BLK,SB=ST+BLK,Fixture=as.numeric(Fixture))%>%arrange(Fixture)%>%
                  dplyr::select(Season,Fixture,Phase,Team,Against,Player,MIN,PTS,F2M,F2A,F2GP,F3M,F3A,F3GP,FTM,FTA,FTP,OR,DR,TR,AS,ST,TO,BLK,BLKR,PRA,PA,PR,RA,PB,SB,PF,RF,PIR,HA,results,Points_per_shoot,Possesions,Offensive_rating,PIE,Assists_Ratio,As_To_ratio,EFG,FT_ratio,Game_score,True_shooting,Turnover_ratio,Usage,OR_percent),rownames=FALSE,
  options = list(scrollY = "800px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '200px',className = 'dt-center', targets = "_all"))))
```


# Find stats for a Game 

## {data-width=5}
```{r}

game=rev(unique(All_Seasons%>%separate(IDGAME,c("Fixture","Game#"),"_")%>%
    mutate(fix_teams=ifelse(HA=="H",
                          paste0(Fixture," / ",Season," / ",Team,"-",Against),
                          paste0(Fixture," / ",Season," / ",Against,"-",Team)))%>%select(fix_teams)))
selectInput("game",label="Select Game",choices = game)

```


### {data-height=100}
```{r}
renderTable(data.frame(t(data.frame(findgamestats(All_Seasons,input$game)[2])%>%column_to_rownames("Team"))),spacing="xs",rownames = T)
```

## Column {data-width=35}
### {data-height=900}
```{r}
renderDataTable(data.frame(findgamestats(All_Seasons,input$game)[1]),rownames=FALSE,
  options = list(scrollY = "800px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '200px',className = 'dt-center', targets = "_all"))))
```

# Team Ranking {data-navmenu="Team Stats"}

## {.sidebar}
 

```{r}

results_team_ranking=rev(c("W","L",""))
selectInput("results_team_ranking",label="Result",choices=results_team_ranking)

phase_team_ranking=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_team_ranking",label="Phase",choices=phase_team_ranking)

home_away_team_ranking=rev(c("H","A",""))
selectInput("home_away_team_ranking",label="Home or Away",choices=home_away_team_ranking)

season_team_ranking=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_ranking",label="Select Season",choices = season_team_ranking,selected = "2023-2024")
```

## Column {.tabset}

### Team Rankings (Wins-Loses) {data-height=900}
```{r}
renderDataTable(compute_team_stats(All_Seasons,input$home_away_team_ranking,input$results_team_ranking,input$phase_team_ranking,input$season_team_ranking)%>%
        dplyr::select(Team,Games,PTS,opp_PTS,Diff,Wins,Loses,Win_Per),rownames=FALSE,
  options = list(scrollY = "700px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '150px',className = 'dt-center', targets = "_all"))))
```

###  Team Points by Period {data-height=900}

```{r}
renderDataTable(data.frame(period_points(All_Seasons_res,"",input$season_team_ranking,input$phase_team_ranking,input$home_away_team_ranking,input$results_team_ranking)[1]),rownames=FALSE,
  options = list(scrollY = "700px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))
```


###  Team Wins by Period {data-height=900}

```{r}
renderDataTable(data.frame(period_points(All_Seasons_res,"",input$season_team_ranking,input$phase_team_ranking,input$home_away_team_ranking,input$results_team_ranking)[3]),rownames=FALSE,
  options = list(scrollY = "700px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))
```

### Team Basic Stats {data-height=900}

```{r}
renderDataTable(compute_team_stats(All_Seasons,input$home_away_team_ranking,input$results_team_ranking,input$phase_team_ranking,input$season_team_ranking)%>%dplyr::select(Team,AS,opp_AS,OR,opp_OR,DR,opp_DR,TR,opp_TR,TO,opp_TO,ST,opp_ST,BLK,BLKR,PF,RF,PIR,opp_PIR),rownames=FALSE,
  options = list(scrollY = "700px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))
```

###  Team Shooting Stats {data-height=900}
```{r}
renderDataTable(compute_team_stats(All_Seasons,input$home_away_team_ranking,input$results_team_ranking,input$phase_team_ranking,input$season_team_ranking)%>%
  dplyr::select(Team,F2M,F2A,P2,F3M,F3A,P3,FTM,FTA,PFT,opp_F2M,opp_F2A,opp_P2,opp_F3M,opp_F3A,opp_P3,opp_FTM,opp_FTA,opp_PFT)%>%
    mutate(P2=round(P2,1),opp_P2=round(opp_P2,1),P3=round(P3,1),opp_P3=round(opp_P3,1),PFT=round(PFT,1),opp_PFT=round(opp_PFT,1)),rownames=FALSE,
  options = list(scrollY = "700px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))

```

### Team Advanced Stats {data-height=900}

```{r}
renderDataTable(compute_team_stats(All_Seasons,input$home_away_team_ranking,input$results_team_ranking,input$phase_team_ranking,input$season_team_ranking)%>%
  dplyr::select(Team,PPS,opp_PPS,ASFG,opp_ASFG,ASR,opp_ASR,ASTOR,opp_ASTOR,EFG,opp_EFG,TS,opp_TS,FTR,opp_FTR,POS,opp_POS,OFF_RAT,DEF_RAT,NET_RAT,TOR,opp_TOR),rownames=FALSE,
  options = list(scrollY = "700px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))
```

# Team stats by a game {data-navmenu="Team Stats"}



## {.sidebar}
```{r}
teams_team_stats_by_a_game=rev(unique(All_Seasons%>%select(Team)%>%add_row(Team="")%>%arrange(Team)))
selectInput("teams_team_stats_by_a_game",label="Select Team",choices = teams_team_stats_by_a_game,selected = "")

season_team_stats_by_a_game=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_stats_by_a_game",label="Select Season",choices = season_team_stats_by_a_game,selected = "2023-2024")

phase_team_stats_by_a_game=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_team_stats_by_a_game",label="Phase",choices=phase_team_stats_by_a_game)

home_away_team_stats_by_a_game=rev(c("H","A",""))
selectInput("home_away_team_stats_by_a_game",label="Home or Away",choices=home_away_team_stats_by_a_game)

results_team_stats_by_a_game=rev(c("W","L",""))
selectInput("results_team_stats_by_a_game",label="Result",choices=results_team_stats_by_a_game)

stat_team_stats_by_a_game=rev(c("PTS","AS","F2","F3","FT","OR","DR","TR","TO","ST","BLK"))
selectInput("stat_team_stats_by_a_game",label="Stat",choices = stat_team_stats_by_a_game)

```


## Column {.tabset}

### All Stats {data-height=900}

```{r}
renderDataTable(team_stats_by_a_game(All_Seasons,All_Seasons_res,input$teams_team_stats_by_a_game,input$home_away_team_stats_by_a_game,input$phase_team_stats_by_a_game,input$results_team_stats_by_a_game,input$season_team_stats_by_a_game)%>%arrange(Fixture),rownames=FALSE,
  options = list(scrollY = "800px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))
```


### Select Stat {data-height=900}

```{r}
renderDataTable(team_stats_by_a_game(All_Seasons,All_Seasons_res,input$teams_team_stats_by_a_game,input$home_away_team_stats_by_a_game,input$phase_team_stats_by_a_game,input$results_team_stats_by_a_game,input$season_team_stats_by_a_game)%>%
                  select(Season,Fixture,Phase,Result,HA,Against,tidyr::contains(input$stat_team_stats_by_a_game))%>%arrange(Fixture),rownames=FALSE,
  options = list(scrollY = "800px",scrollX = TRUE, searching = FALSE,paging=FALSE,lengthChange = FALSE,info=FALSE,
  columnDefs = list(list(width = '60px',className = 'dt-center', targets = "_all"))))
```

# Head to Head Teams {data-navmenu="Team Stats"}

## {.sidebar}
###  {data-height=2500}
<font style="font-size: 18px">First Team</font>

```{r}
Team1_compare_team=rev(unique(All_Seasons%>%select(Team)%>%arrange(Team)))
mainPanel(width = 10,
div(style="height:70px",selectInput("Team1_compare_team",label="Select Team",choices = Team1_compare_team,selected = "ASM", width = '70%')))

season1_compare_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("season1_compare_team",label="Select Season",choices = season1_compare_team, width = '70%')))

phase1_compare_team=rev(c("Regular Season","Play In","Play offs","Final Four",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("phase1_compare_team",label="Phase",choices=phase1_compare_team, width = '70%')))

results1_compare_team=rev(c("W","L",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("results1_compare_team",label="Result",choices=results1_compare_team, width = '70%')))

home_away1_compare_team=rev(c("H","A",""))
mainPanel(width = 10,
div(style="height:100px",selectInput("home_away1_compare_team",label="Home or Away",choices=home_away1_compare_team, width = '70%')))

```


<font style="font-size: 20px">Second Team</font>

```{r}
Team2_compare_team=rev(unique(All_Seasons%>%select(Team)%>%add_row(Team="")%>%arrange(Team)))
mainPanel(width = 10,
div(style="height:70px",selectInput("Team2_compare_team",label="Select Team",choices = Team2_compare_team,selected = "BAR", width = '70%')))

season2_compare_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("season2_compare_team",label="Select Season",choices = season2_compare_team, width = '70%')))

phase2_compare_team=rev(c("Regular Season","Play In","Play offs","Final Four",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("phase2_compare_team",label="Phase",choices=phase2_compare_team, width = '70%')))

results2_compare_team=rev(c("W","L",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("results2_compare_team",label="Result",choices=results2_compare_team, width = '70%')))

home_away2_compare_team=rev(c("H","A",""))
mainPanel(width = 10,
div(style="height:70px",selectInput("home_away2_compare_team",label="Home or Away",choices=home_away2_compare_team, width = '70%')))
```

## Column {data-width=200}

### {data-height="205px"}
```{r}
renderValueBox(valueBox(value=tags$p(input$Team1_compare_team, style = "font-size: 65%;")))
```

```{r}
renderValueBox(valueBox(value=tags$p(input$season1_compare_team, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$phase1_compare_team, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$home_away1_compare_team, style = "font-size: 65%;")))

```

```{r}
renderValueBox(valueBox(value=tags$p(input$results1_compare_team, style = "font-size: 65%;")))

```
### {data-height=450}

```{r}

mainPanel(width = 150, tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",
      renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$results1_compare_team,input$home_away1_compare_team)%>%filter(Category=="Offense"))[,2],
      min = 0, max = 100, label="Offense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
      
mainPanel(width = 150,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$results1_compare_team,input$home_away1_compare_team)%>%filter(Category=="Defense"))[,2],
      min = 0, max = 100, label="Defense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))

mainPanel(width = 150,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:50px",renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$results1_compare_team,input$home_away1_compare_team)%>%filter(Category=="Total"))[,2],
      min = 0, max = 100, label="Overall", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
```


## Column {data-width=200}
### {data-height="205px"}
```{r}
renderValueBox(valueBox(value=tags$p(input$Team2_compare_team, style = "font-size: 65%;")))
```

```{r}
renderValueBox(valueBox(value=tags$p(input$season2_compare_team, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$phase2_compare_team, style = "font-size: 65%;")))
                                      
```

```{r}
renderValueBox(valueBox(value=tags$p(input$home_away2_compare_team, style = "font-size: 65%;")))

```

```{r}
renderValueBox(valueBox(value=tags$p(input$results2_compare_team, style = "font-size: 65%;")))

```

### {data-height=450}

```{r}

mainPanel(width = 150, tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",
      renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$results2_compare_team,input$home_away2_compare_team)%>%filter(Category=="Offense"))[,2],
      min = 0, max = 100, label="Offense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
      
mainPanel(width = 150,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$results2_compare_team,input$home_away2_compare_team)%>%filter(Category=="Defense"))[,2],
      min = 0, max = 100, label="Defense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))

mainPanel(width = 150,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:50px",renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$results2_compare_team,input$home_away2_compare_team)%>%filter(Category=="Total"))[,2],
      min = 0, max = 100, label="Overall", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
```


## Column {.tabset}


### Period Points
```{r}
mainPanel(width = 20,
div(style="height:400px",renderTable(tryCatch({data.frame(period_points(All_Seasons_res,input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[2])
  merge(data.frame(period_points(All_Seasons_res,input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[2])%>%setnames(old=c("Points",new=c(paste(input$Team1_compare_team,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team,sep=" ")))),
        data.frame(period_points(All_Seasons_res,input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[2])%>%setnames(old=c("Points",new=c(paste(input$Team2_compare_team,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team,sep=" ")))))%>%
  add_column(arr=c(1,2,9,10,13,14,11,12,7,8,5,6,3,4))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))


```
### Basic Stats {data-height=100}
```{r}
mainPanel(width = 20,
div(style="height:750px",renderTable(merge(compute_team_stats(All_Seasons,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team)%>%filter(Team==input$Team1_compare_team)%>%reshape2::melt()%>%
  dplyr::filter(grepl("PIR|PTS|AS|BLK|DR|RF|PF|ST|TR|TO|OR",variable)&
                  !grepl("ASR|PFT|Total_|TOR|FTR|ASFG|opp_BLK|opp_RF|opp_PF",variable))%>%
    setnames(old=c("value"),new=c(paste(input$Team1_compare_team,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team,sep=" ")))%>%
    select(-Team),
  compute_team_stats(All_Seasons,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team)%>%filter(Team==input$Team2_compare_team)%>%reshape2::melt()%>%
    dplyr::filter(grepl("PIR|PTS|AS|BLK|DR|RF|PF|ST|TR|TO|OR",variable)&
                    !grepl("ASR|PFT|Total_|TOR|FTR|ASFG|opp_BLK|opp_RF|opp_PF",variable))%>%setnames(old=c("value"),new=c(paste(input$Team2_compare_team,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team,sep=" ")))%>%select(-Team))%>%
  add_column(arr=c(18,
6,
5,
16,
17,
13,
12,
1,
19,
9,
7,
11,
15,
4,
2,
20,
3,
10,
8,
14))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)%>%
  mutate(variable=str_replace(variable,"opp_PTS","Points Conceed"),
         variable=str_replace(variable,"PTS","Points"),
         variable=str_replace(variable,"opp_AS","Assists allowed"),
         variable=str_replace(variable,"AS","Assists"),
         variable=str_replace(variable,"opp_DR","Def Reb opp taken"),
         variable=str_replace(variable,"DR","Def Reb taken"),
         variable=str_replace(variable,"opp_OR","Off Reb opp taken"),
         variable=str_replace(variable,"OR","Off Reb taken"),
         variable=str_replace(variable,"opp_TR","Total Reb opp taken"),
         variable=str_replace(variable,"TR","Total Reb taken"),
         variable=str_replace(variable,"opp_ST","opp Steals"),
         variable=str_replace(variable,"ST","Steals"),
         variable=str_replace(variable,"opp_TO","opp Turnovers"),
         variable=str_replace(variable,"TO","Turnovers"),
         variable=str_replace(variable,"BLKR","Blocks received"),
         variable=str_replace(variable,"BLK","Blocks"),
         variable=str_replace(variable,"RF","Fouls drawn"),
         variable=str_replace(variable,"PF","Fouls"),
         variable=str_replace(variable,"_"," "))%>%
  rename("Basic Stats"=variable),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))

```
### Shooting Stats {data-height=100}
```{r}
renderTable(merge(compute_team_stats(All_Seasons,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team)%>%filter(Team==input$Team1_compare_team)%>%reshape2::melt()%>%
  dplyr::filter(grepl("F2A|F2M|P2|F3A|F3M|P3|FTA|FTM|PFT|FTR|EFG|TS|PPS",variable)&
                  !grepl("PTS|Total_",variable))%>%setnames(old=c("value"),new=c(paste(input$Team1_compare_team,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team,sep=" ")))%>%select(-Team),
  compute_team_stats(All_Seasons,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team)%>%filter(Team==input$Team2_compare_team)%>%reshape2::melt()%>%
    dplyr::filter(grepl("F2A|F2M|P2|F3A|F3M|P3|FTA|FTM|PFT|FTR|EFG|TS|PPS",variable)&
                    !grepl("PTS|Total_",variable))%>%setnames(old=c("value"),new=c(paste(input$Team2_compare_team,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team,sep=" ")))%>%select(-Team))%>%
  add_column(arr=c(8,
25,
26,
19,
20,
13,
14,
4,
7,
22,
23,
16,
17,
10,
11,
3,
21,
15,
9,
1,
5,
24,
18,
12,
2,
6))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)%>%
  mutate(variable=str_replace(variable,"_"," "),
         variable=str_replace(variable,"F2M","2P made"),
         variable=str_replace(variable,"F2A","2P attempted"),
         variable=str_replace(variable,"P2","2P(%)"),
         variable=str_replace(variable,"F3M","3P made"),
         variable=str_replace(variable,"F3A","3P attempted"),
         variable=str_replace(variable,"P3","3P(%)"),
         variable=str_replace(variable,"FTM","Free throw made"),
         variable=str_replace(variable,"FTA","Free throw attempted"),
         variable=str_replace(variable,"PFT","FT(%)"),
         variable=str_replace(variable,"FTR","Free throw Ratio"),
         variable=str_replace(variable,"TS","True Shooting"),
         variable=str_replace(variable,"PPS","Points per 100 Shoots"))%>%
  rename("Shooting Stats"=variable),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=2)
```

### Advanced Stats {data-height=100}
```{r}
mainPanel(width = 25,
div(style="height:450px",renderTable(merge(compute_team_stats(All_Seasons,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team)%>%filter(Team==input$Team1_compare_team)%>%reshape2::melt()%>%
  dplyr::filter(grepl("ASFG|TOR|ASR|RAT|POS",variable)&
                  !grepl("Total_",variable))%>%setnames(old=c("value"),new=c(paste(input$Team1_compare_team,input$home_away1_compare_team,input$results1_compare_team,input$phase1_compare_team,input$season1_compare_team,sep=" ")))%>%select(-Team),
  compute_team_stats(All_Seasons,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team)%>%filter(Team==input$Team2_compare_team)%>%reshape2::melt()%>%
    dplyr::filter(grepl("ASFG|TOR|ASR|RAT|POS",variable)&
                    !grepl("Total_",variable))%>%setnames(old=c("value"),new=c(paste(input$Team2_compare_team,input$home_away2_compare_team,input$results2_compare_team,input$phase2_compare_team,input$season2_compare_team,sep=" ")))%>%select(-Team))%>%
  add_column(arr=c(13,
11,
9,
2,
1,
3,
12,
10,
8,
4,
6,
5,
7))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)%>%
  mutate(variable=str_replace(variable, "_", " "),
         variable=str_replace(variable, "ASR", "Assists Ratio"),
         variable=str_replace(variable, "ASTOR", "Assists/Turnover Ratio"),
         variable=str_replace(variable, "DEF RAT", "Defensive Rating"),
         variable =str_replace(variable, "OFF RAT", "Offensive Rating"),
         variable = str_replace(variable, "NET RAT", "Net Rating"),
         variable =str_replace(variable, "EFG", "EFG(%)"),
         variable =str_replace(variable, "POS", "Possesions"),
         variable =str_replace(variable, "TOR", "Turnover Ratio"),
         variable =str_replace(variable, "ASFG", "Assisted Field goal"))%>%
  rename("Advanced Stats"=variable),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))

```


##  {data-width=250}
### Between Teams {data-height=700}
```{r}
season_team_between=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_between",label="Select Season",choices = season_team_between, width = '70%')

phase_team_between=rev(c("Regular Season","Play In","Play offs","Final Four",""))
selectInput("phase_team_between",label="Phase",choices=phase_team_between, width = '70%')

renderTable(games_between_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$phase_team_between,input$season_team_between,input$home_away1_compare_team,input$home_away2_compare_team),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=0)
```

### {data-height=250}

```{r}
mainPanel(width = 20,
div(style="height:350px",renderTable(tryCatch({head_to_head_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$season_team_between,input$phase_team_between)
  data.frame(head_to_head_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$season_team_between,input$phase_team_between))%>%
    dplyr::filter(grepl("Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&Stats!="Assists_ratio")%>%
    add_column(arr=c(8,4,7,1,6,9,3,5,2))%>%arrange(desc(arr))%>%
    dplyr::select(-arr)%>%mutate(Stats=str_replace(Stats,"_"," "))%>%
    dplyr::rename("Basic Stats"=Stats)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))
```
##  {data-width=250}
### {data-height=550}

```{r}
mainPanel(width = 20,
div(style="height:350px",renderTable(tryCatch({head_to_head_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$season_team_between,input$phase_team_between)
  data.frame(head_to_head_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$season_team_between,input$phase_team_between))%>%
    dplyr::filter(grepl("Field_goal_2p_attemped|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats))%>%
    add_column(arr=c(5,6,2,3,8,9,4,1,7))%>%
    arrange(desc(arr))%>%dplyr::select(-arr)%>%
    mutate(Stats=str_replace(Stats,"Field_goal_",""),
           Stats=str_replace(Stats,"Percentage_FT","FT(%)"),
           Stats=str_replace(Stats,"Percentage_2P","2P(%)"),
           Stats=str_replace(Stats,"Percentage_3P","3P(%)"),
      Stats=str_replace(Stats,"_"," "))%>%
    dplyr::rename("Shooting Stats"=Stats)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))


mainPanel(width = 70,
div(style="height:450px",renderTable(tryCatch({head_to_head_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$season_team_between,input$phase_team_between)
  data.frame(head_to_head_teams(All_Seasons,input$Team1_compare_team,input$Team2_compare_team,input$season_team_between,input$phase_team_between))%>%
    dplyr::filter(grepl("PIR|Assists_ratio|FT_ratio|Offensive_Rating|Turnover_ratio|EFG|True_Shooting|Possesions|As_To_Ratio",Stats))%>%
    mutate(Stats=str_replace(Stats,"EFG","EFG(%)"),
           Stats=str_replace(Stats,"Assists_ratio","Assists Ratio(%)"),
           Stats=str_replace(Stats,"True_Shooting","True Shooting(%)"),
           Stats=str_replace(Stats,"Turnover_ratio","Turnover Ratio(%)"),
           Stats=str_replace(Stats,"As_To_Ratio","Assists/Turnover Ratio"),
      Stats=str_replace(Stats,"_"," "))%>%
    dplyr::rename("Advanced Stats"=Stats)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="xs",width="1px",digits=1)))

```


# Search Team {data-navmenu="Team Stats"}
## {.sidebar}
###  {data-height=900}
```{r}

Teams_search_team=rev(unique(All_Seasons%>%select(Team)%>%arrange(Team)))
mainPanel(width = 20,
div(style="height:70px",selectInput("Teams_search_team",label="Select Team",choices = Teams_search_team)))

season_search_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
mainPanel(width = 20,
div(style="height:70px",selectInput("season_search_team",label="Select Season",choices = season_search_team,selected = "2023-2024")))

phase_search_team=rev(c("Regular Season","Play In","Play offs","Final Four",""))
mainPanel(width = 20,
div(style="height:70px",selectInput("phase_search_team",label="Phase",choices=phase_search_team)))

home_away_search_team=rev(c("H","A",""))
mainPanel(width = 20,
div(style="height:70px",selectInput("home_away_search_team",label="Home or Away",choices=home_away_search_team)))

results_search_team=rev(c("W","L",""))
mainPanel(width = 20,
div(style="height:70px",selectInput("results_search_team",label="Result",choices=results_search_team)))
```
## Column {data-width=200}
###  {data-height=500}
```{r}
mainPanel(width = 12, tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",
      renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Teams_search_team,input$season_search_team,input$phase_search_team,input$results_search_team,input$home_away_search_team)%>%filter(Category=="Offense"))[,2],
      min = 0, max = 100, label="Offense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))
      
mainPanel(width = 12,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:150px",renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Teams_search_team,input$season_search_team,input$phase_search_team,input$results_search_team,input$home_away_search_team)%>%filter(Category=="Defense"))[,2],
      min = 0, max = 100, label="Defense", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))

mainPanel(width = 12,tags$style(type="text/css",
      ".shiny-output-error { visibility: hidden; }",
      ".shiny-output-error:before { visibility: hidden; }"),
  div(style="height:50px",renderGauge(gauge(data.frame(rating_teams(All_Seasons,input$Teams_search_team,input$season_search_team,input$phase_search_team,input$results_search_team,input$home_away_search_team)%>%filter(Category=="Total"))[,2],
      min = 0, max = 100, label="Overall", gaugeSectors(
        success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
      )))))

```

## Column {.tabset}
### Games {data-height=900}
```{r}
mainPanel(width = 20,
div(style="height:1000px",renderTable(data.frame(Games_summary(All_Seasons_res,input$Teams_search_team,input$season_search_team))%>%filter(grepl(input$phase_search_team,For)),hover=TRUE,bordered=TRUE,spacing="l",width="1px",digits=0)))
```
### Points by Period {data-height=1000}
```{r}
mainPanel(width = 20,
div(style="height:700px",renderTable(tryCatch({data.frame(period_points(All_Seasons_res,input$Teams_search_team,input$season_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team)[2])
  data.frame(period_points(All_Seasons_res,input$Teams_search_team,input$season_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team)[2])},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",width="1px",digits=1)))
```

### Basic Stats {data-height=1000}
```{r}
mainPanel(width = 20,
div(style="height:700px",renderTable(tryCatch({compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%filter(Team==input$Teams_search_team)
  merge(compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%
  dplyr::filter(grepl("PIR|PTS|AS|BLK|DR|PF|ST|TR|TO|OR",variable)&
                  !grepl("ASR|PFT|Total_|ASFG|TOR|FTR|BLKR|opp_",variable))%>%
  rename("Basic Stats"=variable1)%>%filter(Team==input$Teams_search_team)%>%setnames(old=c("value"),new=c(input$Teams_search_team))%>%select(-Team,-variable),
  compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%
  dplyr::filter(grepl("opp_PIR|opp_PTS|opp_AS|BLKR|opp_DR|RF|opp_ST|opp_TR|opp_TO|opp_OR",variable)&
                  !grepl("ASR|PFT|Total_|TOR|ASFG|FTR|opp_RF|opp_BLKR",variable))%>%
  rename("Basic Stats"=variable1)%>%filter(Team==input$Teams_search_team)%>%setnames(old=c("value"),new=c("Opponents"))%>%select(-Team,-variable),all=TRUE)%>%
    add_column(arr=c(9,
                   3,
                   7,
                   2,
                   8,
                   1,
                   10,
                   5,
                   6,
                   4))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)},error=function(e) 
  "Sorry, there is no data for your requested combination. 
                      Please change your input selections")
  ,hover=TRUE,bordered=TRUE,spacing="l",width="1px",digits=1)))

```
### Shooting Stats {data-height=1000}
```{r}
mainPanel(width = 25,
div(style="height:700px",renderTable(tryCatch({compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%filter(Team==input$Teams_search_team)
  merge(compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%
  dplyr::filter(grepl("F2A|F2M|P2|F3A|F3M|P3|FTA|FTM|PFT|FTR|EFG|TS|PPS",variable)&
                  !grepl("PTS|Total_|opp_",variable))%>%
  rename("Shooting Stats"=variable1)%>%filter(Team==input$Teams_search_team)%>%setnames(old=c("value"),new=c(input$Teams_search_team))%>%select(-Team,-variable),
  compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%
  dplyr::filter(grepl("opp_F2A|opp_F2M|opp_P2|opp_F3A|opp_F3M|opp_P3|opp_FTA|opp_FTM|opp_PFT|opp_FTR|opp_EFG|opp_TS|opp_PPS",variable)&
                  !grepl("PTS|Total_",variable))%>%
  rename("Shooting Stats"=variable1)%>%filter(Team==input$Teams_search_team)%>%setnames(old=c("value"),new=c("Opponents"))%>%select(-Team,-variable),all=TRUE) %>%
          add_column(arr=c(12,
                           13,
                           11,
                           9,
                           10,
                           8,
                           3,
                           6,
                           7,
                           4,
                           5,
                           1,
                           2))%>%
          arrange(desc(arr))%>%
          dplyr::select(-arr)},error=function(e) 
  "Sorry, there is no data for your requested combination. 
                      Please change your input selections")
  ,hover=TRUE,bordered=TRUE,spacing="l",width="1px",digits=2)))

```
### Advanced Stats {data-height=1000}
```{r}
mainPanel(width = 25,
div(style="height:700px",renderTable(tryCatch({compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%filter(Team==input$Teams_search_team)
  merge(compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%
  dplyr::filter(grepl("ASFG|TOR|ASR|OFF_RAT|POS",variable)&
                  !grepl("Total_|opp_",variable))%>%
  rename("Advanced Stats"=variable1)%>%filter(Team==input$Teams_search_team)%>%setnames(old=c("value"),new=c(input$Teams_search_team))%>%select(-Team,-variable),
  compute_stats_team_rename(All_Seasons,input$home_away_search_team,input$results_search_team,input$phase_search_team,input$season_search_team)%>%
  dplyr::filter(grepl("opp_ASFG|opp_TOR|opp_ASTOR|opp_ASR|DEF_RAT|opp_POS",variable)&
                  !grepl("Total_",variable))%>%
  rename("Advanced Stats"=variable1)%>%filter(Team==input$Teams_search_team)%>%setnames(old=c("value"),new=c("Opponents"))%>%select(-Team,-variable),all=TRUE)},error=function(e) 
    "Sorry, there is no data for your requested combination. 
                      Please change your input selections"),hover=TRUE,bordered=TRUE,spacing="l",width="1px",digits=1)))


```

# Glossary of Euroleague Stats

### {data-height=1000}
```{r}
Glossary%>%DT::datatable(rownames=FALSE,filter = 'top',options=list(scrollX = TRUE, sScrollY = '800px',pageLength = 100,info=FALSE,paging=FALSE))
```


