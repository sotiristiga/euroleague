---
title: "Euroleague stats"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(rlang)
library(tidyverse)
library(skimr)      
library(ggthemes)
library(patchwork)  
library(corrplot)
library(caret)      
library(mlr)        
library(rpart)      
library(rpart.plot)
library(ranger)     
library(lightgbm)
library(DataExplorer)
library(MASS)
library(ggplot2)
library(ggthemes)
library(RColorBrewer) 
library(gridExtra)
library(kableExtra)
library(data.table)
library(dplyr)
library(lessR)
library(rpart)
library(car)
library(scales)
library(pastecs)
library(ggpubr)
library(factoextra)
library(ggrepel)
library(gridExtra)
library(readxl)
library(XML)
library(RCurl)
library(httr)
library(stringr)
library(tidyverse)
library(skimr)      
library(ggthemes)
library(patchwork)  
library(corrplot)
library(caret)      
library(mlr)        
library(rpart)      
library(rpart.plot)
library(ranger)     
library(lightgbm)
library(DataExplorer)
library(MASS)
library(ggplot2)
library(ggthemes)
library(RColorBrewer) 
library(gridExtra)
library(kableExtra)
library(data.table)
library(dplyr)
library(lessR)
library(rpart)
library(car)
library(scales)
library(pastecs)
library(ggpubr)
library(factoextra)
library(ggrepel)
library(gridExtra)
library(readxl)
library(devtools)
library(stats)
library(remotes)
library(cli)
library(githubinstall)
library(openxlsx)
library(plyr)
library("lubridate")
library(shiny)
library(flexdashboard)
library(plotly)
library(rsconnect)

Season_2019_2020=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2019_2020_playerstats_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Player_Team=paste0(Player,"(",Team,")"))
Season_2020_2021=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2020_2021_playerstats_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Player_Team=paste0(Player,"(",Team,")"))
Season_2021_2022=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2021_2022_playerstats_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Player_Team=paste0(Player,"(",Team,")"))
Season_2022_2023=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2022_2023_playerstats_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Player = str_replace(Player, "Nazareth", "Naz"),Player_Team=paste0(Player,"(",Team,")"))
Season_2023_2024=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2023_2024_playerstats_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Player_Team=paste0(Player,"(",Team,")"))


All_Seasons=rbind(Season_2019_2020,Season_2020_2021,Season_2021_2022,Season_2022_2023,Season_2023_2024)%>%
  mutate(idseason=paste0(IDGAME,"_",Season),
         fix_teams=ifelse(HA=="H",
                          paste0(IDGAME," / ",Season," / ",Team,"-",Against),
                          paste0(IDGAME," / ",Season," / ",Against,"-",Team)))


Season_2019_2020res=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2019_2020_results_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Season="2019-2020")
Season_2020_2021res=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2020_2021_results_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Season="2020-2021")
Season_2021_2022res=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2021_2022_results_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Season="2021-2022")
Season_2022_2023res=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2022_2023_results_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Season="2022-2023")

Season_2023_2024res=read_excel("C:/Users/surve/OneDrive/Desktop/Tiganitas work/EUROLEAGUE/stats/basketnews stats/euroleague_2023_2024_results_by_basketnews.xlsx",sheet = "Sheet 1")%>%mutate(Season="2023-2024")


All_Seasons_res=rbind(Season_2019_2020res,Season_2020_2021res,Season_2021_2022res,Season_2022_2023res,Season_2023_2024res)%>%mutate(idseason=paste0(IDGAME,"_",Season))

compute_stats=function(dataset_players,category,stat,names,ha,wl,ph,season){
  nplayers1=nrow(unique(dataset_players%>%
                          dplyr::filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
                          dplyr::group_by({{category}})%>%
                          dplyr::summarise(Total=n())))
  
  compute_games=dataset_players%>%
    dplyr::filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
    group_by(idseason,{{category}})%>%
    dplyr::summarise(Total_games=n())%>%
    group_by({{category}})%>%
    dplyr::summarise(Total_games=n())%>%
    merge(dataset_players%>%
            dplyr::filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
            group_by({{category}})%>%
            dplyr::summarise(Total=sum({{stat}},na.rm=T)),all.x =F)%>%
    mutate(Average=round(Total/Total_games,2))%>%
    arrange(desc(Average))%>%
    dplyr::rename(Name={{category}})%>%
    add_column(position=nplayers1:1,rating=round(position*100/nplayers1,0))%>%
    dplyr::select(-position)%>%
    setnames(old=c("Total_games","Total","Average","rating"),
             new=c("G",paste0("Total_",{{names}}),paste0("Average_",{{names}}),paste0("Rating_",{{names}})))
  
  return(compute_games)
}

player_stats=function(dp,p1,ha,wl,ph,season){
  nplayers=nrow(unique(dp%>%dplyr::filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)&grepl({{season}},Season))%>%
                         dplyr::group_by(Player)%>%
                         dplyr::summarise(Total=n())))
  table=merge(compute_stats(dp,Player,PTS,"PTS",{{ha}},{{wl}},{{ph}},{{season}}),
              compute_stats(dp,Player,AS,"AS",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,ST,"ST",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,MIN,"MIN",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,DR,"DR",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,OR,"OR",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,TR,"TR",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,BLK,"BLK",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,BLKR,"BLKR",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    dplyr::select(-Rating_BLKR)%>%arrange(desc(Average_BLKR))%>%
    add_column(position=1:nplayers,Rating_BLKR=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    merge(compute_stats(dp,Player,TO,"TO",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    dplyr::select(-Rating_TO)%>%arrange(desc(Average_TO))%>%
    add_column(position=1:nplayers,Rating_TO=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    merge(compute_stats(dp,Player,PF,"PF",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    dplyr::select(-Rating_PF)%>%arrange(desc(Average_PF))%>%
    add_column(position=1:nplayers,Rating_PF=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    merge(compute_stats(dp,Player,RF,"RF",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,F2M,"F2M",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,F2A,"F2A",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    mutate(P2=100*round(Total_F2M/Total_F2A,3))%>%arrange(desc(Average_F2A))%>%arrange(desc(P2))%>%
    add_column(position=nplayers:1,rating_P2=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    merge(compute_stats(dp,Player,F3M,"F3M",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,F3A,"F3A",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    mutate(P3=100*round(Total_F3M/Total_F3A,3))%>%arrange(desc(Average_F3A))%>%arrange(desc(P3))%>%
    add_column(position=nplayers:1,rating_P3=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    merge(compute_stats(dp,Player,FTM,"FTM",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,FTA,"FTA",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    merge(compute_stats(dp,Player,PIR,"PIR",{{ha}},{{wl}},{{ph}},{{season}}),all=TRUE)%>%
    mutate(PFT=100*round(Total_FTM/Total_FTA,3))%>%arrange(desc(Average_FTA))%>%arrange(desc(PFT))%>%
    add_column(position=nplayers:1,rating_PFT=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%mutate(sumfg=Total_F2A+Total_F3A,Total_FTA,PPS=Total_PTS/sumfg)%>%
    dplyr::select(-sumfg)%>%arrange(desc(PPS))%>%
    add_column(position=nplayers:1,rating_PPS=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA),
           Average_Possesions=round(POS/G,2),
           Offensive_Rating=round((Average_PTS*100)/Average_Possesions,2))%>%
    dplyr::select(-POS)%>%arrange(desc(Offensive_Rating))%>%
    add_column(position=nplayers:1,rating_OFFRAT=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    arrange(desc(Average_Possesions))%>%
    add_column(position=nplayers:1,rating_Possesions=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(EFG=(Total_F2M+1.5*Total_F3M)/(Total_F2A+Total_F3A))%>%
    arrange(desc(EFG))%>%
    add_column(position=nplayers:1,rating_EFG=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(True_Shooting=round((Total_PTS)/(2*(Total_F2A+Total_F3A+0.44*Total_FTA)),2))%>%
    arrange(desc(True_Shooting))%>%
    add_column(position=nplayers:1,rating_True_Shooting=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(FT_ratio=round(Total_FTA/(Total_F3A+Total_F2A),2))%>%
    arrange(desc(FT_ratio))%>%
    add_column(position=nplayers:1,rating_FT_ratio=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(As_To_Ratio=round(Average_AS/Average_TO,2))%>%
    arrange(desc(As_To_Ratio))%>%
    add_column(position=nplayers:1,rating_As_To_Ratio=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(Turnover_ratio=round((Average_TO)/Average_Possesions,2))%>%
    arrange(desc(Turnover_ratio))%>%
    add_column(position=1:nplayers,rating_Turnover_ratio=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(Assists_ratio=round((Average_AS)/Average_Possesions,2))%>%
    arrange(desc(Assists_ratio))%>%
    add_column(position=nplayers:1,rating_Assists_ratio=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    mutate(Game_score=Average_PTS+0.4*Average_F2M+0.4*Average_F3M-0.7*Average_F2A-0.7*Average_F3A+0.4*Average_FTM-0.4*Average_FTA+0.7*Average_OR+0.3*Average_DR+Average_ST+0.7*Average_AS+0.7*Average_BLK-0.4*Average_PF-Average_TO)%>%
    arrange(desc(Game_score))%>%
    add_column(position=nplayers:1,rating_Game_score=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    merge(compute_stats(dp,Player,Team_PTS,"Team_PTS",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_PTS),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_F2A,"Team_F2A",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_F2A),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_F3A,"Team_F3A",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_F3A),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_FTA,"Team_FTA",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_FTA),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_F2M,"Team_F2M",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_F2M),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_F3M,"Team_F3M",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_F3M),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_FTM,"Team_FTM",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_FTM),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_AS,"Team_AS",{{ha}},{{wl}},{{ph}},{{season}})%>%
            dplyr::select(Name,Average_Team_AS),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_OR,"Team_OR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_OR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_DR,"Team_DR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_DR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_TR,"Team_TR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_TR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_ST,"Team_ST",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_ST),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_TO,"Team_TO",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_TO),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_BLK,"Team_BLK",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_BLK),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_PF,"Team_PF",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_PF),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_PIR,"Team_PIR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_PIR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_PTS,"Team_opp_PTS",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_PTS),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_F2A,"Team_opp_F2A",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_F2A),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_F3A,"Team_opp_F3A",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_F3A),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_FTA,"Team_opp_FTA",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_FTA),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_F2M,"Team_opp_F2M",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_F2M),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_F3M,"Team_opp_F3M",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_F3M),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_FTM,"Team_opp_FTM",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_FTM),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_AS,"Team_opp_AS",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_AS),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_OR,"Team_opp_OR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_OR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_DR,"Team_opp_DR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_DR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_TR,"Team_opp_TR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_TR),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_ST,"Team_opp_ST",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_ST),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_TO,"Team_opp_TO",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_TO),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_BLK,"Team_opp_BLK",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_BLK),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_PF,"Team_opp_PF",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_PF),all=TRUE)%>%
    merge(compute_stats(dp,Player,Team_opp_PIR,"Team_opp_PIR",{{ha}},{{wl}},{{ph}},{{season}})%>%dplyr::select(Name,Average_Team_opp_PIR),all=TRUE)%>%
    mutate(PIE=round((Average_PTS+Average_F2M+Average_F3M+Average_FTM-(Average_F2A+Average_F3A+Average_FTA)+Average_DR+0.5*Average_OR-Average_PF-Average_TO+0.5*Average_BLK+Average_ST+Average_AS)/((Average_Team_PTS+Average_Team_F2M+Average_Team_F3M+Average_Team_FTM-(Average_Team_F2A+Average_Team_F3A+Average_Team_FTA)+Average_Team_AS+Average_Team_DR+Average_Team_OR*0.5+Average_Team_ST+0.5*Average_Team_BLK-Average_Team_PF-Average_Team_TO)+(Average_Team_opp_PTS+Average_Team_opp_F2M+Average_Team_opp_F3M+Average_Team_opp_FTM-(Average_Team_opp_F2A+Average_Team_opp_F3A+Average_Team_opp_FTA)+Average_Team_opp_AS+Average_Team_opp_DR+Average_Team_opp_OR*0.5+Average_Team_opp_ST+0.5*Average_Team_opp_BLK-Average_Team_opp_PF-Average_Team_opp_TO)),2),
  Usage = round(100 * (((Average_F3A +Average_F2A) + 0.44 *Average_FTA + Average_TO) * ( 40 )) / (Average_MIN * (Average_Team_F2A+Average_Team_F3A + 0.44 * Average_Team_FTA + Average_Team_TO)),1),
  OR_percent = round(100*Average_OR / (Average_Team_OR + Average_Team_opp_OR),1))%>%
    arrange(desc(PIE))%>%
    add_column(position=nplayers:1,rating_PIE=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    arrange(desc(Usage))%>%
    add_column(position=nplayers:1,rating_Usage=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    arrange(desc(OR_percent))%>%
    add_column(position=nplayers:1,rating_OR_percent=round(position*100/nplayers,0))%>%
    dplyr::select(-position)%>%
    dplyr::filter(Name=={{p1}})
  
  Basic=dp%>%dplyr::filter(Player=={{p1}}&grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)&grepl({{season}},Season))%>%group_by(Team)%>%dplyr::summarise(Games=n(),Minutes=mean(MIN))
  
  
  Average=table%>%
    dplyr::select(Average_PTS,Average_AS,Average_ST,Average_OR,Average_DR,Average_TR,Average_TO,Average_BLK,Average_BLKR,Average_PF,Average_RF)%>%
    reshape2::melt()%>%
    mutate(variable = str_replace(variable, "Average_PTS", "Points"),
           variable = str_replace(variable, "Average_AS", "Assists"),
           variable = str_replace(variable, "Average_ST", "Steals"),
           variable = str_replace(variable, "Average_OR", "Off Reb"),
           variable = str_replace(variable, "Average_DR", "Def Reb"),
           variable = str_replace(variable, "Average_TR", "Tot Reb"),
           variable = str_replace(variable, "Average_TO", "Turnovers"),
           variable = str_replace(variable, "Average_BLK", "Blocks"),
           variable = str_replace(variable, "Average_BLKR", "Blocks Conceed"),
           variable = str_replace(variable, "Average_PF", "Fouls"),
    variable = str_replace(variable, "Average_RF", "Fouls won"))%>%
    setnames(old = c("variable","value"),new=c("Basic Stats","Average"))
  Rating=table%>%
    dplyr::select(Rating_PTS,Rating_AS,Rating_ST,Rating_OR,Rating_DR,Rating_TR,Rating_TO,Rating_BLK,Rating_BLKR,Rating_PF,Rating_RF)%>%
    reshape2::melt()%>%
    mutate(variable = str_replace(variable, "Rating_PTS", "Points"),
           variable = str_replace(variable, "Rating_AS", "Assists"),
           variable = str_replace(variable, "Rating_ST", "Steals"),
           variable = str_replace(variable, "Rating_OR", "Off Reb"),
           variable = str_replace(variable, "Rating_DR", "Def Reb"),
           variable = str_replace(variable, "Rating_TR", "Tot Reb"),
           variable = str_replace(variable, "Rating_TO", "Turnovers"),
           variable = str_replace(variable, "Rating_BLK", "Blocks"),
           variable = str_replace(variable, "Rating_BLKR", "Blocks Conceed"),
           variable = str_replace(variable, "Rating_PF", "Fouls"),
           variable = str_replace(variable, "Rating_RF", "Fouls won"))%>%
    setnames(old = c("variable","value"),new=c("Basic Stats","Rating"))
  Basic_stats=merge(Average,Rating)%>%mutate(id=c(10,5,4,8,2,1,9,11,6,7,3))%>%arrange(desc(id))%>%dplyr::select(-id)
  
  Average_shooting=table%>%
    dplyr::select(Average_F2M,Average_F2A,P2,Average_F3M,Average_F3A,P3,Average_FTM,Average_FTA,PFT,EFG,True_Shooting,FT_ratio)%>%
    reshape2::melt()%>%
    mutate(variable = str_replace(variable, "Average_F2M", "FG 2P Made"),
           variable = str_replace(variable, "Average_F2A", "FG 2P Attempted"),
           variable = str_replace(variable, "P2", "2P%"),
           variable = str_replace(variable, "Average_F3M", "FG 3P Made"),
           variable = str_replace(variable, "Average_F3A", "FG 3P Attempted"),
           variable = str_replace(variable, "P3", "3P%"),
           variable = str_replace(variable, "Average_FTM", "Free Throws Made"),
           variable = str_replace(variable, "Average_FTA", "Free Throws Attempted"),
           variable = str_replace(variable, "PFT", "FT%"),
           variable = str_replace(variable, "EFG", "EFG(%)"),
           variable = str_replace(variable, "True_Shooting", "True Shooting(%)"),
           variable = str_replace(variable, "FT_ratio", "Free Throw Ratio"))%>%
    setnames(old = c("variable","value"),new=c("Shooting Stats","Average"))
  
  Rating_shooting=table%>%
    dplyr::select(Rating_F2M,Rating_F2A,rating_P2,Rating_F3M,Rating_F3A,rating_P3,Rating_FTM,Rating_FTA,rating_PFT,rating_EFG,rating_True_Shooting,rating_FT_ratio)%>%
    reshape2::melt()%>%
    mutate(variable = str_replace(variable, "Rating_F2M", "FG 2P Made"),
           variable = str_replace(variable, "Rating_F2A", "FG 2P Attempted"),
           variable = str_replace(variable, "rating_P2", "2P%"),
           variable = str_replace(variable, "Rating_F3M", "FG 3P Made"),
           variable = str_replace(variable, "Rating_F3A", "FG 3P Attempted"),
           variable = str_replace(variable, "rating_P3", "3P%"),
           variable = str_replace(variable, "Rating_FTM", "Free Throws Made"),
           variable = str_replace(variable, "Rating_FTA", "Free Throws Attempted"),
           variable = str_replace(variable, "rating_PFT", "FT%"),
           variable = str_replace(variable, "rating_EFG", "EFG(%)"),
           variable = str_replace(variable, "rating_True_Shooting", "True Shooting(%)"),
           variable = str_replace(variable, "rating_FT_ratio", "Free Throw Ratio"))%>%
    setnames(old = c("variable","value"),new=c("Shooting Stats","Rating"))
  
  
  Shooting=merge(Average_shooting,Rating_shooting)%>%mutate(id=c(10,7,1,11,12,8,9,3,5,6,4,2))%>%arrange(desc(id))%>%dplyr::select(-id)
  
  advanced=table%>%
    dplyr::select(PIE,Game_score,Average_Possesions,Offensive_Rating,As_To_Ratio,Turnover_ratio,Assists_ratio,OR_percent,Usage,Average_PIR)%>%
    reshape2::melt()%>%
    mutate(variable = str_replace(variable, "PIE", "P.I.E"),
           variable = str_replace(variable, "Average_PIR", "PIR"),
           variable = str_replace(variable, "Game_score", "Game score"),
           variable = str_replace(variable, "Average_Possesions", "Possesions"),
           variable = str_replace(variable, "Offensive_Rating", "Offensive Rating"),
           variable = str_replace(variable, "As_To_Ratio", "Assists vs Turnover Ratio"),
           variable = str_replace(variable, "Assists_ratio", "Assists Ratio"),
           variable = str_replace(variable, "Turnover_ratio", "Turnover Ratio"),
           variable = str_replace(variable, "OR_percent", "OR(%)"),
           variable = str_replace(variable, "Usage", "Usage(%)"))%>%
    setnames(old = c("variable","value"),new=c("Advanced Stats","Average"))
  
  
  Rating_advanced=table%>%
    dplyr::select(rating_PIE,rating_Game_score,rating_Possesions,rating_OFFRAT,rating_As_To_Ratio,rating_Turnover_ratio,rating_Assists_ratio,rating_OR_percent,rating_Usage,Rating_PIR)%>%
    reshape2::melt()%>%
    mutate(variable = str_replace(variable, "rating_PIE", "P.I.E"),
           variable = str_replace(variable, "Rating_PIR", "PIR"),
           variable = str_replace(variable, "rating_Game_score", "Game score"),
           variable = str_replace(variable, "rating_Possesions", "Possesions"),
           variable = str_replace(variable, "rating_OFFRAT", "Offensive Rating"),
           variable = str_replace(variable, "rating_As_To_Ratio", "Assists vs Turnover Ratio"),
           variable = str_replace(variable, "rating_Assists_ratio", "Assists Ratio"),
           variable = str_replace(variable, "rating_Turnover_ratio", "Turnover Ratio"),
           variable = str_replace(variable, "rating_OR_percent", "OR(%)"),
           variable = str_replace(variable, "rating_Usage", "Usage(%)"))%>%
    setnames(old = c("variable","value"),new=c("Advanced Stats","Rating"))
  
  advanced_stats=merge(advanced,Rating_advanced)%>%mutate(id=c(10,9,5,7,1,5,6,8,2,3))%>%arrange(desc(id))%>%dplyr::select(-id)
  
Total_rating=table%>%
    dplyr::select(Rating_PTS,Rating_AS,Rating_ST,Rating_TR,
                Rating_TO,Rating_BLK,Rating_BLKR,Rating_PF,Rating_RF,
                Rating_F2M,Rating_F2A,rating_P2,Rating_F3M,Rating_F3A,rating_P3,Rating_FTM,Rating_FTA,rating_PFT,
                rating_EFG,rating_True_Shooting,rating_FT_ratio,rating_PIE,rating_Game_score,rating_Possesions,
                rating_OFFRAT,rating_As_To_Ratio,rating_Turnover_ratio,rating_Assists_ratio,rating_OR_percent,rating_Usage)%>%
  reshape2::melt()%>%summarise(Total_Rating=round(mean(value),0))%>%reshape2::melt()

offense_rating=table%>%
    dplyr::select(Rating_PTS,Rating_AS,Rating_OR, Rating_TO,Rating_BLKR,Rating_RF, Rating_F2M,Rating_F2A,rating_P2,Rating_F3M,Rating_F3A,rating_P3,Rating_FTM,Rating_FTA,rating_PFT,
                rating_EFG,rating_True_Shooting,rating_FT_ratio,rating_PIE,rating_Game_score,rating_Possesions,
                rating_OFFRAT,rating_As_To_Ratio,rating_Turnover_ratio,rating_Assists_ratio,rating_OR_percent,rating_Usage)%>%
  reshape2::melt()%>%summarise(Offense_Rating=round(mean(value),0))%>%reshape2::melt()

deffense_rating=table%>%
    dplyr::select(Rating_ST,Rating_DR,Rating_BLK,Rating_PF,rating_PIE,rating_Game_score)%>%
  reshape2::melt()%>%summarise(Deffense_Rating=round(mean(value),0))%>%reshape2::melt()

Ratings=rbind(Total_rating,offense_rating,deffense_rating)%>%
    mutate(variable = str_replace(variable, "Total_rating", "Total"),
           variable = str_replace(variable, "offense_rating", "Offense"),
           variable = str_replace(variable, "deffense_rating", "Defense"))%>%
  dplyr::rename(Category=variable,Rating=value)

                  
  return(list(Basic,Basic_stats,Shooting,advanced_stats,table,Ratings))
}

findgamestats= function(dataset_players,GAME){
  playerstats=dataset_players%>%separate(IDGAME,c("Fixture","Game#"),"-")%>%
    dplyr::filter(grepl({{GAME}},fix_teams))%>%
    dplyr::select(Team,Player,MIN,PTS,F2M,F2A,F2GP,F3M,F3A,F3GP,FTM,FTA,FTP,OR,DR,TR,AS,ST,TO,BLK,BLKR,PF,RF,PIR,results,
                  Points_per_shoot, Possesions, Offensive_rating,PIE,Assists_Ratio, As_To_ratio, EFG, FT_ratio, Game_score,
                  True_shooting,Turnover_ratio,Usage,OR_percent,Phase)
  
  
  teamstats=playerstats%>%group_by(Team)%>%dplyr::summarise(PTS=sum(PTS),
                                                            F2A=sum(F2A),
                                                            F2M=sum(F2M),
                                                            P2=100*round(F2M/F2A,3),
                                                            F3A=sum(F3A),
                                                            F3M=sum(F3M),
                                                            P3=100*round(F3M/F3A,3),
                                                            FTA=sum(FTA),
                                                            FTM=sum(FTM),
                                                            PFT=100*round(FTM/FTA,3),
                                                            AS=sum(AS),
                                                            OR=sum(OR),
                                                            DR=sum(DR),
                                                            TR=sum(TR),
                                                            ST=sum(ST),
                                                            TO=sum(TO),
                                                            BLK=sum(BLK),
                                                            PF=sum(PF),
                                                            PIR=sum(PIR),
                                                            PPS= round(PTS/ (F3A +F2A+FTA),2),
                                                            POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
                                                            OFFRA=round(100*PTS/POS,1),
                                                            ASR=round(100*AS/POS,1),
                                                            ASTOR=round(AS/TO,1),
                                                            AssFG=round(AS/(F2M+F3M),2),
                                                            EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1),
                                                            FTR =  round(FTA / (F3A +F2A),2),
                                                            TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1),
                                                            TOR = round((TO * 100) / POS,2))
  
  return(list(playerstats,teamstats))
}

player_stats_by_team_against=function(dataset_players,Player_Name,Home_Away,Win_Lose,Phase,Season){
  basic_stats=data.frame(t(merge(dataset_players%>%
                             dplyr::filter(Player=={{Player_Name}}&
                                             grepl({{Home_Away}},HA)&
                                             grepl({{Win_Lose}},results)&
                                             grepl({{Phase}},Phase)&
                                             grepl({{Season}},Season))%>%
                             group_by(Against)%>%
                             dplyr::summarise(Games=n(),
                                              Average_PTS=round(mean(PTS,na.rm=T),1),
                                              Average_AS=round(mean(AS,na.rm=T),1),
                                              Average_OR=round(mean(OR,na.rm=T),1),
                                              Average_DR=round(mean(DR,na.rm=T),1),
                                              Average_TR=round(mean(TR,na.rm=T),1),
                                              Average_FTM=round(mean(FTM,na.rm=T),1),
                                              Average_FTA=round(mean(FTA,na.rm=T),1),
                                              PFT=round(100*Average_FTM/Average_FTA,2),
                                              Average_F2M=round(mean(F2M,na.rm=T),1),
                                              Average_F2A=round(mean(F2A,na.rm=T),1),
                                              P2=round(100*Average_F2M/Average_F2A,1),
                                              Average_F3M=round(mean(F3M,na.rm=T),1),
                                              Average_F3A=round(mean(F3A,na.rm=T),1),
                                              P3=round(100*Average_F3M/Average_F3A,1),
                                              Average_ST=round(mean(ST,na.rm=T),1),
                                              Average_TO=round(mean(TO,na.rm=T),1),
                                              Average_BLK=round(mean(BLK,na.rm=T),1),
                                              Average_PF=round(mean(PF,na.rm=T),1),
                                              Average_BLKR=round(mean(BLKR,na.rm=T),1),
                                              Average_RF=round(mean(RF,na.rm=T),1),
                                              Average_MIN=round(mean(MIN,na.rm=T),1),
                                              Average_PIR=round(mean(PIR,na.rm=T),1),
                                              Points_per_shoot = round(Average_PTS/ (Average_F3A +Average_F2A+Average_FTA),2),
                                              Possesions=round(0.96*(Average_F2A+Average_F3A-Average_OR+Average_TO+0.44*Average_FTA),1),
                                              Offensive_rating=round(100*Average_PTS/Possesions,1),
                                              PIE=round((Average_PTS+Average_F2M+Average_F3M+Average_FTM-(Average_F2A+Average_F3A+Average_FTA)+Average_DR+0.5*Average_OR-Average_PF-Average_TO+0.5*Average_BLK+Average_ST+Average_AS)/((mean(Team_PTS,na.rm = T)+mean(Team_F2M,na.rm = T)+mean(Team_F3M,na.rm = T)+mean(Team_FTM,na.rm = T)-(mean(Team_F2A,na.rm = T)+mean(Team_F3A,na.rm = T)+mean(Team_FTA,na.rm = T))+mean(Team_AS,na.rm = T)+mean(Team_DR,na.rm = T)+mean(Team_OR,na.rm = T)*0.5+mean(Team_ST,na.rm = T)+0.5*mean(Team_BLK,na.rm = T)-mean(Team_PF,na.rm = T)-mean(Team_TO,na.rm = T))+(mean(Team_opp_PTS,na.rm = T)+mean(Team_opp_F2M,na.rm = T)+mean(Team_opp_F3M,na.rm = T)+mean(Team_opp_FTM,na.rm = T)-(mean(Team_opp_F2A,na.rm = T)+mean(Team_opp_F3A,na.rm = T)+mean(Team_opp_FTA,na.rm = T))+mean(Team_opp_AS,na.rm = T)+mean(Team_opp_DR,na.rm = T)+mean(Team_opp_OR,na.rm = T)*0.5+mean(Team_opp_ST,na.rm = T)+0.5*mean(Team_opp_BLK,na.rm = T)-mean(Team_opp_PF,na.rm = T)-mean(Team_opp_TO,na.rm = T))),2),
                                              Assists_Ratio=round(100*Average_AS/Possesions,1),
                                              As_To_ratio=round(Average_AS/Average_TO,1),
                                              EFG = round(100*(Average_F2M + (1.5 * Average_F3M)) / (Average_F3A +Average_F2A),1),
                                              FT_ratio =  round(Average_FTA / (Average_F3A +Average_F2A),2),
                                              Game_score = round(Average_PTS + (0.4 * (Average_F3M +Average_F2M)) - (0.7 * (Average_F3A +Average_F2A)) - (0.4 * (Average_FTA - Average_FTM)) + (0.7 * Average_OR) + (0.3 * Average_DR) + Average_ST + (0.7 * Average_AS) + (0.7 * Average_BLK) - (0.4 * Average_PF) - Average_TO,1),
                                              True_shooting = round(100*Average_PTS / (2 * ((Average_F3A +Average_F2A) + 0.44 * Average_FTA)),1),
                                              Turnover_ratio = round((Average_TO * 100) / Possesions,2),
                                              Usage = round(100 * (((Average_F3A +Average_F2A) + 0.44 *Average_FTA + Average_TO) * ( 40 )) / (Average_MIN * (mean(Team_F2A,na.rm=T)+mean(Team_F3A,na.rm=T) + 0.44 * mean(Team_FTA,na.rm=T) + mean(Team_TO,na.rm=T))),1),
                                              OR_percent = round(100*Average_OR / (mean(Team_OR,na.rm=T) + mean(Team_opp_OR,na.rm=T)),1)),
                             dataset_players%>%filter(results=="W"&Player=={{Player_Name}}&
                                                      grepl({{Home_Away}},HA)&
                                                      grepl({{Win_Lose}},results)&
                                                      grepl({{Phase}},Phase)&
                                                      grepl({{Season}},Season))%>%
                                                      group_by(Against)%>%
                                                      summarise(Wins=n()),all=TRUE)%>%
                             column_to_rownames("Against")))%>%
    rownames_to_column("variable")
  average=rbind(data.frame(player_stats(dataset_players,Player_Name,Home_Away,Win_Lose,Phase)[5])%>%
                  dplyr::select(G,
                                Average_PTS,
                                Average_AS,
                                Average_ST,
                                Average_MIN,
                                Average_DR,
                                Average_OR,
                                Average_TR,
                                Average_BLK,
                                Average_TO,
                                Average_PF,
                                Average_F2M,
                                Average_F2A,
                                P2,
                                Average_F3M,
                                Average_F3A,
                                P3,
                                Average_FTM,
                                Average_FTA,
                                PFT,
                                Average_PIR,
                                Average_Team_PTS,
                                Average_Team_F2A,
                                Average_Team_F3A,
                                Average_Team_FTA,
                                Average_Team_F2M,
                                Average_Team_F3M,
                                Average_Team_FTM,
                                Average_Team_AS,
                                Average_Team_OR,
                                Average_Team_DR,
                                Average_Team_TR,
                                Average_Team_ST,
                                Average_Team_TO,
                                Average_Team_BLK,
                                Average_Team_PF,
                                Average_Team_PIR,
                                Average_Team_opp_PTS,
                                Average_Team_opp_F2A,
                                Average_Team_opp_F3A,
                                Average_Team_opp_FTA,
                                Average_Team_opp_F2M,
                                Average_Team_opp_F3M,
                                Average_Team_opp_FTM,
                                Average_Team_opp_AS,
                                Average_Team_opp_OR,
                                Average_Team_opp_DR,
                                Average_Team_opp_TR,
                                Average_Team_opp_ST,
                                Average_Team_opp_TO,
                                Average_Team_opp_BLK,
                                Average_Team_opp_PF,
                                Average_Team_opp_PIR,
                                Average_Possesions,
                                PPS)%>%
                  mutate(Offensive_rating=round(100*Average_PTS/Average_Possesions,1),
                         PIE=round((Average_PTS+Average_F2M+Average_F3M+Average_FTM-(Average_F2A+Average_F3A+Average_FTA)+Average_DR+0.5*Average_OR-Average_PF-Average_TO+0.5*Average_BLK+Average_ST+Average_AS)/((Average_Team_PTS+Average_Team_F2M+Average_Team_F3M+Average_Team_FTM-(Average_Team_F2A+Average_Team_F3A+Average_Team_FTA)+Average_Team_AS+Average_Team_DR+Average_Team_OR*0.5+Average_Team_ST+0.5*Average_Team_BLK-Average_Team_PF-Average_Team_TO)+(Average_Team_opp_PTS+Average_Team_opp_F2M+Average_Team_opp_F3M+Average_Team_opp_FTM-(Average_Team_opp_F2A+Average_Team_opp_F3A+Average_Team_opp_FTA)+Average_Team_opp_AS+Average_Team_opp_DR+Average_Team_opp_OR*0.5+Average_Team_opp_ST+0.5*Average_Team_opp_BLK-Average_Team_opp_PF-Average_Team_opp_TO)),2),
                         Assists_Ratio=round(100*Average_AS/Average_Possesions,2),
                         As_To_ratio=round(Average_AS/Average_TO,2),
                         EFG = round(100*(Average_F2M + (1.5 * Average_F3M)) / (Average_F3A +Average_F2A),1),
                         FT_ratio =  round(Average_FTA / (Average_F3A +Average_F2A),2),
                         Game_score = round(Average_PTS + (0.4 * (Average_F3M +Average_F2M)) - (0.7 * (Average_F3A +Average_F2A)) - (0.4 * (Average_FTA - Average_FTM)) + (0.7 * Average_OR) + (0.3 * Average_DR) + Average_ST + (0.7 * Average_AS) + (0.7 * Average_BLK) - (0.4 * Average_PF) - Average_TO,1),
                         True_shooting = round(100*Average_PTS / (2 * ((Average_F3A +Average_F2A) + 0.44 * Average_FTA)),1),
                         Turnover_ratio = round((Average_TO * 100) / Average_Possesions,2),
                         Usage = round(100 * (((Average_F3A +Average_F2A) + 0.44 *Average_FTA + Average_TO) * ( 40 / 5)) / (Average_MIN * (Average_Team_F2A+Average_Team_F3A + 0.44 * Average_Team_FTA + Average_Team_TO)),1),
                         OR_percent = round(100*Average_OR / (Average_Team_OR + Average_Team_opp_OR),1))%>%
                  dplyr::select(G,
                                Average_PTS,
                                Average_AS,
                                Average_ST,
                                Average_MIN,
                                Average_DR,
                                Average_OR,
                                Average_TR,
                                Average_BLK,
                                Average_TO,
                                Average_PF,
                                Average_F2M,
                                Average_F2A,
                                P2,
                                Average_F3M,
                                Average_F3A,
                                P3,
                                Average_FTM,
                                Average_FTA,
                                PFT,
                                Average_PIR,
                                Average_Possesions,
                                PIE,
                                Offensive_rating,
                                Assists_Ratio,
                                As_To_ratio,
                                EFG,
                                FT_ratio,
                                Game_score,
                                True_shooting,
                                Turnover_ratio,
                                Usage,
                                OR_percent,
                                PPS)%>%
                  dplyr::rename(Games=G,Points_per_shoot=PPS,Possesions=Average_Possesions)%>%reshape2::melt(),
                dataset_players%>%filter(results=="W"&Player=={{Player_Name}}&
                                           grepl({{Home_Away}},HA)&
                                           grepl({{Win_Lose}},results)&
                                           grepl({{Phase}},Phase)&
                                           grepl({{Season}},Season))%>%
                  summarise(Wins=n())%>%reshape2::melt())
                
  final=merge(basic_stats,average,all=TRUE)%>%
    add_column(id=c(8,
                    9,
                    33,
                    18,
                    17,
                    31,
                    25,
                    26,
                    22,
                    23,
                    28,
                    29,
                    35,
                    32,
                    16,
                    14,
                    34,
                    15,
                    20,
                    19,
                    30,
                    7,
                    6,
                    5,
                    37,
                    11,
                    1,
                    24,
                    21,
                    27,
                    10,
                    13,
                    12,
                    4,
                    3,
                    2,
                    36))%>%
    arrange(desc(id))%>%
    mutate(Average=round(value,2),
           variable = str_replace(variable, "Average_PTS", "Points"),
           variable = str_replace(variable, "Average_PIR", "PIR"),
           variable = str_replace(variable, "Average_MIN", "Minutes"),
           variable = str_replace(variable, "Average_AS", "Assists"),
           variable = str_replace(variable, "Average_ST", "Steals"),
           variable = str_replace(variable, "Average_OR", "Off Reb"),
           variable = str_replace(variable, "Average_DR", "Def Reb"),
           variable = str_replace(variable, "Average_TR", "Tot Reb"),
           variable = str_replace(variable, "Average_TO", "Turnovers"),
           variable = str_replace(variable, "Average_BLK", "Blocks"),
           variable = str_replace(variable, "Average_PF", "Fouls"),
           variable = str_replace(variable, "Average_BLKR", "Blocks received"),
           variable = str_replace(variable, "Average_RF", "Fouls Won"),
           variable = str_replace(variable, "Average_F2M", "FG 2P Made"),
           variable = str_replace(variable, "Average_F2A", "FG 2P Attempted"),
           variable = str_replace(variable, "P2", "2P%"),
           variable = str_replace(variable, "Average_F3M", "FG 3P Made"),
           variable = str_replace(variable, "Average_F3A", "FG 3P Attempted"),
           variable = str_replace(variable, "P3", "3P%"),
           variable = str_replace(variable, "Average_FTM", "Free Throws Made"),
           variable = str_replace(variable, "Average_FTA", "Free Throws Attempted"),
           variable = str_replace(variable, "PFT", "FT%"),
           variable = str_replace(variable, "Average_PIE", "P.I.E"),
           variable = str_replace(variable, "Game_score", "Game score"),
           variable = str_replace(variable, "Average_Possesions", "Possesions"),
           variable = str_replace(variable, "Offensive_Rating", "Offensive Rating"),
           variable = str_replace(variable, "EFG", "EFG(%)"),
           variable = str_replace(variable, "True_shooting", "True Shooting(%)"),
           variable = str_replace(variable, "FT_ratio", "Free Throw Ratio"),
           variable = str_replace(variable, "As_To_ratio", "Assists vs Turnover Ratio"),
           variable = str_replace(variable, "Assists_Ratio", "Assists Ratio(%)"),
           variable = str_replace(variable, "Turnover_ratio", "Turnover Ratio(%)"),
           variable = str_replace(variable, "OR_percent", "OR(%)"),
           variable = str_replace(variable, "Usage", "Usage(%)"),
           variable = str_replace(variable, "Points_per_shoot", "Points per attempt"))%>%
    column_to_rownames(var="variable")%>%
    dplyr::select(-id,-value)
  
  
  return(final)
}

compute_stats_teams=function(dataset_players,category,stat,names,Home_Away,result,Phase,Season){
  nteams=nrow(unique(dataset_players%>%dplyr::filter(grepl({{Phase}},Phase)&grepl({{Home_Away}},HA)&grepl({{Season}},Season)& grepl({{result}},results))%>%dplyr::group_by(Team)%>%dplyr::summarise(Total=n())))
  
  compute_games=dataset_players%>%dplyr::filter(grepl({{Phase}},Phase)&grepl({{Home_Away}},HA)&grepl({{Season}},Season)& grepl({{result}},results))%>%
    group_by({{category}},idseason)%>%
    dplyr::summarise(Total_games=n())%>%group_by({{category}})%>%dplyr::summarise(Total_games=n())%>%
    merge(dataset_players%>%dplyr::filter(grepl({{Phase}},Phase)&grepl({{Home_Away}},HA)&grepl({{Season}},Season)& grepl({{result}},results))%>%
            group_by({{category}})%>%
            dplyr::summarise(Total=sum({{stat}},na.rm=T)),all=TRUE)%>%
    mutate(Average=round(Total/Total_games,2))%>%
    arrange(desc(Average))%>%
    add_column(position=nteams:1,rating=round(position*100/nteams,0))%>%
    dplyr::select(-position)%>%
    setnames(old=c("Total_games","Total","Average","rating"), new = c("G",paste0("Team_Total_",{{names}}),paste0("Team_Average_",{{names}}),paste0("Team_Rating_",{{names}})))%>%
    merge(dataset_players%>%mutate(result1=ifelse(results=="W","L","W"),
                                   HA1=ifelse(HA=="A","H","A"))%>%
            dplyr::filter(grepl({{Phase}},Phase)&grepl({{Home_Away}},HA1)&grepl({{Season}},Season)& grepl({{result}},result1))%>%
          group_by(Against)%>%
            dplyr::summarise(Total_opp=sum({{stat}},na.rm=T))%>%
            dplyr::rename(Team=Against),all=TRUE)%>%
            mutate(Average_opp=round(Total_opp/G,2))%>%
    arrange(desc(Average_opp))%>%
    add_column(position=1:nteams,rating_opp=round(position*100/nteams,0))%>%
    dplyr::select(-position)%>%
    setnames(old=c("Total_opp","Average_opp","rating_opp"), new = c(paste0("Team_Total_opp_",{{names}}),paste0("Team_Average_opp_",{{names}}),paste0("Team_Rating_opp_",{{names}})))
  return(compute_games)
  
}

head_to_head_teams=function(dataset_players,Team1,Team2,Season,Phase){
  between_teams=dataset_players%>%dplyr::filter(Team=={{Team1}} & Against=={{Team2}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
    dplyr::summarise(Team={{Team1}},
                     Total_games=n_unique(idseason),
                     Points=round(sum(PTS)/Total_games,1),
                     Assists=round(sum(AS)/Total_games,1),
                     Steals=round(sum(ST)/Total_games,1),
                     Turnovers=round(sum(TO)/Total_games,1),
                     Off_Reb=round(sum(OR)/Total_games,1),
                     Def_Reb=round(sum(DR)/Total_games,1),
                     Tot_Reb=round(sum(TR)/Total_games,1),
                     Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                     Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                     Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                     Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                     Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                     Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                     Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                     Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                     Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                     Fouls=round(sum(PF)/Total_games,1),
                     Blocks=round(sum(BLK)/Total_games,1),
                     PIR=round(sum(PIR)/Total_games,1),
                     Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                     Offensive_Rating=100*round(Points/Possesions,3),
                     EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                     True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                     FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                     As_To_Ratio=round(Assists/Turnovers,2),
                     Turnover_ratio=round((Turnovers)/Possesions,2),
                     Assists_ratio=round((Assists)/Possesions,2))%>%
    reshape2::melt()%>%dplyr::select(-Team)%>%
    setnames(old=c("variable","value"),new=c("Stats","Team1"))%>%
    merge(dataset_players%>%dplyr::filter(Team=={{Team2}}& Against=={{Team1}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
            dplyr::summarise(Team={{Team2}},
                             Total_games=n_unique(idseason),
                             Points=round(sum(PTS)/Total_games,1),
                             Assists=round(sum(AS)/Total_games,1),
                             Steals=round(sum(ST)/Total_games,1),
                             Turnovers=round(sum(TO)/Total_games,1),
                             Off_Reb=round(sum(OR)/Total_games,1),
                             Def_Reb=round(sum(DR)/Total_games,1),
                             Tot_Reb=round(sum(TR)/Total_games,1),
                             Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                             Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                             Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                             Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                             Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                             Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                             Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                             Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                             Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                             Fouls=round(sum(PF)/Total_games,1),
                             Blocks=round(sum(BLK)/Total_games,1),
                             PIR=round(sum(PIR)/Total_games,1),
                             Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                             Offensive_Rating=100*round(Points/Possesions,3),
                             EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                             True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                             FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                             As_To_Ratio=round(Assists/Turnovers,2),
                             Turnover_ratio=round((Turnovers)/Possesions,2),
                             Assists_ratio=round((Assists)/Possesions,2))%>%
            reshape2::melt()%>%dplyr::select(-Team)%>%
            setnames(old=c("variable","value"),new=c("Stats","Team2")))%>%
    mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"~1,
                                Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio" ~2),
           Better=case_when(Team1==Team2~"Identical",
                            First_case==1 & Team1>Team2~{{Team2}},
                            First_case==1 & Team1<Team2~{{Team1}},
                            First_case==2 & Team1<Team2~{{Team2}},
                            First_case==2 & Team1>Team2~{{Team1}}))%>%dplyr::select(-First_case)%>%
    setnames(old=c("Team1","Team2"),new=c({{Team1}},{{Team2}}))
  
  
  
  Total_teams=dataset_players%>%dplyr::filter(Team=={{Team1}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
    dplyr::summarise(Team={{Team1}},
                     Total_games=n_unique(idseason),
                     Points=round(sum(PTS)/Total_games,1),
                     Assists=round(sum(AS)/Total_games,1),
                     Steals=round(sum(ST)/Total_games,1),
                     Turnovers=round(sum(TO)/Total_games,1),
                     Off_Reb=round(sum(OR)/Total_games,1),
                     Def_Reb=round(sum(DR)/Total_games,1),
                     Tot_Reb=round(sum(TR)/Total_games,1),
                     Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                     Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                     Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                     Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                     Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                     Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                     Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                     Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                     Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                     Fouls=round(sum(PF)/Total_games,1),
                     Blocks=round(sum(BLK)/Total_games,1),
                     PIR=round(sum(PIR)/Total_games,1),
                     Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                     Offensive_Rating=100*round(Points/Possesions,3),
                     EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                     True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                     FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                     As_To_Ratio=round(Assists/Turnovers,2),
                     Turnover_ratio=round((Turnovers)/Possesions,2),
                     Assists_ratio=round((Assists)/Possesions,2))%>%
    reshape2::melt()%>%dplyr::select(-Team)%>%
    setnames(old=c("variable","value"),new=c("Stats","Team1"))%>%
    merge(dataset_players%>%dplyr::filter(Team=={{Team2}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
            dplyr::summarise(Team={{Team2}},
                             Total_games=n_unique(idseason),
                             Points=round(sum(PTS)/Total_games,1),
                             Assists=round(sum(AS)/Total_games,1),
                             Steals=round(sum(ST)/Total_games,1),
                             Turnovers=round(sum(TO)/Total_games,1),
                             Off_Reb=round(sum(OR)/Total_games,1),
                             Def_Reb=round(sum(DR)/Total_games,1),
                             Tot_Reb=round(sum(TR)/Total_games,1),
                             Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                             Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                             Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                             Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                             Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                             Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                             Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                             Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                             Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                             Fouls=round(sum(PF)/Total_games,1),
                             Blocks=round(sum(BLK)/Total_games,1),
                             PIR=round(sum(PIR)/Total_games,1),
                             Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                             Offensive_Rating=100*round(Points/Possesions,3),
                             EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                             True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                             FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                             As_To_Ratio=round(Assists/Turnovers,2),
                             Turnover_ratio=round((Turnovers)/Possesions,2),
                             Assists_ratio=round((Assists)/Possesions,2))%>%
            reshape2::melt()%>%dplyr::select(-Team)%>%
            setnames(old=c("variable","value"),new=c("Stats","Team2")))%>%
    mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"~1,
                                Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio" ~2),
           Better=case_when(Team1==Team2~"Identical",
                            First_case==1 & Team1>Team2~{{Team2}},
                            First_case==1 & Team1<Team2~{{Team1}},
                            First_case==2 & Team1<Team2~{{Team2}},
                            First_case==2 & Team1>Team2~{{Team1}}))%>%
    dplyr::select(-First_case)%>%
    setnames(old=c("Team1","Team2"),new=c({{Team1}},{{Team2}}))
  
  Total_teams_conceed=dataset_players%>%dplyr::filter(Against=={{Team1}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
    dplyr::summarise(Team={{Team1}},
                     Total_games=n_unique(idseason),
                     Points_conceed=round(sum(PTS)/Total_games,1),
                     Assists_conceed=round(sum(AS)/Total_games,1),
                     Steals_conceed=round(sum(ST)/Total_games,1),
                     Turnovers_conceed=round(sum(TO)/Total_games,1),
                     Off_Reb_conceed=round(sum(OR)/Total_games,1),
                     Def_Reb_conceed=round(sum(DR)/Total_games,1),
                     Tot_Reb_conceed=round(sum(TR)/Total_games,1),
                     Field_goal_2p_attemped_conceed=round(sum(F2A)/Total_games,1),
                     Field_goal_2p_made_conceed=round(sum(F2M)/Total_games,1),
                     Percentage_2P_conceed=100*round(Field_goal_2p_made_conceed/Field_goal_2p_attemped_conceed,3),
                     Field_goal_3p_attemped_conceed=round(sum(F3A)/Total_games,1),
                     Field_goal_3p_made_conceed=round(sum(F3M)/Total_games,1),
                     Percentage_3P_conceed=100*round(Field_goal_3p_made_conceed/Field_goal_3p_attemped_conceed,3),
                     Field_goal_FT_attemped_conceed=round(sum(FTA)/Total_games,1),
                     Field_goal_FT_made_conceed=round(sum(FTM)/Total_games,1),
                     Percentage_FT_conceed=100*round(Field_goal_FT_made_conceed/Field_goal_FT_attemped_conceed,3),
                     Fouls_conceed=round(sum(PF)/Total_games,1),
                     Blocks_conceed=round(sum(BLK)/Total_games,1),
                     PIR_conceed=round(sum(PIR)/Total_games,1),
                     Possesions_conceed=round(0.96*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed-Off_Reb_conceed+Turnovers_conceed+0.44*Field_goal_FT_attemped_conceed),1),
                     Defensive_Rating=100*round(Points_conceed/Possesions_conceed,3),
                     EFG_conceed=100*round((Field_goal_2p_made_conceed+1.5*Field_goal_3p_made_conceed)/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),3),
                     True_Shooting_conceed=100*round((Points_conceed)/(2*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed+0.44*Field_goal_FT_attemped_conceed)),3),
                     FT_ratio_conceed=round(Field_goal_FT_attemped_conceed/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),2),
                     As_To_Ratio_conceed=round(Assists_conceed/Turnovers_conceed,2),
                     Turnover_ratio_conceed=round((Turnovers_conceed)/Possesions_conceed,2),
                     Assists_ratio_conceed=round((Assists_conceed)/Possesions_conceed,2))%>%
    reshape2::melt()%>%dplyr::select(-Team)%>%
    dplyr::rename(Stats=variable,Team1=value)%>%
    merge(dataset_players%>%dplyr::filter(Against=={{Team2}}& grepl({{Season}},Season)& grepl({{Phase}},Phase))%>%
            dplyr::summarise(Team={{Team2}},
                             Total_games=n_unique(idseason),
                             Points_conceed=round(sum(PTS)/Total_games,1),
                             Assists_conceed=round(sum(AS)/Total_games,1),
                             Steals_conceed=round(sum(ST)/Total_games,1),
                             Turnovers_conceed=round(sum(TO)/Total_games,1),
                             Off_Reb_conceed=round(sum(OR)/Total_games,1),
                             Def_Reb_conceed=round(sum(DR)/Total_games,1),
                             Tot_Reb_conceed=round(sum(TR)/Total_games,1),
                             Field_goal_2p_attemped_conceed=round(sum(F2A)/Total_games,1),
                             Field_goal_2p_made_conceed=round(sum(F2M)/Total_games,1),
                             Percentage_2P_conceed=100*round(Field_goal_2p_made_conceed/Field_goal_2p_attemped_conceed,3),
                             Field_goal_3p_attemped_conceed=round(sum(F3A)/Total_games,1),
                             Field_goal_3p_made_conceed=round(sum(F3M)/Total_games,1),
                             Percentage_3P_conceed=100*round(Field_goal_3p_made_conceed/Field_goal_3p_attemped_conceed,3),
                             Field_goal_FT_attemped_conceed=round(sum(FTA)/Total_games,1),
                             Field_goal_FT_made_conceed=round(sum(FTM)/Total_games,1),
                             Percentage_FT_conceed=100*round(Field_goal_FT_made_conceed/Field_goal_FT_attemped_conceed,3),
                             Fouls_conceed=round(sum(PF)/Total_games,1),
                             Blocks_conceed=round(sum(BLK)/Total_games,1),
                             PIR_conceed=round(sum(PIR)/Total_games,1),
                             Possesions_conceed=round(0.96*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed-Off_Reb_conceed+Turnovers_conceed+0.44*Field_goal_FT_attemped_conceed),1),
                             Defensive_Rating=100*round(Points_conceed/Possesions_conceed,3),
                             EFG_conceed=100*round((Field_goal_2p_made_conceed+1.5*Field_goal_3p_made_conceed)/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),3),
                             True_Shooting_conceed=100*round((Points_conceed)/(2*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed+0.44*Field_goal_FT_attemped_conceed)),3),
                             FT_ratio_conceed=round(Field_goal_FT_attemped_conceed/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),2),
                             As_To_Ratio_conceed=round(Assists_conceed/Turnovers_conceed,2),
                             Turnover_ratio_conceed=round((Turnovers_conceed)/Possesions_conceed,2),
                             Assists_ratio_conceed=round((Assists_conceed)/Possesions_conceed,2))%>%
            reshape2::melt()%>%dplyr::select(-Team)%>%
            dplyr::rename(Stats=variable,Team2=value))%>%
    mutate(First_case=case_when(Stats=="Turnovers_conceed"|Stats=="Fouls_conceed"|Stats=="Turnover_ratio_conceed"~1,
                                Stats!="Turnovers_conceed"&Stats!="Fouls_conceed"&Stats!="Turnover_ratio_conceed" ~2),
           Better=case_when(Team1==Team2~"Identical",
                            First_case==1 & Team1>Team2~{{Team1}},
                            First_case==1 & Team1<Team2~{{Team2}},
                            First_case==2 & Team1<Team2~{{Team1}},
                            First_case==2 & Team1>Team2~{{Team2}}))%>%
    dplyr::select(-First_case)%>%
    setnames(old=c("Team1","Team2"),new=c({{Team1}},{{Team2}}))
  
  
  
  
  
  between_teams_basic=between_teams%>%
    dplyr::filter(grepl("Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&Stats!="Assists_ratio")%>%
    dplyr::rename("Between games Basic Stats"=Stats)%>%
    add_column(arr=c(8,4,7,1,6,9,3,5,2))%>%arrange(desc(arr))%>%
    dplyr::select(-arr)
  
  between_teams_shoots=between_teams%>%
    dplyr::filter(grepl("Field_goal_2p_attemped|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats))%>%
    dplyr::rename("Between games Shooting Stats"=Stats)%>%
    add_column(arr=c(5,6,2,3,8,9,4,1,7))%>%
    arrange(desc(arr))%>%dplyr::select(-arr)
  
  between_teams_advanced=between_teams%>%
    dplyr::filter(grepl("PIR|Assists_ratio|FT_ratio|Offensive_Rating|Turnover_ratio|EFG|True_Shooting|Possesions",Stats))%>%
    dplyr::rename("Between games Advanced Stats"=Stats)
  
  
  
  Total_teams_basic=rbind(Total_teams%>%
                            dplyr::filter(grepl("Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&Stats!="Assists_ratio"),Total_teams_conceed%>%
                            dplyr::filter(grepl("Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&Stats!="Assists_ratio_conceed"))%>%
    mutate(Stats = str_replace(Stats, "Points_conceed", "Points conceed"),
           Stats = str_replace(Stats, "Assists_conceed", "Assists allowed"),
           Stats = str_replace(Stats, "Blocks_conceed", "Blocks Against"),
           Stats = str_replace(Stats, "Def_Reb_conceed", "Def Reb opp taken"),
           Stats = str_replace(Stats, "Off_Reb_conceed", "Off Reb opp taken"),
           Stats = str_replace(Stats, "Tot_Reb_conceed", "Total Reb opp taken"),
           Stats = str_replace(Stats, "Fouls_conceed", "Fouls drawn"),
           Stats = str_replace(Stats, "Steals_conceed", "Steals conceed"),
           Stats = str_replace(Stats, "Turnovers_conceed", "Turnovers opp done"))%>%
    dplyr::rename("Euroleague Basic Stats"=Stats)%>%
    add_column(arr=c(16,8,14,2,13,18,6,12,4,15,7,11,1,10,17,5,9,3))%>%
    arrange(desc(arr))%>%dplyr::select(-arr)
  
  Total_teams_shoots=rbind(Total_teams%>%
                             dplyr::filter(grepl("Field_goal_2p_attemped|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats)),Total_teams_conceed%>%
                             dplyr::filter(grepl("Field_goal_2p_attemped|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats)))%>%
    mutate(Stats = str_replace(Stats, "Field_goal_2p_attemped", "2P attempt"),
           Stats = str_replace(Stats, "Field_goal_2p_made", "2P made"),
           Stats = str_replace(Stats, "Field_goal_3p_attemped", "3P attempt"),
           Stats = str_replace(Stats, "Field_goal_3p_made", "3P made"),
           Stats = str_replace(Stats, "Field_goal_FT_attemped", "Free throws attempt"),
           Stats = str_replace(Stats, "Field_goal_FT_made", "Free throws made"),
           Stats = str_replace(Stats, "Percentage_FT", "FT(%)"),
           Stats = str_replace(Stats, "Percentage_2P", "2P(%)"),
           Stats = str_replace(Stats, "Percentage_3P", "3P(%)"),
           Stats = str_replace(Stats, "_conceed", " opp"))%>%
    dplyr::rename("Euroleague Shooting Stats"=Stats)%>%
    add_column(arr=c(11,12,5,6,17,18,10,4,16,8,9,2,3,14,15,7,1,13))%>%
    arrange(desc(arr))%>%
    dplyr::select(-arr)
  
  Total_teams_advanced=rbind(Total_teams%>%
                               dplyr::filter(grepl("PIR|Assists_ratio|FT_ratio|Offensive_Rating|Turnover_ratio|EFG|True_Shooting|Possesions",Stats)),Total_teams_conceed%>%
                               dplyr::filter(grepl("PIR|Assists_ratio|FT_ratio|Defensive_Rating|Turnover_ratio|EFG|True_Shooting|Possesions",Stats)))%>%
    mutate(Stats = str_replace(Stats, "_conceed", " opp"))%>%
    dplyr::rename("Euroleague Advanced Stats"=Stats)%>%
    add_column(arr=c(10,8,6,13,16,14,4,2,11,13,7,5,3,15,12,1))%>%
    arrange(desc(arr))%>%
    dplyr::select(-arr)
  return(list(Total_teams_basic,Total_teams_shoots,Total_teams_advanced,between_teams_basic,between_teams_shoots,between_teams_advanced))
}

Games_summary=function(dataset_results,Team1,season){
  Games=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  Games_regular=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&Phase=="Regular Season"&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  Games_playoffs=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&Phase=="Play offs"&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  
  Games_finalfour=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
    dplyr::filter((grepl({{Team1}}, Home)|grepl({{Team1}},Away))&Phase=="Final Four"&grepl({{season}},Season))%>%
    dplyr::summarise(Total_games=n_unique(idseason))
  
  
  Total=rbind(dataset_results%>%
                dplyr::filter(grepl({{Team1}}, Home)&grepl({{season}},Season))%>%
                group_by(Home)%>%
                dplyr::summarise(Wins=sum(Home_win))%>%
                dplyr::rename(Team=Home),
              dataset_results%>%
                dplyr::filter(grepl({{Team1}}, Away)&grepl({{season}},Season))%>%
                group_by(Away)%>%
                dplyr::summarise(Wins=sum(Away_win))%>%
                dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%
    add_column(Games=Games$Total_games)%>%
  mutate(Loses=Games-Wins)%>%
    dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses in Euroleague"=Loses,
                  "Total Wins in Euroleague"=Wins,
                  "Total Games in Euroleague"=Games)%>%
    dplyr::select(-Team)%>%
    reshape2::melt()
  
  
  Total_regular=rbind(dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Home)&Phase=="Regular Season"&grepl({{season}},Season))%>%
                                 group_by(Home)%>%
                                 dplyr::summarise(Wins=sum(Home_win))%>%
                                 dplyr::rename(Team=Home),
                               dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Away)&Phase=="Regular Season"&grepl({{season}},Season))%>%
                                 group_by(Away)%>%
                                 dplyr::summarise(Wins=sum(Away_win))%>%
                                 dplyr::rename(Team=Away))%>%group_by(Team)%>%
    dplyr::summarise(Wins=sum(Wins))%>%
    add_column(Games=Games_regular$Total_games)%>%
    mutate(Loses=Games-Wins)%>%dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses on Regular Season"=Loses,
                  "Total Wins on Regular Season"=Wins,
                  "Total Games on Regular Season"=Games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  
  Home_regular=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Home)&Phase=="Regular Season"&grepl({{season}},Season))%>%
    group_by(Home)%>%
    dplyr::summarise(Home_Wins=sum(Home_win),Home_games=n(),Home_Loses=Home_games-Home_Wins)%>%
    dplyr::select(Home_games,Home_Wins,Home_Loses)%>%
    dplyr::rename("Home Loses on Regular Season"=Home_Loses,
                  "Home Wins on Regular Season"=Home_Wins,
                  "Home Games on Regular Season"=Home_games)%>%
    reshape2::melt()
  
  Away_regular=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Away)&
                    Phase=="Regular Season"&
                    grepl({{season}},Season))%>%
    group_by(Away)%>%
    dplyr::summarise(Away_games=n(),Away_Wins=sum(Away_win),Away_Loses=Away_games-Away_Wins)%>%
    dplyr::rename("Away Loses on Regular Season"=Away_Loses,
                  "Away Wins on Regular Season"=Away_Wins,
                  "Away Games on Regular Season"=Away_games)%>%
    dplyr::select(-Away)%>%reshape2::melt()
  
    
  Total_playoffs=rbind(dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Home)&Phase=="Play offs"&grepl({{season}},Season))%>%
                                 group_by(Home)%>%
                                 dplyr::summarise(Wins=sum(Home_win))%>%
                                 dplyr::rename(Team=Home),
                               dataset_results%>%
                                 dplyr::filter(grepl({{Team1}}, Away)&Phase=="Play offs"&grepl({{season}},Season))%>%
                                 group_by(Away)%>%
                                 dplyr::summarise(Wins=sum(Away_win))%>%
                                 dplyr::rename(Team=Away))%>%group_by(Team)%>%
    dplyr::summarise(Wins=sum(Wins))%>%
    add_column(Games=Games_playoffs$Total_games)%>%
    mutate(Loses=Games-Wins)%>%dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses on Play offs"=Loses,
                  "Total Wins on Play offs"=Wins,
                  "Total Games on Play offs"=Games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  
  Home_playoffs=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Home)&Phase=="Play offs"&grepl({{season}},Season))%>%
    group_by(Home)%>%
    dplyr::summarise(Home_games=n(),Home_Wins=sum(Home_win),Home_Loses=Home_games-Home_Wins)%>%
    dplyr::rename(Team=Home,
                  "Home Loses on Play offs"=Home_Loses,
                  "Home Wins on Play offs"=Home_Wins,
                  "Home Games on Play offs"=Home_games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  
  Away_playoffs=dataset_results%>%
    dplyr::filter(grepl({{Team1}}, Away)&Phase=="Play offs"&grepl({{season}},Season))%>%
    group_by(Away)%>%
    dplyr::summarise(Away_games=n(),Away_Wins=sum(Away_win),Away_Loses=Away_games-Away_Wins)%>%
    dplyr::rename(Team=Away,
                  "Away Loses on Play offs"=Away_Loses,
                  "Away Wins on Play offs"=Away_Wins,
                  "Away Games on Play offs"=Away_games)%>%
    dplyr::select(-Team)%>%reshape2::melt()  
  
  Total_finalfour=rbind(dataset_results%>%
                          dplyr::filter(grepl({{Team1}}, Home)&Phase=="Final Four"&grepl({{season}},Season))%>%
                          group_by(Home)%>%
                          dplyr::summarise(Wins=sum(Home_win))%>%
                          dplyr::rename(Team=Home),
                        dataset_results%>%
                          dplyr::filter(grepl({{Team1}}, Away)&Phase=="Final Four"&grepl({{season}},Season))%>%
                          group_by(Away)%>%
                          dplyr::summarise(Wins=sum(Away_win))%>%
                          dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%add_column(Games=Games_finalfour$Total_games)%>%
    mutate(Loses=Games-Wins)%>%
    dplyr::select(Team,Games,Wins,Loses)%>%
    dplyr::rename("Total Loses on Final Four"=Loses,
                  "Total Wins on Final Four"=Wins,
                  "Total Games on Final Four"=Games)%>%
    dplyr::select(-Team)%>%reshape2::melt()
  table=rbind(Total,Total_regular,Home_regular,Away_regular,Total_playoffs,Home_playoffs,Away_playoffs,Total_finalfour)%>%
    dplyr::rename(For=variable,Total=value)
  return(list(Total,Total_regular,Home_regular,Away_regular,Total_playoffs,Home_playoffs,Away_playoffs,Total_finalfour,table))
}

Games_summary_between_teams=function(dataset_results,Team1,Team2,Season){
Games=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
  dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&grepl({{Season}},Season))%>%dplyr::summarise(Total_games=n_unique(idseason))

Games_regular_playoffs=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
  dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase!="Final Four"&grepl({{Season}},Season))%>%dplyr::summarise(Total_games=n_unique(idseason))

Games_finalfour=dataset_results%>%mutate(idseason=paste0(IDGAME,"_",Season))%>%
  dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase=="Final Four"&grepl({{Season}},Season))%>%dplyr::summarise(Total_games=n_unique(idseason))


Total=rbind(dataset_results%>%
  dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&grepl({{Season}},Season))%>%
  group_by(Home)%>%
  dplyr::summarise(Wins=sum(Home_win))%>%
  dplyr::rename(Team=Home),
dataset_results%>%
  dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&grepl({{Season}},Season))%>%
  group_by(Away)%>%
  dplyr::summarise(Wins=sum(Away_win))%>%
  dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%add_column(Games=Games$Total_games)%>%
  dplyr::select(Team,Wins,Games)


Total_regular_playoffs=rbind(dataset_results%>%
              dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase!="Final Four"&grepl({{Season}},Season))%>%
              group_by(Home)%>%
              dplyr::summarise(Wins=sum(Home_win))%>%
              dplyr::rename(Team=Home),
            dataset_results%>%
              dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase!="Final Four"&grepl({{Season}},Season))%>%
              group_by(Away)%>%
              dplyr::summarise(Wins=sum(Away_win))%>%
              dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%add_column(Games=Games_regular_playoffs$Total_games)%>%
  mutate(Loses=Games-Wins)%>%dplyr::select(Team,Wins,Games)

Home=dataset_results%>%
  dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase!="Final Four"&grepl({{Season}},Season))%>%
  group_by(Home)%>%
  dplyr::summarise(Home_Wins=sum(Home_win),Home_games=n())%>%
  dplyr::rename(Team=Home)

Away=dataset_results%>%
    dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase!="Final Four"&grepl({{Season}},Season))%>%
    group_by(Away)%>%
    dplyr::summarise(Away_Wins=sum(Away_win),Away_games=n())%>%
  dplyr::rename(Team=Away)
  
Total_finalfour=rbind(dataset_results%>%
                               dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase=="Final Four"&grepl({{Season}},Season))%>%
                               group_by(Home)%>%
                               dplyr::summarise(Wins=sum(Home_win))%>%
                               dplyr::rename(Team=Home),
                             dataset_results%>%
                               dplyr::filter(((grepl({{Team1}}, Home)&grepl({{Team2}}, Away))|(grepl({{Team2}},Home)&grepl({{Team1}}, Away)))&Phase=="Final Four"&grepl({{Season}},Season))%>%
                               group_by(Away)%>%
                               dplyr::summarise(Wins=sum(Away_win))%>%
                               dplyr::rename(Team=Away))%>%group_by(Team)%>%dplyr::summarise(Wins=sum(Wins))%>%add_column(Games=Games_finalfour$Total_games)%>%
  mutate(Loses=Games-Wins)%>%
  dplyr::select(Team,Wins,Games)
return(list(Total,Total_regular_playoffs,Home,Away,Total_finalfour))
}

search_team=function(dt,Team1,ph,ha,result,season){
Total_teams=dt%>%
  dplyr::filter(Team=={{Team1}} & grepl({{ha}},HA)& grepl({{result}},results) & grepl({{ph}},Phase) &grepl({{season}},Season))%>%
    dplyr::summarise(Team={{Team1}},
                     Total_games=n_unique(idseason),
                     Points=round(sum(PTS)/Total_games,1),
                     Assists=round(sum(AS)/Total_games,1),
                     Steals=round(sum(ST)/Total_games,1),
                     Turnovers=round(sum(TO)/Total_games,1),
                     Off_Reb=round(sum(OR)/Total_games,1),
                     Def_Reb=round(sum(DR)/Total_games,1),
                     Tot_Reb=round(sum(TR)/Total_games,1),
                     Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                     Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                     Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                     Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                     Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                     Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                     Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                     Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                     Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                     Fouls=round(sum(PF)/Total_games,1),
                     Blocks=round(sum(BLK)/Total_games,1),
                     PIR=round(sum(PIR)/Total_games,1),
                     Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                     Offensive_Rating=100*round(Points/Possesions,3),
                     EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                     True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                     FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                     As_To_Ratio=round(Assists/Turnovers,2),
                     Turnover_ratio=round((Turnovers)/Possesions,2),
                     Assists_ratio=round((Assists)/Possesions,2))%>%
  reshape2::melt()%>%
  dplyr::select(-Team)%>%
  setnames(old=c("variable","value"),
           new=c("Stats",{{Team1}}))

Total_teams_conceed=dt%>%mutate(result1=ifelse(results=="W","L","W"),
                                HA1=ifelse(HA=="A","H","A"))%>%
  dplyr::filter(Against=={{Team1}} & grepl({{ha}},HA1)& grepl({{result}},result1)&grepl({{ph}},Phase)&grepl({{season}},Season))%>%
             dplyr::summarise(Team={{Team1}},
                              Total_games=n_unique(idseason),
                              Points_conceed=round(sum(PTS)/Total_games,1),
                              Assists_conceed=round(sum(AS)/Total_games,1),
                              Steals_conceed=round(sum(ST)/Total_games,1),
                              Turnovers_conceed=round(sum(TO)/Total_games,1),
                              Off_Reb_conceed=round(sum(OR)/Total_games,1),
                              Def_Reb_conceed=round(sum(DR)/Total_games,1),
                              Tot_Reb_conceed=round(sum(TR)/Total_games,1),
                              Field_goal_2p_attemped_conceed=round(sum(F2A)/Total_games,1),
                              Field_goal_2p_made_conceed=round(sum(F2M)/Total_games,1),
                              Percentage_2P_conceed=100*round(Field_goal_2p_made_conceed/Field_goal_2p_attemped_conceed,3),
                              Field_goal_3p_attemped_conceed=round(sum(F3A)/Total_games,1),
                              Field_goal_3p_made_conceed=round(sum(F3M)/Total_games,1),
                              Percentage_3P_conceed=100*round(Field_goal_3p_made_conceed/Field_goal_3p_attemped_conceed,3),
                              Field_goal_FT_attemped_conceed=round(sum(FTA)/Total_games,1),
                              Field_goal_FT_made_conceed=round(sum(FTM)/Total_games,1),
                              Percentage_FT_conceed=100*round(Field_goal_FT_made_conceed/Field_goal_FT_attemped_conceed,3),
                              Fouls_conceed=round(sum(PF)/Total_games,1),
                              Blocks_conceed=round(sum(BLK)/Total_games,1),
                              PIR_conceed=round(sum(PIR)/Total_games,1),
                              Possesions_conceed=round(0.96*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed-Off_Reb_conceed+Turnovers_conceed+0.44*Field_goal_FT_attemped_conceed),1),
                              Defensive_Rating=100*round(Points_conceed/Possesions_conceed,3),
                              EFG_conceed=100*round((Field_goal_2p_made_conceed+1.5*Field_goal_3p_made_conceed)/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),3),
                              True_Shooting_conceed=100*round((Points_conceed)/(2*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed+0.44*Field_goal_FT_attemped_conceed)),3),
                              FT_ratio_conceed=round(Field_goal_FT_attemped_conceed/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),2),
                              As_To_Ratio_conceed=round(Assists_conceed/Turnovers_conceed,2),
                              Turnover_ratio_conceed=round((Turnovers_conceed)/Possesions_conceed,2),
                              Assists_ratio_conceed=round((Assists_conceed)/Possesions_conceed,2))%>%
             reshape2::melt()%>%dplyr::select(-Team)%>%
             setnames(old=c("variable","value"),new=c("Stats",{{Team1}}))
  

Total_teams_basic=Total_teams%>%
                          dplyr::filter(grepl("Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&Stats!="Assists_ratio")%>%
  dplyr::rename("Euroleague Basic Stats"=Stats)%>%
  add_column(arr=c(9:1))%>%
  arrange(desc(arr))%>%dplyr::select(-arr)

Total_teams_basic_opp=Total_teams_conceed%>%                          dplyr::filter(grepl("Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&Stats!="Assists_ratio_conceed")%>%
  mutate(Stats = str_replace(Stats, "Points_conceed", "Points conceed"),
         Stats = str_replace(Stats, "Assists_conceed", "Assists allowed"),
         Stats = str_replace(Stats, "Blocks_conceed", "Blocks Against"),
         Stats = str_replace(Stats, "Def_Reb_conceed", "Def Reb opp taken"),
         Stats = str_replace(Stats, "Off_Reb_conceed", "Off Reb opp taken"),
         Stats = str_replace(Stats, "Tot_Reb_conceed", "Total Reb opp taken"),
         Stats = str_replace(Stats, "Fouls_conceed", "Fouls drawn"),
         Stats = str_replace(Stats, "Steals_conceed", "Steals conceed"),
         Stats = str_replace(Stats, "Turnovers_conceed", "Turnovers opp done"))%>%
  dplyr::rename("Euroleague opponents Basic Stats"=Stats)%>%
  add_column(arr=c(9:1))%>%
  arrange(desc(arr))%>%dplyr::select(-arr)

Total_teams_shoots=Total_teams%>%
                           dplyr::filter(grepl("Field_goal_2p_attemped|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats))%>%
  mutate(Stats = str_replace(Stats, "Field_goal_2p_attemped", "2P attempt"),
         Stats = str_replace(Stats, "Field_goal_2p_made", "2P made"),
         Stats = str_replace(Stats, "Field_goal_3p_attemped", "3P attempt"),
         Stats = str_replace(Stats, "Field_goal_3p_made", "3P made"),
         Stats = str_replace(Stats, "Field_goal_FT_attemped", "Free throws attempt"),
         Stats = str_replace(Stats, "Field_goal_FT_made", "Free throws made"),
         Stats = str_replace(Stats, "Percentage_FT", "FT(%)"),
         Stats = str_replace(Stats, "Percentage_2P", "2P(%)"),
         Stats = str_replace(Stats, "Percentage_3P", "3P(%)"),
         Stats = str_replace(Stats, "_conceed", " opp"))%>%
  dplyr::rename("Euroleague Shooting Stats"=Stats)%>%
  add_column(arr=c(9:1))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)
Total_teams_shoots_opp=Total_teams_conceed%>%
                           dplyr::filter(grepl("Field_goal_2p_attemped|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats))%>%
  mutate(Stats = str_replace(Stats, "Field_goal_2p_attemped", "2P attempt"),
         Stats = str_replace(Stats, "Field_goal_2p_made", "2P made"),
         Stats = str_replace(Stats, "Field_goal_3p_attemped", "3P attempt"),
         Stats = str_replace(Stats, "Field_goal_3p_made", "3P made"),
         Stats = str_replace(Stats, "Field_goal_FT_attemped", "Free throws attempt"),
         Stats = str_replace(Stats, "Field_goal_FT_made", "Free throws made"),
         Stats = str_replace(Stats, "Percentage_FT", "FT(%)"),
         Stats = str_replace(Stats, "Percentage_2P", "2P(%)"),
         Stats = str_replace(Stats, "Percentage_3P", "3P(%)"),
         Stats = str_replace(Stats, "_conceed", " opp"))%>%
  dplyr::rename("Euroleague opponents Shooting Stats"=Stats)%>%add_column(arr=c(9:1))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)

Total_teams_advanced=Total_teams%>%
                             dplyr::filter(grepl("PIR|Assists_ratio|FT_ratio|Offensive_Rating|Turnover_ratio|EFG|True_Shooting|Possesions",Stats))%>%
  mutate(Stats = str_replace(Stats, "_conceed", " opp"))%>%
  dplyr::rename("Euroleague Advanced Stats"=Stats)%>%
  add_column(arr=c(8:1))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)  
Total_teams_advanced_opp=Total_teams_conceed%>%
                             dplyr::filter(grepl("PIR|Assists_ratio|FT_ratio|Defensive_Rating|Turnover_ratio|EFG|True_Shooting|Possesions",Stats))%>%
  dplyr::rename("Euroleague opponents' Advanced Stats"=Stats)%>%
  add_column(arr=c(8:1))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr)  

return(list(Total_teams_basic,Total_teams_basic_opp,Total_teams_shoots,Total_teams_shoots_opp,Total_teams_advanced,Total_teams_advanced_opp))
}

teamplayersstats=function(dataset_players,ha,wl,ph,season,Team){
  
  Total_games=dataset_players%>%filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season)& Team=={{Team}})%>%
  group_by(Team,Player)%>%summarise(G=n())

Total_seasons=dataset_players%>%filter(Team=={{Team}})%>%group_by(Player,Season)%>%summarise(a1=n())%>%group_by(Player)%>%summarise(Seasons=n())

  Total_stats=dataset_players%>%filter(grepl({{ha}}, HA) & grepl({{wl}},results)& grepl({{ph}},Phase)& grepl({{season}},Season)& Team=={{Team}})%>%
  group_by(Player)%>%summarise(T_PTS=round(sum(PTS,na.rm=T),1),
                                                T_AS=round(sum(AS,na.rm=T),1),
                                                T_DR=round(sum(DR,na.rm=T),1),
                                                T_OR=round(sum(OR,na.rm=T),1),
                                                T_TR=round(sum(TR,na.rm=T),1),
                                                T_ST=round(sum(ST,na.rm=T),1),
                                                T_TO=round(sum(TO,na.rm=T),1),
                                                T_BLK=round(sum(BLK,na.rm=T),1),
                                                T_BLKR=round(sum(BLKR,na.rm=T),1),
                                                T_PF=round(sum(PF,na.rm=T),1),
                                                T_RF=round(sum(RF,na.rm=T),1),
                                                T_F2M=round(sum(F2M,na.rm=T),1),
                                                T_F2A=round(sum(F2A,na.rm=T),1),
                                                T_F3M=round(sum(F3M,na.rm=T),1),
                                                T_F3A=round(sum(F3A,na.rm=T),1),
                                                T_FTM=round(sum(FTM,na.rm=T),1),
                                                T_FTA=round(sum(FTA,na.rm=T),1),
                                                T_PIR=round(sum(PIR,na.rm=T),1),
                                                T_MIN=round(sum(MIN,na.rm=T),1),
                                                PTS=round(mean(PTS,na.rm=T),1),
                                                AS=round(mean(AS,na.rm=T),1),
                                                DR=round(mean(DR,na.rm=T),1),
                                                OR=round(mean(OR,na.rm=T),1),
                                                TR=round(mean(TR,na.rm=T),1),
                                                ST=round(mean(ST,na.rm=T),1),
                                                TO=round(mean(TO,na.rm=T),1),
                                                BLK=round(mean(BLK,na.rm=T),1),
                                                BLKR=round(mean(BLKR,na.rm=T),1),
                                                PF=round(mean(PF,na.rm=T),1),
                                                RF=round(mean(RF,na.rm=T),1),
                                                F2M=round(mean(F2M,na.rm=T),1),
                                                F2A=round(mean(F2A,na.rm=T),1),
                                                P2=100*round(F2M/F2A,3),
                                                F3M=round(mean(F3M,na.rm=T),1),
                                                F3A=round(mean(F3A,na.rm=T),1),
                                                P3=100*round(F3M/F3A,3),
                                                FTM=round(mean(FTM,na.rm=T),1),
                                                FTA=round(mean(FTA,na.rm=T),1),
                                                PFT=100*round(FTM/FTA,3),
                                                PIR=round(mean(PIR,na.rm=T),1),
                                                MIN=round(mean(MIN,na.rm=T),1),
                                                Team_PTS=round(mean(Team_PTS,na.rm=T),1),
                                           Team_AS=round(mean(Team_AS,na.rm=T),1),
                                           Team_DR=round(mean(Team_DR,na.rm=T),1),
                                           Team_OR=round(mean(Team_OR,na.rm=T),1),
                                           Team_TR=round(mean(Team_TR,na.rm=T),1),
                                           Team_ST=round(mean(Team_ST,na.rm=T),1),
                                           Team_TO=round(mean(Team_TO,na.rm=T),1),
                                           Team_BLK=round(mean(Team_BLK,na.rm=T),1),
                                           Team_PF=round(mean(Team_PF,na.rm=T),1),
                                           Team_F2M=round(mean(Team_F2M,na.rm=T),1),
                                           Team_F2A=round(mean(Team_F2A,na.rm=T),1),
                                           Team_F3M=round(mean(Team_F3M,na.rm=T),1),
                                           Team_F3A=round(mean(Team_F3A,na.rm=T),1),
                                           Team_FTM=round(mean(Team_FTM,na.rm=T),1),
                                           Team_FTA=round(mean(Team_FTA,na.rm=T),1),
                                           Team_opp_PTS=round(mean(Team_opp_PTS,na.rm=T),1),
                                           Team_opp_AS=round(mean(Team_opp_AS,na.rm=T),1),
                                           Team_opp_DR=round(mean(Team_opp_DR,na.rm=T),1),
                                           Team_opp_OR=round(mean(Team_opp_OR,na.rm=T),1),
                                           Team_opp_TR=round(mean(Team_opp_TR,na.rm=T),1),
                                           Team_opp_ST=round(mean(Team_opp_ST,na.rm=T),1),
                                           Team_opp_TO=round(mean(Team_opp_TO,na.rm=T),1),
                                           Team_opp_BLK=round(mean(Team_opp_BLK,na.rm=T),1),
                                           Team_opp_PF=round(mean(Team_opp_PF,na.rm=T),1),
                                           Team_opp_F2M=round(mean(Team_opp_F2M,na.rm=T),1),
                                           Team_opp_F2A=round(mean(Team_opp_F2A,na.rm=T),1),
                                           Team_opp_F3M=round(mean(Team_opp_F3M,na.rm=T),1),
                                           Team_opp_F3A=round(mean(Team_opp_F3A,na.rm=T),1),
                                           Team_opp_FTM=round(mean(Team_opp_FTM,na.rm=T),1),
                                           Team_opp_FTA=round(mean(Team_opp_FTA,na.rm=T),1))%>%
  mutate(PPS = round(PTS/ (F3A +F2A+FTA),2),
         POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
         OFFRA=round(100*PTS/POS,1),
         PIE=round((PTS+F2M+F3M+FTM-(F2A+F3A+FTA)+DR+0.5*OR-PF-TO+0.5*BLK+ST+AS)/((Team_PTS+Team_F2M+Team_F3M+Team_FTM-(Team_F2A+Team_F3A+Team_FTA)+Team_AS+Team_DR+Team_OR*0.5+Team_ST+0.5*Team_BLK-Team_PF-Team_TO)+(Team_opp_PTS+Team_opp_F2M+Team_opp_F3M+Team_opp_FTM-(Team_opp_F2A+Team_opp_F3A+Team_opp_FTA)+Team_opp_AS+Team_opp_DR+Team_opp_OR*0.5+Team_opp_ST+0.5*Team_opp_BLK-Team_opp_PF-Team_opp_TO)),2),
         ASR=round(100*AS/POS,1),
         ASTOR=round(AS/TO,1),
         EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1),
         FTR =  round(FTA / (F3A +F2A),2),
         GS = round(PTS + (0.4 * (F3M +F2M)) - (0.7 * (F3A +F2A)) - (0.4 * (FTA - FTM)) + (0.7 * OR) + (0.3 * DR) + ST + (0.7 * AS) + (0.7 * BLK) - (0.4 * PF) - TO,1),
         TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1),
         TOR = round((TO * 100) / POS,2),
         Usage = round(100 * (((F3A +F2A) + 0.44 *FTA + TO) * ( 40 )) / (MIN * (Team_F2A+Team_F3A + 0.44 *Team_FTA + Team_TO)),1),
         ORP = round(100*OR / (Team_OR +Team_opp_OR),1))

Total=merge(Total_stats,Total_seasons,all=TRUE)%>%merge(Total_games,all=TRUE)%>%filter(G>0)%>%
  dplyr::select(Player,G,Seasons,MIN,PTS,AS,ASR,F2M,F2A,P2,F3M,F3A,P3,EFG,TS,
                FTM,FTA,PFT,FTR,DR,OR,ORP,TR,ST,TO,TOR,ASTOR,
                PF,RF,BLK,BLKR,PIR,PPS,POS,OFFRA,PIE,GS,Usage,
                T_MIN,T_PTS,T_AS,T_F2M,T_F2A,T_F3M,T_F3A,T_FTM,T_FTA,T_DR,T_OR,T_TR,
                T_ST,T_TO,T_PF,T_RF,T_BLK,T_BLKR,T_PIR)

return(Total)
}

compare_teams=function(Team1,season,phase,ha,Result){
  Total_teams=rbind(All_Seasons%>%
                      dplyr::filter(Team=={{Team1}} & 
                                      grepl({{season}},Season) & 
                                      grepl({{phase}},Phase) &
                                      grepl({{ha}},HA)& 
                                      grepl({{Result}},results))%>%
  dplyr::summarise(Team={{Team1}},
                   Total_games=n_unique(idseason),
                   Points=round(sum(PTS)/Total_games,1),
                   Assists=round(sum(AS)/Total_games,1),
                   Steals=round(sum(ST)/Total_games,1),
                   Turnovers=round(sum(TO)/Total_games,1),
                   Off_Reb=round(sum(OR)/Total_games,1),
                   Def_Reb=round(sum(DR)/Total_games,1),
                   Tot_Reb=round(sum(TR)/Total_games,1),
                   Field_goal_2p_attemped=round(sum(F2A)/Total_games,1),
                   Field_goal_2p_made=round(sum(F2M)/Total_games,1),
                   Percentage_2P=100*round(Field_goal_2p_made/Field_goal_2p_attemped,3),
                   Field_goal_3p_attemped=round(sum(F3A)/Total_games,1),
                   Field_goal_3p_made=round(sum(F3M)/Total_games,1),
                   Percentage_3P=100*round(Field_goal_3p_made/Field_goal_3p_attemped,3),
                   Field_goal_FT_attemped=round(sum(FTA)/Total_games,1),
                   Field_goal_FT_made=round(sum(FTM)/Total_games,1),
                   Percentage_FT=100*round(Field_goal_FT_made/Field_goal_FT_attemped,3),
                   Fouls=round(sum(PF)/Total_games,1),
                   Blocks=round(sum(BLK)/Total_games,1),
                   PIR=round(sum(PIR)/Total_games,1),
                   Possesions=round(0.96*(Field_goal_2p_attemped+Field_goal_3p_attemped-Off_Reb+Turnovers+0.44*Field_goal_FT_attemped),1),
                   Offensive_Rating=100*round(Points/Possesions,3),
                   EFG=100*round((Field_goal_2p_made+1.5*Field_goal_3p_made)/(Field_goal_2p_attemped+Field_goal_3p_attemped),3),
                   True_Shooting=100*round((Points)/(2*(Field_goal_2p_attemped+Field_goal_3p_attemped+0.44*Field_goal_FT_attemped)),3),
                   FT_ratio=round(Field_goal_FT_attemped/(Field_goal_2p_attemped+Field_goal_3p_attemped),2),
                   As_To_Ratio=round(Assists/Turnovers,2),
                   Turnover_ratio=round((Turnovers)/Possesions,2),
                   Assists_ratio=round((Assists)/Possesions,2),
                   Assisted_FG=round(Assists/(Field_goal_3p_made+Field_goal_2p_made),2))%>%
  reshape2::melt()%>%dplyr::select(-Team)%>%
  rename(Stats=variable,Team1=value),
  All_Seasons%>%mutate(result1=ifelse(results=="W","L","W"),
                        HA1=ifelse(HA=="A","H","A"))%>%
          dplyr::filter(Against=={{Team1}} & grepl({{season}},Season) & grepl({{phase}},Phase) & grepl({{ha}},HA1) & grepl({{Result}},result1))%>%
          dplyr::summarise(Total_games=n_unique(idseason),
                           Points_conceed=round(sum(PTS)/Total_games,1),
                           Assists_conceed=round(sum(AS)/Total_games,1),
                           Steals_conceed=round(sum(ST)/Total_games,1),
                           Turnovers_conceed=round(sum(TO)/Total_games,1),
                           Off_Reb_conceed=round(sum(OR)/Total_games,1),
                           Def_Reb_conceed=round(sum(DR)/Total_games,1),
                           Tot_Reb_conceed=round(sum(TR)/Total_games,1),
                           Field_goal_2p_attemped_conceed=round(sum(F2A)/Total_games,1),
                           Field_goal_2p_made_conceed=round(sum(F2M)/Total_games,1),
                           Percentage_2P_conceed=100*round(Field_goal_2p_made_conceed/Field_goal_2p_attemped_conceed,3),
                           Field_goal_3p_attemped_conceed=round(sum(F3A)/Total_games,1),
                           Field_goal_3p_made_conceed=round(sum(F3M)/Total_games,1),
                           Percentage_3P_conceed=100*round(Field_goal_3p_made_conceed/Field_goal_3p_attemped_conceed,3),
                           Field_goal_FT_attemped_conceed=round(sum(FTA)/Total_games,1),
                           Field_goal_FT_made_conceed=round(sum(FTM)/Total_games,1),
                           Percentage_FT_conceed=100*round(Field_goal_FT_made_conceed/Field_goal_FT_attemped_conceed,3),
                           Fouls_conceed=round(sum(PF)/Total_games,1),
                           Blocks_conceed=round(sum(BLK)/Total_games,1),
                           PIR_conceed=round(sum(PIR)/Total_games,1),
                           Possesions_conceed=round(0.96*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed-Off_Reb_conceed+Turnovers_conceed+0.44*Field_goal_FT_attemped_conceed),1),
                           Defensive_Rating=100*round(Points_conceed/Possesions_conceed,3),
                           EFG_conceed=100*round((Field_goal_2p_made_conceed+1.5*Field_goal_3p_made_conceed)/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),3),
                           True_Shooting_conceed=100*round((Points_conceed)/(2*(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed+0.44*Field_goal_FT_attemped_conceed)),3),
                           FT_ratio_conceed=round(Field_goal_FT_attemped_conceed/(Field_goal_2p_attemped_conceed+Field_goal_3p_attemped_conceed),2),
                           As_To_Ratio_conceed=round(Assists_conceed/Turnovers_conceed,2),
                           Turnover_ratio_conceed=round((Turnovers_conceed)/Possesions_conceed,2),
                           Assists_ratio_conceed=round((Assists_conceed)/Possesions_conceed,2),
                           Assisted_FG_conceed=round(Assists_conceed/(Field_goal_3p_made_conceed+Field_goal_2p_made_conceed),2))%>%
          reshape2::melt()%>%
          dplyr::rename(Stats=variable,Team1=value))


Total_teams_basic=Total_teams%>%
                          dplyr::filter(grepl("PIR|Assists|Blocks|Def_Reb|Fouls|Off_Reb|Points|Steals|Tot_Reb|Turnovers",Stats)&
                                          !grepl("Assists_ratio|Assists_ratio_conceed",Stats))%>%
  mutate(Stats = str_replace(Stats, "Points_conceed", "Points conceed"),
         Stats = str_replace(Stats, "Assists_conceed", "Assists allowed"),
         Stats = str_replace(Stats, "Blocks_conceed", "Blocks Against"),
         Stats = str_replace(Stats, "Def_Reb_conceed", "Def Reb opp taken"),
         Stats = str_replace(Stats, "Off_Reb_conceed", "Off Reb opp taken"),
         Stats = str_replace(Stats, "Tot_Reb_conceed", "Total Reb opp taken"),
         Stats = str_replace(Stats, "Fouls_conceed", "Fouls drawn"),
         Stats = str_replace(Stats, "Steals_conceed", "Steals conceed"),
         Stats = str_replace(Stats, "Turnovers_conceed", "Turnovers opp done"),
         Stats = str_replace(Stats, "_conceed", " opp"))

  

Total_teams_shoots=Total_teams%>%
                           dplyr::filter(grepl("Field_goal_2p_attemped|FT_ratio|EFG|True_Shooting|Field_goal_2p_made|Field_goal_3p_attemped|Field_goal_3p_made|Field_goal_FT_attemped|Field_goal_FT_made|Percentage_2P|Percentage_3P|Percentage_FT",Stats))%>%
  mutate(Stats = str_replace(Stats, "Field_goal_2p_attemped", "2P attempt"),
         Stats = str_replace(Stats, "Field_goal_2p_made", "2P made"),
         Stats = str_replace(Stats, "Field_goal_3p_attemped", "3P attempt"),
         Stats = str_replace(Stats, "Field_goal_3p_made", "3P made"),
         Stats = str_replace(Stats, "Field_goal_FT_attemped", "Free throws attempt"),
         Stats = str_replace(Stats, "Field_goal_FT_made", "Free throws made"),
         Stats = str_replace(Stats, "Percentage_FT", "FT(%)"),
         Stats = str_replace(Stats, "Percentage_2P", "2P(%)"),
         Stats = str_replace(Stats, "Percentage_3P", "3P(%)"),
         Stats = str_replace(Stats, "_conceed", " opp"))

Total_teams_advanced=Total_teams%>%
                             dplyr::filter(grepl("Assists_ratio|Offensive_Rating|Defensive_Rating|Turnover_ratio|Possesions|As_To_Ratio|Assisted_FG",Stats))%>%
  mutate(Stats = str_replace(Stats, "_conceed", " opp"))
return(list(Total_teams_basic,Total_teams_shoots,Total_teams_advanced))
}

compute_best_stats=function(dataset_players,stat,season){
  
  compute_games=dataset_players%>%
            dplyr::filter(grepl({{season}},Season))%>%
    mutate(Name=paste0(Player," (",Team,"-",Season,") vs ",Against))%>%
            arrange(desc({{stat}}))%>%head(5)%>%
    dplyr::select(Name,{{stat}})
  
  return(compute_games)
}

compute_best_stats_teams=function(dataset_players,stat,season){
  
  compute_games_high=dataset_players%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
    dplyr::filter(grepl("",Season))%>%group_by(idseason,Name)%>%
    summarise(Total=sum({{stat}},na.rm = TRUE))%>%
    arrange(desc(Total))%>%head(5)
  
  compute_games_low=dataset_players%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
    dplyr::filter(grepl("",Season))%>%group_by(idseason,Name)%>%
    summarise(Total=sum({{stat}},na.rm = TRUE))%>%
    arrange(desc(Total))%>%tail(5)
  compute_games=rbind(compute_games_high,compute_games_low)
  return(list(compute_games_high,compute_games_low))
}

period_points=function(dataset_results,Team_select,Season,Phase,ha,result){
points=rbind(dataset_results%>%
  dplyr::rename(Team=Home,Against=Away,Points=Home_Points,Conceed=Away_Points,
                Q1S=Q1H,Q2S=Q2H,Q3S=Q3H,Q4S=Q4H,EXS=EXH,
                Q1C=Q1A,Q2C=Q2A,Q3C=Q3A,Q4C=Q4A,EXC=EXA,Win1=Home_win)%>%
  mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="H",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),Win=ifelse(Win1==0,"L","W"))%>%
  dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Win,HA)%>%
    dplyr::filter(grepl({{Season}},Season)& grepl({{Phase}},Phase)& grepl({{ha}},HA)& grepl({{result}},Win)),
  dataset_results%>%
    dplyr::rename(Team=Away,Against=Home,Points=Away_Points,Conceed=Home_Points,
                  Q1S=Q1A,Q2S=Q2A,Q3S=Q3A,Q4S=Q4A,EXS=EXA,
                  Q1C=Q1H,Q2C=Q2H,Q3C=Q3H,Q4C=Q4H,EXC=EXH,Win1=Away_win)%>%
    mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="A",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),Win=ifelse(Win1==0,"L","W"))%>%
    dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Win,HA)%>%
    dplyr::filter(grepl({{Season}},Season)& grepl({{Phase}},Phase)& grepl({{ha}},HA)& grepl({{result}},Win)))%>%
  group_by(Team)%>%summarise(Q1S=round(mean(Q1S),1),Q1C=round(mean(Q1C),1),Q2S=round(mean(Q2S),1),Q2C=round(mean(Q2C),1),FHS=round(mean(FHS),1),FHC=round(mean(FHC),1),
                             Q3S=round(mean(Q3S),1),Q3C=round(mean(Q3C),1),Q4S=round(mean(Q4S),1),Q4C=round(mean(Q4C),1),SHS=round(mean(SHS),1),SHC=round(mean(SHC),1),
                             EXS=round(mean(EXS1,na.rm = TRUE),2),EXC=round(mean(EXC1,na.rm = TRUE),2))%>%
  dplyr::filter(Team=={{Team_select}})%>%reshape2::melt()%>%
  mutate(variable = str_replace(variable, "Q1S", "Q1 Scored"),
         variable = str_replace(variable, "Q1C", "Q1 Conceed"),
         variable = str_replace(variable, "Q2S", "Q2 Scored"),
         variable = str_replace(variable, "Q2C", "Q2 Conceed"),
         variable = str_replace(variable, "FHS", "First Half Scored"),
         variable = str_replace(variable, "FHC", "First Half Conceed"),
         variable = str_replace(variable, "Q3S", "Q3 Scored"),
         variable = str_replace(variable, "Q3C", "Q3 Conceed"),
         variable = str_replace(variable, "Q4S", "Q4 Scored"),
         variable = str_replace(variable, "Q4C", "Q4 Conceed"),
         variable = str_replace(variable, "SHS", "Second Half Scored"),
         variable = str_replace(variable, "SHC", "Second Half Conceed"),
         variable = str_replace(variable, "EXS", "ET Scored"),
         variable = str_replace(variable, "EXC", "ET Conceed"))%>%
  dplyr::select(-Team)%>%dplyr::rename(Period=variable,Points=value)

scored=merge(points%>%dplyr::filter(grepl("Scored",Period))%>%
  mutate(Period = str_replace(Period, "Scored", ""))%>%dplyr::rename(Scored=Points),
points%>%dplyr::filter(grepl("Conceed",Period))%>%
  mutate(Period = str_replace(Period, "Conceed", ""))%>%dplyr::rename(Conceed=Points),all=TRUE)%>%
  mutate(id=c(1,5,7,6,4,3,2))%>%arrange(desc(id))%>%select(-id)

return(scored)
}


team_stats_by_a_game=function(dataset_players,dataset_results,Team_select,ha,ph,wl,season){  
stats_team=merge(dataset_players%>%
   group_by(Team,IDGAME,Season,Against,Phase)%>%
   summarise(PTS=sum(PTS,na.rm=TRUE),
             AS=sum(AS,na.rm=TRUE),
             F2M=sum(F2M,na.rm=TRUE),
             F2A=sum(F2A,na.rm=TRUE),
             P2=100*round(F2M/F2A,3),
             F3M=sum(F3M,na.rm=TRUE),
             F3A=sum(F3A,na.rm=TRUE),
             P3=100*round(F3M/F3A,3),
             FTM=sum(FTM,na.rm=TRUE),
             FTA=sum(FTA,na.rm=TRUE),
             PFT=100*round(FTM/FTA,3),
             OR=sum(OR,na.rm=TRUE),
             DR=sum(DR,na.rm=TRUE),
             TR=sum(TR,na.rm=TRUE),
             TO=sum(TO,na.rm = TRUE),
             BLK=sum(BLK,na.rm = TRUE),
             BLKR=sum(BLKR,na.rm = TRUE),
             PF=sum(PF,na.rm = TRUE),
             RF=sum(RF,na.rm=TRUE),
             ST=sum(ST,na.rm=TRUE),
             PIR=sum(PIR,na.rm = TRUE)),
   dataset_players%>%
     group_by(Team,IDGAME,Season,Against)%>%
     summarise(opp_PTS=sum(PTS,na.rm=TRUE),
               opp_AS=sum(AS,na.rm=TRUE),
               opp_F2M=sum(F2M,na.rm=TRUE),
               opp_F2A=sum(F2A,na.rm=TRUE),
               opp_P2=100*round(opp_F2M/opp_F2A,3),
               opp_F3M=sum(F3M,na.rm=TRUE),
               opp_F3A=sum(F3A,na.rm=TRUE),
               opp_P3=100*round(opp_F3M/opp_F3A,3),
               opp_FTM=sum(FTM,na.rm=TRUE),
               opp_FTA=sum(FTA,na.rm=TRUE),
               opp_PFT=100*round(opp_FTM/opp_FTA,3),
               opp_OR=sum(OR,na.rm=TRUE),
               opp_DR=sum(DR,na.rm=TRUE),
               opp_TR=sum(TR,na.rm=TRUE),
               opp_TO=sum(TO,na.rm = TRUE),
               opp_ST=sum(ST,na.rm=TRUE),
               opp_PIR=sum(PIR,na.rm = TRUE))%>%
     dplyr::rename(Team=Against,Against=Team),all=TRUE)%>%
  merge(rbind(dataset_results%>%
                  dplyr::rename(Team=Home,Against=Away,Points=Home_Points,Conceed=Away_Points,
                                Q1S=Q1H,Q2S=Q2H,Q3S=Q3H,Q4S=Q4H,EXS=EXH,
                                Q1C=Q1A,Q2C=Q2A,Q3C=Q3A,Q4C=Q4A,EXC=EXA,Win=Home_win)%>%
                                mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="H",
                                       EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),
                                       Result=ifelse(Win==0,"L","W"))%>%
                                      dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Result,HA),
              dataset_results%>%
                                      dplyr::rename(Team=Away,Against=Home,Points=Away_Points,Conceed=Home_Points,
                                      Q1S=Q1A,Q2S=Q2A,Q3S=Q3A,Q4S=Q4A,EXS=EXA,
                                      Q1C=Q1H,Q2C=Q2H,Q3C=Q3H,Q4C=Q4H,EXC=EXH,Win=Away_win)%>%
                                      mutate(FHS=Q1S+Q2S,FHC=Q1C+Q2C,SHS=Q3S+Q4S,SHC=Q3C+Q4C,HA="A",EXS1=ifelse(EXS==0,NA,EXS),EXC1=ifelse(EXC==0,NA,EXC),
                                             Result=ifelse(Win==0,"L","W"))%>%
                                      dplyr::select(Fixture,IDGAME,Season,idseason,Phase,Team,Against,
                                                    Points,Conceed,Q1S,Q2S,FHS,Q3S,Q4S,SHS,EXS1,Q1C,Q2C,FHC,Q3C,Q4C,SHC,EXC1,Result,HA)),all=TRUE)%>%
  mutate(Total_PTS=PTS+opp_PTS,Total_AS=AS+opp_AS,Total_F2M=F2M+opp_F2M,Total_F2A=F2A+opp_F2A,Total_F3M=F3M+opp_F3M,Total_F3A=F3A+opp_F3A,
         Total_FTM=FTM+opp_FTM,Total_FTA=FTA+opp_FTA,Total_OR=OR+opp_OR,Total_DR=DR+opp_DR,Total_TR=TR+opp_TR,Total_TO=TO+opp_TO,Total_ST=ST+opp_ST,
         Total_BLK=BLK+BLKR,Total_FL=PF+RF,Fixture=as.numeric(Fixture))%>%
  select("Team","Season",Fixture,"Phase","Result","HA","Against","Q1S","Q2S","FHS","Q3S","Q4S","SHS","EXS1",
         "Q1C","Q2C","FHC","Q3C","Q4C","SHC",PTS,opp_PTS,Total_PTS,AS,opp_AS,Total_AS,"F2M","F2A","P2","opp_F2M","opp_F2A","opp_P2",Total_F2M,Total_F2A,"F3M","F3A","P3","opp_F3M","opp_F3A","opp_P3",Total_F3M,Total_F3A,"FTM","FTA","opp_FTA","opp_FTM","opp_FTA","opp_PFT",Total_FTM,Total_FTA,OR,opp_OR,Total_OR,DR,opp_DR,Total_DR,TR,opp_TR,Total_TR,TO,opp_TO,Total_TO,BLK,BLKR,Total_BLK,PF,RF,Total_FL,ST,opp_ST,Total_ST,PIR,opp_PIR)%>%
  dplyr::filter(Team=={{Team_select}}&grepl({{ha}}, HA) & grepl({{wl}},Result)& grepl({{ph}},Phase)& grepl({{season}},Season))%>%
  select(-Team)

return(stats_team)
}



players_stats_by_a_against_team=function(dataset_players,Against_team,Home_Away,Win_Lose,Phase,Season){
 data=dataset_players%>%mutate(Win=ifelse(results=="W",1,0))%>%filter(Against=={{Against_team}}&
                       grepl({{Home_Away}},HA)&
                       grepl({{Win_Lose}},results)&
                       grepl({{Phase}},Phase)&
                       grepl({{Season}},Season))%>%group_by(Player)%>%
                                               summarise(G=n(),
                                                   Wins=sum(Win),
                                                   PTS=round(mean(PTS,na.rm = T),1),
                                                   AS=round(mean(AS,na.rm=T),1),
                                                   OR=round(mean(OR,na.rm=T),1),
                                                   DR=round(mean(DR,na.rm=T),1),
                                                   TR=round(mean(TR,na.rm=T),1),
                                                   FTM=round(mean(FTM,na.rm=T),1),
                                                   FTA=round(mean(FTA,na.rm=T),1),
                                                   PFT=round(100*FTM/FTA,2),
                                                   F2M=round(mean(F2M,na.rm=T),1),
                                                   F2A=round(mean(F2A,na.rm=T),1),
                                                   P2=round(100*F2M/F2A,1),
                                                   F3M=round(mean(F3M,na.rm=T),1),
                                                   F3A=round(mean(F3A,na.rm=T),1),
                                                   P3=round(100*F3M/F3A,1),
                                                   ST=round(mean(ST,na.rm=T),1),
                                                   TO=round(mean(TO,na.rm=T),1),
                                                   BLK=round(mean(BLK,na.rm=T),1),
                                                   PF=round(mean(PF,na.rm=T),1),
                                                   BLKR=round(mean(BLKR,na.rm=T),1),
                                                   RF=round(mean(RF,na.rm=T),1),
                                                   MIN=round(mean(MIN,na.rm=T),1),
                                                   PIR=round(mean(PIR,na.rm=T),1),
                                                   PPS = round(PTS/ (F3A +F2A+FTA),2),
                                                   POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
                                                   OFFRA=round(100*PTS/POS,1),
                                                   ASR=round(100*AS/POS,1),
                                                   ATOR=round(AS/TO,1),
                                                   EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1),
                                                   FTR =  round(FTA / (F3A +F2A),2),
                                                   GS = round(PTS + (0.4 * (F3M +F2M)) - (0.7 * (F3A +F2A)) - (0.4 * (FTA - FTM)) + (0.7 * OR) + (0.3 * DR) + ST + (0.7 * AS) + (0.7 * BLK) - (0.4 * PF) - TO,1),
                                                   TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1),
                                                   TOR = round((TO * 100) / POS,2),
                                                   USG = round(100 * (((F3A +F2A) + 0.44 *FTA + TO) * ( 40 )) / (MIN * (mean(Team_F2A,na.rm=T)+mean(Team_F3A,na.rm=T) + 0.44 * mean(Team_FTA,na.rm=T) + mean(Team_TO,na.rm=T))),1),
                                                   OR_percent = round(100*OR / (mean(Team_OR,na.rm=T) + mean(Team_opp_OR,na.rm=T)),1))
return(data)
}


```

# Basic Stats {data-navmenu="Player Stats"}

## Column {data-width="10"}

```{r}
season_basic_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_basic_stats",label="Select Season",choices = season_basic_stats,selected = "2023-2024")

phase_basic_stats=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_basic_stats",label="Phase",choices=phase_basic_stats)
results_basic_stats=rev(c("W","L",""))
selectInput("results_basic_stats",label="Result",choices=results_basic_stats)

home_away_basic_stats=rev(c("H","A",""))
selectInput("home_away_basic_stats",label="Η/Α",choices=home_away_basic_stats)

numericInput("Games_basic_stats","Games",min=0,max=300,value=10)

```


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,MIN,"MIN",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_MIN))%>%head(5)%>%dplyr::select(Name,Average_MIN))

```
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(G))%>%head(5)%>%dplyr::select(Name,G))

```


## Column {data-width="10"}


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_PTS))%>%head(5)%>%dplyr::select(Name,Average_PTS))

```



###
```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Average_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,DR,"DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,ST,"ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Average_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PF,"PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,BLK,"BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_BLK),all=TRUE)%>%
  mutate(Game_score=Average_PTS+0.4*Average_F2M+0.4*Average_F3M-0.7*Average_F2A-0.7*Average_F3A+0.4*Average_FTM-0.4*Average_FTA+0.7*Average_OR+0.3*Average_DR+Average_ST+0.7*Average_AS+0.7*Average_BLK-0.4*Average_PF-Average_TO)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  dplyr::select(Name,Game_score)%>%arrange(desc(Game_score))%>%
  head(5))
```
###

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_AS),all=TRUE)%>%
  mutate(POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA),AP=round(POS/G,2),offrat=round((Average_PTS*100)/AP,2))%>%
  dplyr::select(Name,Average_PTS,AP,offrat)%>%dplyr::filter(AP>10)%>%arrange(desc(AP))%>%head(5)%>%dplyr::rename("Average_Points"=Average_PTS,"Average_Possesions"=AP,"Offensive_Rating"=offrat)%>%dplyr::select(Name,Average_Possesions))
```

###

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_AS),all=TRUE)%>%
  mutate(POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA),AP=round(POS/G,2),offrat=round((Average_PTS*100)/AP,2))%>%
  dplyr::select(Name,Average_PTS,AP,offrat)%>%dplyr::filter(AP>10)%>%arrange(desc(offrat))%>%head(5)%>%dplyr::rename("Average_Points"=Average_PTS,"Average_Possesions"=AP,"Offensive_Rating"=offrat)%>%dplyr::select(Name,Offensive_Rating))
```


## Column {data-width="10"}


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,DR,"DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_DR))%>%head(5)%>%dplyr::select(Name,Average_DR))

```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_OR))%>%head(5)%>%dplyr::select(Name,Average_OR))

```

### 

```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Average_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,DR,"DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,ST,"ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Average_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PF,"PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,BLK,"BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PTS,"Team_PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F2A,"Team_F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F2A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F3A,"Team_F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_FTA,"Team_FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F2M,"Team_F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F3M,"Team_F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_FTM,"Team_FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_AS,"Team_AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_OR,"Team_OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_DR,"Team_DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_TR,"Team_TR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_TR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_ST,"Team_ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_TO,"Team_TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_BLK,"Team_BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PF,"Team_PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PIR,"Team_PIR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_PIR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PTS,"Team_opp_PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F2A,"Team_opp_F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F2A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F3A,"Team_opp_F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_FTA,"Team_opp_FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F2M,"Team_opp_F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F3M,"Team_opp_F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_FTM,"Team_opp_FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_AS,"Team_opp_AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_OR,"Team_opp_OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_DR,"Team_opp_DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_TR,"Team_opp_TR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_TR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_ST,"Team_opp_ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_TO,"Team_opp_TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_BLK,"Team_opp_BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PF,"Team_opp_PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PIR,"Team_opp_PIR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_PIR),all=TRUE)%>%
    mutate(OR_Percent=round(100*Average_OR / (Average_Team_OR + Average_Team_opp_OR),1))%>%
  arrange(desc(OR_Percent))%>%dplyr::filter(G>=input$Games_basic_stats)%>%dplyr::select(Name,OR_Percent)%>%head(5))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,TR,"TR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_TR))%>%head(5)%>%dplyr::select(Name,Average_TR))

```

## Column {data-width="10"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_AS))%>%head(5)%>%dplyr::select(Name,Average_AS))
```

###


```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_AS,Average_AS),all=TRUE)%>%
  mutate(POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA),AP=round(POS/G,2),
         Assists_ratio=round((Average_AS)/AP,2))%>%dplyr::filter(G>=input$Games_basic_stats)%>%dplyr::select(Name,Assists_ratio)%>%arrange(desc(Assists_ratio))%>%head(5))
```


### 

```{r}
renderTable(merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats),
      compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats),all=TRUE)%>%
  mutate(As_To_Ratio=round(Average_AS/Average_TO,2))%>%dplyr::filter(As_To_Ratio!=Inf & G>=input$Games_basic_stats)%>%
  arrange(desc(As_To_Ratio))%>%dplyr::select(Name,As_To_Ratio)%>%head(5))
```



### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,ST,"ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_ST))%>%head(5)%>%dplyr::select(Name,Average_ST))
```

## Column {data-width="10"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,BLK,"BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_BLK))%>%head(5)%>%dplyr::select(Name,Average_BLK))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,BLKR,"BLKR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_BLKR))%>%head(5)%>%dplyr::select(Name,Average_BLKR))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PF,"PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_PF))%>%head(5)%>%dplyr::select(Name,Average_PF))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,RF,"RF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_RF))%>%head(5)%>%dplyr::select(Name,Average_RF))
```
## Column {data-width="10"}

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_TO))%>%head(5)%>%dplyr::select(Name,Average_TO))
```
### 

```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Total_AS,Average_AS),all=TRUE)%>%
  mutate(POS=0.96*(Total_F2A+Total_F3A-Total_OR+Total_TO+0.44*Total_FTA),AP=round(POS/G,2),
         Turnover_ratio=round((Total_TO)/POS,2))%>%dplyr::filter(G>=input$Games_basic_stats)%>%dplyr::select(Name,Turnover_ratio)%>%arrange(desc(Turnover_ratio))%>%
  head(5))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PIR,"PIR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::filter(G>=input$Games_basic_stats)%>%
  arrange(desc(Average_PIR))%>%head(5)%>%dplyr::select(Name,Average_PIR))
```


### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Average_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,DR,"DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,ST,"ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,G,Average_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PF,"PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,BLK,"BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PTS,"Team_PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F2A,"Team_F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F2A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F3A,"Team_F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_FTA,"Team_FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F2M,"Team_F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F3M,"Team_F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_FTM,"Team_FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_AS,"Team_AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_OR,"Team_OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_DR,"Team_DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_TR,"Team_TR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_TR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_ST,"Team_ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_TO,"Team_TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_BLK,"Team_BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PF,"Team_PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PIR,"Team_PIR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_PIR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PTS,"Team_opp_PTS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F2A,"Team_opp_F2A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F2A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F3A,"Team_opp_F3A",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_FTA,"Team_opp_FTA",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F2M,"Team_opp_F2M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F3M,"Team_opp_F3M",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_FTM,"Team_opp_FTM",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_AS,"Team_opp_AS",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_OR,"Team_opp_OR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_DR,"Team_opp_DR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_TR,"Team_opp_TR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_TR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_ST,"Team_opp_ST",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_TO,"Team_opp_TO",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_BLK,"Team_opp_BLK",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PF,"Team_opp_PF",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PIR,"Team_opp_PIR",input$home_away_basic_stats,input$results_basic_stats,input$phase_basic_stats,input$season_basic_stats)%>%dplyr::select(Name,Average_Team_opp_PIR),all=TRUE)%>%
    mutate(PIE=round((Average_PTS+Average_F2M+Average_F3M+Average_FTM-(Average_F2A+Average_F3A+Average_FTA)+Average_DR+0.5*Average_OR-Average_PF-Average_TO+0.5*Average_BLK+Average_ST+Average_AS)/((Average_Team_PTS+Average_Team_F2M+Average_Team_F3M+Average_Team_FTM-(Average_Team_F2A+Average_Team_F3A+Average_Team_FTA)+Average_Team_AS+Average_Team_DR+Average_Team_OR*0.5+Average_Team_ST+0.5*Average_Team_BLK-Average_Team_PF-Average_Team_TO)+(Average_Team_opp_PTS+Average_Team_opp_F2M+Average_Team_opp_F3M+Average_Team_opp_FTM-(Average_Team_opp_F2A+Average_Team_opp_F3A+Average_Team_opp_FTA)+Average_Team_opp_AS+Average_Team_opp_DR+Average_Team_opp_OR*0.5+Average_Team_opp_ST+0.5*Average_Team_opp_BLK-Average_Team_opp_PF-Average_Team_opp_TO)),2))%>%
    dplyr::filter(G>=input$Games_basic_stats)%>%
    dplyr::select(Name,PIE)%>%arrange(desc(PIE))%>%head(5))
```



# Shooting stats {data-navmenu="Player Stats"}


## Column {data-width="10"}

```{r}
season_shoot_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_shoot_stats",label="Select Season",choices = season_shoot_stats,selected = "2023-2024")

phase_shoot_stats=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_shoot_stats",label="Phase",choices=phase_shoot_stats)

results_shoot_stats=rev(c("W","L",""))
selectInput("results_shoot_stats",label="Result",choices=results_shoot_stats)

home_away_shoot_stats=rev(c("H","A",""))
selectInput("home_away_shoot_stats",label="Η/Α",choices=home_away_shoot_stats)

numericInput("Games_shoot_stats","Games",min=15,max=300,value=3)
numericInput("Total_shoot_stats","Total Shoots",min=0,max=2000,value=30)
```


### 
```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_PTS),all=TRUE)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,PPS=round(Total_PTS/sumfg,1))%>%dplyr::filter(sumfg>=input$Total_shoot_stats)%>%
  arrange(desc(PPS))%>%head(5)%>%dplyr::select(Name,PPS)%>%dplyr::rename("Points per shoot"=PPS),spacing="xs")
```

## Column {data-width="10"}

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Average_FTM))%>%head(5)%>%dplyr::select(Name,Average_FTM),spacing="xs")
```
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Average_FTA))%>%head(5)%>%dplyr::select(Name,Average_FTA),spacing="xs")
```
### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats),compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats))%>%
  mutate(PFT=100*round(Total_FTM/Total_FTA,3))%>%dplyr::filter(Total_FTA>=input$Total_shoot_stats)%>%
  arrange(desc(PFT))%>%head(5)%>%dplyr::select(Name,PFT),spacing="xs")
```

### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,
         Percent_attempt_3P=round(Total_F3A/sumfg,3)*100,
         Percent_attempt_2P=round(Total_F2A/sumfg,3)*100,
         Percent_attempt_FT=round(Total_FTA/sumfg,3)*100)%>%dplyr::filter(sumfg>=input$Total_shoot_stats)%>%
  arrange(desc(Percent_attempt_FT))%>%head(5)%>%dplyr::select(Name,Percent_attempt_FT),spacing="xs")
```
## Column {data-width="10"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Average_F2M))%>%head(5)%>%dplyr::select(Name,Average_F2M),spacing="xs")
```


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Average_F2A))%>%head(5)%>%dplyr::select(Name,Average_F2A),spacing="xs")
```

### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats),compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats))%>%
  mutate(P2=100*round(Total_F2M/Total_F2A,3))%>%dplyr::filter(Total_F2A>=input$Total_shoot_stats)%>%
  arrange(desc(P2))%>%head(5)%>%dplyr::select(Name,P2),spacing="xs")
```
### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,
         Percent_attempt_3P=round(Total_F3A/sumfg,3)*100,
         Percent_attempt_2P=round(Total_F2A/sumfg,3)*100,
         Percent_attempt_FT=round(Total_FTA/sumfg,3)*100)%>%dplyr::filter(sumfg>=input$Total_shoot_stats)%>%
  arrange(desc(Percent_attempt_2P))%>%head(5)%>%dplyr::select(Name,Percent_attempt_2P),spacing="xs")
```
## Column {data-width="10"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Average_F3M))%>%head(5)%>%dplyr::select(Name,Average_F3M),spacing="xs")
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Average_F3A))%>%head(5)%>%dplyr::select(Name,Average_F3A),spacing="xs")
```


### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats),compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats))%>%
  mutate(P3=100*round(Total_F3M/Total_F3A,3))%>%dplyr::filter(Total_F3A>=input$Total_shoot_stats)%>%
  arrange(desc(P3))%>%head(5)%>%dplyr::select(Name,P3),spacing="xs")
```

### 

```{r eval=TRUE}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  mutate(sumfg=Total_F2A+Total_F3A+Total_FTA,
         Percent_attempt_3P=round(Total_F3A/sumfg,3)*100,
         Percent_attempt_2P=round(Total_F2A/sumfg,3)*100,
         Percent_attempt_FT=round(Total_FTA/sumfg,3)*100)%>%dplyr::filter(sumfg>=input$Total_shoot_stats)%>%
  arrange(desc(Percent_attempt_3P))%>%head(5)%>%dplyr::select(Name,Percent_attempt_3P),spacing="xs")
```

## Column {data-width="10"}
### 

```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  mutate(FT_ratio=round(Total_FTA/(Total_F3A+Total_F2A),2),shots=Total_F2A+Total_F3A+Total_FTA)%>%
    dplyr::filter(shots>=input$Total_shoot_stats)%>%
  arrange(desc(FT_ratio))%>%dplyr::select(Name,FT_ratio)%>%head(5),spacing="xs")
```



### 

```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,G,Average_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,DR,"DR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,ST,"ST",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,G,Average_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PF,"PF",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,BLK,"BLK",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PTS,"Team_PTS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F2A,"Team_F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_F2A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F3A,"Team_F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_FTA,"Team_FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F2M,"Team_F2M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_F3M,"Team_F3M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_FTM,"Team_FTM",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_AS,"Team_AS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_OR,"Team_OR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_DR,"Team_DR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_TR,"Team_TR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_TR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_ST,"Team_ST",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_TO,"Team_TO",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_BLK,"Team_BLK",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PF,"Team_PF",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_PIR,"Team_PIR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_PIR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PTS,"Team_opp_PTS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F2A,"Team_opp_F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_F2A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F3A,"Team_opp_F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_FTA,"Team_opp_FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F2M,"Team_opp_F2M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_F2M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_F3M,"Team_opp_F3M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_FTM,"Team_opp_FTM",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_FTM),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_AS,"Team_opp_AS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_AS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_OR,"Team_opp_OR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_DR,"Team_opp_DR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_DR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_TR,"Team_opp_TR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_TR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_ST,"Team_opp_ST",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_ST),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_TO,"Team_opp_TO",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_BLK,"Team_opp_BLK",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_BLK),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PF,"Team_opp_PF",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_PF),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,Team_opp_PIR,"Team_opp_PIR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_Team_opp_PIR),all=TRUE)%>%
    merge(compute_stats(All_Seasons,Player,MIN,"MIN",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Average_MIN),all=TRUE)%>%
    mutate(Usage = round(100 * (((Average_F3A +Average_F2A) + 0.44 *Average_FTA + Average_TO) * ( 40 )) / (Average_MIN * (Average_Team_F2A+Average_Team_F3A + 0.44 * Average_Team_FTA + Average_Team_TO)),1))%>%
    dplyr::filter(G>=input$Games_shoot_stats)%>%
  arrange(desc(Usage))%>%dplyr::select(Name,Usage)%>%head(5),spacing="xs")
```


###


```{r}
renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3M),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F2M),all=TRUE)%>%
  mutate(EFG=100*round((Total_F2M+1.5*Total_F3M)/(Total_F2A+Total_F3A),3),shots=Total_F2A+Total_F3A)%>%arrange(desc(EFG))%>%
  dplyr::filter(G>=input$Games_shoot_stats&shots>=input$Total_shoot_stats)%>%head(5)%>%dplyr::select(Name,EFG),spacing="xs")
```

### 

```{r}

renderTable(merge(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,G,Total_F2A),
      compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_F3A),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_FTA),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_OR),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_TO),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_PTS),all=TRUE)%>%
  merge(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_shoot_stats,input$results_shoot_stats,input$phase_shoot_stats,input$season_shoot_stats)%>%dplyr::select(Name,Total_AS,Average_AS),all=TRUE)%>%
  mutate(True_Shooting=100*round((Total_PTS)/(2*(Total_F2A+Total_F3A+0.44*Total_FTA)),3),shots=Total_F2A+Total_F3A)%>%
    dplyr::filter(G>=input$Games_shoot_stats&shots>=input$Total_shoot_stats)%>%dplyr::select(Name,True_Shooting)%>%arrange(desc(True_Shooting),spacing="xs")%>%
  head(5))
```


# Basic Stats(Total) {data-navmenu="Player Stats"}

## Column {data-width="10"}

```{r}
season_basic_stats_total=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_basic_stats_total",label="Select Season",choices = season_basic_stats_total,selected = "2023-2024")

phase_basic_stats_total=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_basic_stats_total",label="Phase",choices=phase_basic_stats_total)
results_basic_stats_total=rev(c("W","L",""))
selectInput("results_basic_stats_total",label="Result",choices=results_basic_stats_total)

home_away_basic_stats_total=rev(c("H","A",""))
selectInput("home_away_basic_stats_total",label="Η/Α",choices=home_away_basic_stats_total)

```




## Column {data-width="20"}



### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PTS,"PTS",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_PTS))%>%head(5)%>%dplyr::select(Name,Total_PTS))

```


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,DR,"DR",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_DR))%>%head(5)%>%dplyr::select(Name,Total_DR))

```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,OR,"OR",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_OR))%>%head(5)%>%dplyr::select(Name,Total_OR))

```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,TR,"TR",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_TR))%>%head(5)%>%dplyr::select(Name,Total_TR))

```
## Column {data-width="20"}


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,AS,"AS",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_AS))%>%head(5)%>%dplyr::select(Name,Total_AS))
```
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,ST,"ST",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_ST))%>%head(5)%>%dplyr::select(Name,Total_ST))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,TO,"TO",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_TO))%>%head(5)%>%dplyr::select(Name,Total_TO))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,MIN,"MIN",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_MIN))%>%head(5)%>%dplyr::select(Name,Total_MIN))

```
## Column {data-width="20"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,BLK,"BLK",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_BLK))%>%head(5)%>%dplyr::select(Name,Total_BLK))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,BLKR,"BLKR",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_BLKR))%>%head(5)%>%dplyr::select(Name,Total_BLKR))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PF,"PF",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_PF))%>%head(5)%>%dplyr::select(Name,Total_PF))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,RF,"RF",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_RF))%>%head(5)%>%dplyr::select(Name,Total_RF))
```

## Column {data-width="20"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F2M,"F2M",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F2M))%>%head(5)%>%dplyr::select(Name,Total_F2M))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F2A,"F2A",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F2A))%>%head(5)%>%dplyr::select(Name,Total_F2A))
```


### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F3M,"F3M",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F3M))%>%head(5)%>%dplyr::select(Name,Total_F3M))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,F3A,"F3A",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_F3A))%>%head(5)%>%dplyr::select(Name,Total_F3A))
```


## Column {data-width="20"}
### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,FTM,"FTM",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_FTM))%>%head(5)%>%dplyr::select(Name,Total_FTM))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,FTA,"FTA",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_FTA))%>%head(5)%>%dplyr::select(Name,Total_FTA))
```

### 

```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,PIR,"PIR",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_PIR))%>%head(5)%>%dplyr::select(Name,Total_PIR))
```

###
```{r eval=TRUE}
renderTable(compute_stats(All_Seasons,Player,Possesions,"POS",input$home_away_basic_stats_total,input$results_basic_stats_total,input$phase_basic_stats_total,input$season_basic_stats_total)%>%
  arrange(desc(Total_POS))%>%head(5)%>%dplyr::select(Name,Total_POS))
```

# Record stats {data-navmenu="Player Stats"}

## Column {data-width=20}
### {data-height=150}
```{r}
season_best_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_best_stats",label="Select Season",choices = season_best_stats)

```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,PTS,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,MIN,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,AS,input$season_best_stats)),spacing ="xs")
```

## Column {data-width=20}

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,F2M,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,F2A,input$season_best_stats)),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,F3M,input$season_best_stats)),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,F3A,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,FTM,input$season_best_stats)),spacing ="xs")
```
## Column {data-width=20}
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,FTA,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,OR,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,DR,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,TR,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,OR_percent,input$season_best_stats)),spacing ="xs")
```

## Column {data-width=20}
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,ST,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,TO,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,BLK,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,BLKR,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,RF,input$season_best_stats)),spacing ="xs")
```


## Column {data-width=20}
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,Game_score,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,PIR,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,Usage,input$season_best_stats)),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats(All_Seasons,PIE,input$season_best_stats)),spacing ="xs")
```

# Search Player {data-navmenu="Player Stats"}
## Column {data-width="5"}
```{r}
season_search_player=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_search_player",label="Select Season",choices = season_search_player)

phase_search_player=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_search_player",label="Phase",choices=phase_search_player)

results_search_player=rev(c("W","L",""))
selectInput("results_search_player",label="Result",choices=results_search_player)

home_away_search_player=rev(c("H","A",""))
selectInput("home_away_search_player",label="Η/Α",choices=home_away_search_player)

players_search_player=rev(unique(All_Seasons%>%dplyr::select(Player)))
selectInput("players_search_player",label="Select Player",choices = players_search_player)

```

###

```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[6]),spacing = "xs")
```
## Column {data-width="10"}
###

```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[1]))
```
### 
```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[2]))
```

## Column {data-width="10"}

###

```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[3]))
```

###

```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players_search_player,input$home_away_search_player,input$results_search_player,input$phase_search_player,input$season_search_player)[4]))
```


# Compare Players {data-navmenu="Player Stats"}
## Column {data-width=30}
### First Player{data-height=400}
```{r}
players1_compare_players=rev(unique(All_Seasons%>%dplyr::select(Player)))
selectInput("players1_compare_players",label="Select Player",choices = players1_compare_players)

season1_compare_players=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season1_compare_players",label="Select Season",choices = season1_compare_players)

phase1_compare_players=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase1_compare_players",label="Phase",choices=phase1_compare_players)

results1_compare_players=rev(c("W","L",""))
selectInput("results1_compare_players",label="Result",choices=results1_compare_players)

home_away1_compare_players=rev(c("H","A",""))
selectInput("home_away1_compare_players",label="Η/Α",choices=home_away1_compare_players)

```
### {data-height=100}
```{r}
renderTable(data.frame(Player1=c(paste0(input$players1_compare_players," ",input$home_away1_compare_players," ",input$results1_compare_players,"(",input$season1_compare_players," ",input$phase1_compare_players,")"))))
```

### {data-height=300}
```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[1])%>%
                    dplyr::select(Team,Games,Minutes),spacing="xs")
```


## Column {data-width=30}


### Second Player {data-height=400}
```{r}
players2_compare_players=rev(unique(All_Seasons%>%dplyr::select(Player)))
selectInput("players2_compare_players",label="Select Player",choices = players2_compare_players)

season2_compare_players=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season2_compare_players",label="Select Season",choices = season2_compare_players)

phase2_compare_players=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase2_compare_players",label="Phase",choices=phase2_compare_players)

results2_compare_players=rev(c("W","L",""))
selectInput("results2_compare_players",label="Result",choices=results2_compare_players)

home_away2_compare_players=rev(c("H","A",""))
selectInput("home_away2_compare_players",label="Η/Α",choices=home_away2_compare_players)
```

### {data-height=100}
```{r}
renderTable(data.frame(Player2=c(paste0(input$players2_compare_players," ",input$home_away2_compare_players," ",input$results2_compare_players,"(",input$season2_compare_players," ",input$phase2_compare_players,")"))))
```
### {data-height=300}
```{r}
renderTable(data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[1])%>%
              dplyr::select(Team,Games,Minutes),spacing="xs")
```


## Column {data-width=40}
### {data-height=250}
```{r}
renderTable(merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[6])%>%
        setnames(old=c("Rating"),new=c("Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[6])%>%
        setnames(old=c("Rating"),new=c("Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Rating1==Rating2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"))%>%
    setnames(old=c("Rating1","Rating2"),new=c("Player1","Player2")),spacing="xs")


```
### {data-height=450}
```{r}
renderTable(merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[2])%>%
        setnames(old=c("Average","Rating"),new=c("Average1","Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[2])%>%
        setnames(old=c("Average","Rating"),new=c("Average2","Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Average1==Average2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"),
         id=c(10,5,4,8,2,1,9,11,6,7,3))%>%arrange(desc(id))%>%
  dplyr::select(-Rating1,-Rating2,-id)%>%
    setnames(old=c("Average1","Average2"),new=c("Player1","Player2")),spacing="xs")
```

### {data-height=300}
```{r}
renderTable(rbind(merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[6])%>%
        setnames(old=c("Rating"),new=c("Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[6])%>%
        setnames(old=c("Rating"),new=c("Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Rating1==Rating2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"))%>%
    setnames(old=c("Rating1","Rating2"),new=c("Player1","Player2"))%>%select(Better),
  merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[3])%>%
        setnames(old=c("Average","Rating"),new=c("Average1","Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[3])%>%
        setnames(old=c("Average","Rating"),new=c("Average2","Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Average1==Average2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"),
                          id=c(10,7,1,11,12,8,9,3,5,6,4,2))%>%arrange(desc(id))%>%
  dplyr::select(-Rating1,-Rating2,-id)%>%
    setnames(old=c("Average1","Average2"),new=c("Player1","Player2"))%>%select(Better),
  merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[4])%>%
        setnames(old=c("Average","Rating"),new=c("Average1","Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[4])%>%
        setnames(old=c("Average","Rating"),new=c("Average2","Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Average1==Average2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"),
                          id=c(10,9,5,7,1,5,6,8,2,3))%>%arrange(desc(id))%>%
  dplyr::select(-Rating1,-Rating2,-id)%>%
    setnames(old=c("Average1","Average2"),new=c("Player1","Player2"))%>%select(Better))%>%
    group_by(Better)%>%
    summarise(Wins=n())%>%
    na.omit(),spacing="xs")


```


## Column {data-width=40}
###
```{r}
renderTable(merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[3])%>%
        setnames(old=c("Average","Rating"),new=c("Average1","Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[3])%>%
        setnames(old=c("Average","Rating"),new=c("Average2","Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Average1==Average2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"),
                          id=c(10,7,1,11,12,8,9,3,5,6,4,2))%>%arrange(desc(id))%>%
  dplyr::select(-Rating1,-Rating2,-id)%>%
    setnames(old=c("Average1","Average2"),new=c("Player1","Player2")),spacing="xs")
```

###
```{r}
renderTable(merge(data.frame(player_stats(All_Seasons,input$players1_compare_players,input$home_away1_compare_players,input$results1_compare_players,input$phase1_compare_players,input$season1_compare_players)[4])%>%
        setnames(old=c("Average","Rating"),new=c("Average1","Rating1")),
      data.frame(player_stats(All_Seasons,input$players2_compare_players,input$home_away2_compare_players,input$results2_compare_players,input$phase2_compare_players,input$season2_compare_players)[4])%>%
        setnames(old=c("Average","Rating"),new=c("Average2","Rating2")),all=TRUE)%>%
  mutate(Better=case_when(Average1==Average2 ~"Identical",
                          Rating1>Rating2~"Player1",
                          Rating1<Rating2~"Player2"),
                          id=c(10,9,5,7,1,5,6,8,2,3))%>%arrange(desc(id))%>%
  dplyr::select(-Rating1,-Rating2,-id)%>%
    setnames(old=c("Average1","Average2"),new=c("Player1","Player2")),spacing="xs")
```

# Player stats by team {data-navmenu="Player Stats"}

## Column {data-width="5"}
```{r}
players_by_team=rev(unique(All_Seasons$Team))
selectInput("players_by_team",label="Select Team",choices = players_by_team)

phase_by_team=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_by_team",label="Phase",choices=phase_by_team)

results_by_team=rev(c("W","L",""))
selectInput("results_by_team",label="Result",choices=results_by_team)

home_away_by_team=rev(c("H","A",""))
selectInput("home_away_by_team",label="Η/Α",choices=home_away_by_team)

season_by_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_by_team",label="Select Season",choices = season_by_team,selected = "2023-2024")
```

## Column {data-width="25"}

### {data-height="400"}

```{r}
renderDataTable(teamplayersstats(All_Seasons,input$home_away_by_team,input$results_by_team,input$phase_by_team,input$season_by_team,input$players_by_team), options = list(scrollX = TRUE, sScrollY = '75vh', scrollCollapse = TRUE,searching = FALSE,autoWidth = FALSE,paging=FALSE,dom='tip',lengthChange = FALSE,info=FALSE))
```


# Player stats against each team {data-navmenu="Player Stats"}

## Column {data-width="5"}

```{r}
players_against_each_team=rev(unique(All_Seasons$Player))
selectInput("players_against_each_team",label="Select Player",choices = players_against_each_team)

phase_against_each_team=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_against_each_team",label="Phase",choices=phase_against_each_team)

results_against_each_team=rev(c("W","L",""))
selectInput("results_against_each_team",label="Result",choices=results_against_each_team)

home_away_against_each_team=rev(c("H","A",""))
selectInput("home_away_against_each_team",label="Η/Α",choices=home_away_against_each_team)

season_against_each_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_against_each_team",label="Select Season",choices = season_against_each_team)
```

## Column {data-width="50"}

###

```{r}
renderTable(player_stats_by_team_against(All_Seasons,input$players_against_each_team,input$home_away_against_each_team,input$results_against_each_team,input$phase_against_each_team,input$season_against_each_team),rownames = T)
```

# Player stats against a team {data-navmenu="Player Stats"}

## Column {data-width="5"}

```{r}
team_stats_against_a_team=rev(unique(All_Seasons$Team))
selectInput("team_stats_against_a_team",label="Select Team",choices = team_stats_against_a_team)

phase_stats_against_a_team=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_stats_against_a_team",label="Phase",choices=phase_stats_against_a_team)

results_stats_against_a_team=rev(c("W","L",""))
selectInput("results_stats_against_a_team",label="Result",choices=results_stats_against_a_team)

home_away_stats_against_a_team=rev(c("H","A",""))
selectInput("home_away_stats_against_a_team",label="Η/Α",choices=home_away_stats_against_a_team)

season_stats_against_a_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_stats_against_a_team",label="Select Season",choices = season_stats_against_a_team)
```

## Column {data-width="50"}

###

```{r}
renderDataTable(players_stats_by_a_against_team(All_Seasons,input$team_stats_against_a_team,input$home_away_stats_against_a_team,input$results_stats_against_a_team,input$phase_stats_against_a_team,input$season_stats_against_a_team),
                 options = list(scrollX = TRUE, sScrollY = '75vh', scrollCollapse = TRUE,autoWidth = FALSE,paging=FALSE,dom='tip',lengthChange = FALSE,info=FALSE))
```

# Player stats by a game {data-navmenu="Player Stats"}

## Column {data-width="20"}
```{r}

results_player_stats_by_a_game=rev(c("W","L",""))
selectInput("results_player_stats_by_a_game",label="Result",choices=results_player_stats_by_a_game)

phase_player_stats_by_a_game=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_player_stats_by_a_game",label="Phase",choices=phase_player_stats_by_a_game)

home_away_player_stats_by_a_game=rev(c("H","A",""))
selectInput("home_away_player_stats_by_a_game",label="Η/Α",choices=home_away_player_stats_by_a_game)

season_player_stats_by_a_game=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_player_stats_by_a_game",label="Select Season",choices = season_player_stats_by_a_game)

players_player_stats_by_a_game=rev(unique(All_Seasons$Player))
selectInput("players_player_stats_by_a_game",label="Select Player",choices = players_player_stats_by_a_game)

```
## Column {data-width="80"}

```{r}
renderDataTable(All_Seasons%>%dplyr::filter(grepl(input$season_player_stats_by_a_game,Season)&grepl(input$home_away_player_stats_by_a_game,HA)&grepl(input$results_player_stats_by_a_game,results)&grepl(input$phase_player_stats_by_a_game,Phase)&Player==input$players_player_stats_by_a_game)%>%
                  mutate(PRA=PTS+TR+AS,PR=PTS+TR,PA=PTS+AS,RA=TR+AS,PB=PTS+BLK,SB=ST+BLK)%>%
                  dplyr::select(Season,IDGAME,Phase,Team,Against,Player,MIN,PTS,F2M,F2A,F2GP,F3M,F3A,F3GP,FTM,FTA,FTP,OR,DR,TR,AS,ST,TO,BLK,BLKR,PRA,PA,PR,RA,PB,SB,PF,RF,PIR,HA,results,Points_per_shoot,Possesions,Offensive_rating,PIE,Assists_Ratio,As_To_ratio,EFG,FT_ratio,Game_score,True_shooting,Turnover_ratio,Usage,OR_percent))
```


# Find stats for a Game 

## {data-width=5}
```{r}

game=rev(unique(All_Seasons%>%dplyr::select(fix_teams)))
selectInput("game",label="Select Game",choices = game)

```


### {data-height=100}
```{r}
renderTable(data.frame(t(data.frame(findgamestats(All_Seasons,input$game)[2])%>%column_to_rownames("Team"))),spacing="xs",rownames = T)
```

## Column
### {data-height=400}
```{r}
renderDataTable(data.frame(findgamestats(All_Seasons,input$game)[1]), options = list(scrollX = TRUE, sScrollY = '75vh', scrollCollapse = TRUE,searching = FALSE,autoWidth = FALSE,paging=FALSE,dom='tip',lengthChange = FALSE,info=FALSE))
```



# Team Ranking {data-navmenu="Team Stats"}

## Column {data-width="8"}

```{r}

results_team_ranking=rev(c("W","L",""))
selectInput("results_team_ranking",label="Result",choices=results_team_ranking)

phase_team_ranking=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_ranking",label="Phase",choices=phase_team_ranking)

home_away_team_ranking=rev(c("H","A",""))
selectInput("home_away_team_ranking",label="Η/Α",choices=home_away_team_ranking)

season_team_ranking=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_ranking",label="Select Season",choices = season_team_ranking)
```

## Column {data-width="40"}
###

```{r}
renderDataTable(compute_stats_teams(All_Seasons,Team,PTS,"PTS",input$home_away_team_ranking,input$results_team_ranking,input$phase_team_ranking,input$season_team_ranking)%>%
        dplyr::select(Team,G,Team_Average_PTS,Team_Average_opp_PTS)%>%
  mutate(Diff=round(Team_Average_PTS-Team_Average_opp_PTS,2))%>%
  merge(All_Seasons%>%mutate(wl=ifelse(results=="W",1,0))%>%
          dplyr::filter(grepl(input$home_away_team_ranking,HA)&
                        grepl(input$phase_team_ranking,Phase)&
                        grepl(input$season_team_ranking,Season),all=TRUE)%>%
          group_by(Team,idseason)%>%
          dplyr::summarise(t=mean(wl))%>%
          group_by(Team)%>%
          dplyr::summarise(Wins=sum(t)),all=TRUE)%>%mutate(Loses=G-Wins,Win_Per=round(Wins/G,2)))
```

# Team Basic Stats {data-navmenu="Team Stats"}

## Column {data-width="8"}

```{r}
results_team_basic_stats=rev(c("W","L",""))
selectInput("results_team_basic_stats",label="Result",choices=results_team_basic_stats)

home_away_team_basic_stats=rev(c("H","A",""))
selectInput("home_away_team_basic_stats",label="Η/Α",choices=home_away_team_basic_stats)

phase_team_basic_stats=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_basic_stats",label="Phase",choices=phase_team_basic_stats)

season_team_basic_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_basic_stats",label="Select Season",choices = season_team_basic_stats,selected = "2023-2024")
```


## Column {data-width="40"}

###

```{r}
renderDataTable(merge(compute_stats_teams(All_Seasons,Team,AS,"AS",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_AS,Team_Average_opp_AS)%>%
                  dplyr::rename(AS=Team_Average_AS,opp_AS=Team_Average_opp_AS)%>%dplyr::select(Team,AS,opp_AS),
                  
     compute_stats_teams(All_Seasons,Team,DR,"DR",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_DR,Team_Average_opp_DR)%>%
  dplyr::rename(DR=Team_Average_DR,opp_DR=Team_Average_opp_DR)%>%dplyr::select(Team,DR,opp_DR))%>%

  merge(compute_stats_teams(All_Seasons,Team,OR,"OR",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_OR,Team_Average_opp_OR)%>%
  dplyr::rename(OR=Team_Average_OR,opp_OR=Team_Average_opp_OR)%>%dplyr::select(Team,OR,opp_OR))%>%
    
    merge(compute_stats_teams(All_Seasons,Team,TR,"TR",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_TR,Team_Average_opp_TR)%>%
  dplyr::rename(TR=Team_Average_TR,opp_TR=Team_Average_opp_TR)%>%dplyr::select(Team,TR,opp_TR))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,ST,"ST",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_ST,Team_Average_opp_ST)%>%
  dplyr::rename(ST=Team_Average_ST,opp_ST=Team_Average_opp_ST)%>%dplyr::select(Team,ST,opp_ST))%>%
    
     merge(compute_stats_teams(All_Seasons,Team,TO,"TO",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_TO,Team_Average_opp_TO)%>%
  dplyr::rename(TO=Team_Average_TO,opp_TO=Team_Average_opp_TO)%>%dplyr::select(Team,TO,opp_TO))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,BLK,"BLK",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_BLK,Team_Average_opp_BLK)%>%
  dplyr::rename(BLK=Team_Average_BLK,opp_BLK=Team_Average_opp_BLK)%>%dplyr::select(Team,BLK,opp_BLK))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,PF,"PF",input$home_away_team_basic_stats,input$results_team_basic_stats,input$phase_team_basic_stats,input$season_team_basic_stats)%>%dplyr::select(Team,Team_Average_PF,Team_Average_opp_PF)%>%
  dplyr::rename(PF=Team_Average_PF,opp_PF=Team_Average_opp_PF)%>%dplyr::select(Team,PF,opp_PF)),
  options =list(searching = FALSE,autoWidth = FALSE,paging=FALSE,dom='tip',lengthChange = FALSE,info=FALSE))

```

# Team Shooting Stats {data-navmenu="Team Stats"}


## Column {data-width="8"}

```{r}
results_team_shooting_stats=rev(c("W","L",""))
selectInput("results_team_shooting_stats",label="Result",choices=results_team_shooting_stats)

home_away_team_shooting_stats=rev(c("H","A",""))
selectInput("home_away_team_shooting_stats",label="Η/Α",choices=home_away_team_shooting_stats)

phase_team_shooting_stats=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_shooting_stats",label="Phase",choices=phase_team_shooting_stats)

season_team_shooting_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_shooting_stats",label="Select Season",choices = season_team_shooting_stats,selected = "2023-2024")
```


## Column {data-width="40"}

###

```{r}
renderDataTable(merge(compute_stats_teams(All_Seasons,Team,F2A,"F2A",input$home_away_team_shooting_stats,input$results_team_shooting_stats,input$phase_team_shooting_stats,input$season_team_shooting_stats)%>%dplyr::select(Team,Team_Average_F2A,Team_Average_opp_F2A)%>%
  dplyr::rename(F2A=Team_Average_F2A,opp_F2A=Team_Average_opp_F2A)%>%dplyr::select(Team,F2A,opp_F2A),
  
compute_stats_teams(All_Seasons,Team,F3A,"F3A",input$home_away_team_shooting_stats,input$results_team_shooting_stats,input$phase_team_shooting_stats,input$season_team_shooting_stats)%>%dplyr::select(Team,Team_Average_F3A,Team_Average_opp_F3A)%>%
  dplyr::rename(F3A=Team_Average_F3A,opp_F3A=Team_Average_opp_F3A)%>%dplyr::select(Team,F3A,opp_F3A))%>%
  
  merge(compute_stats_teams(All_Seasons,Team,FTA,"FTA",input$home_away_team_shooting_stats,input$results_team_shooting_stats,input$phase_team_shooting_stats,input$season_team_shooting_stats)%>%dplyr::select(Team,Team_Average_FTA,Team_Average_opp_FTA)%>%
  dplyr::rename(FTA=Team_Average_FTA,opp_FTA=Team_Average_opp_FTA)%>%dplyr::select(Team,FTA,opp_FTA))%>%
  
     merge(compute_stats_teams(All_Seasons,Team,F2M,"F2M",input$home_away_team_shooting_stats,input$results_team_shooting_stats,input$phase_team_shooting_stats,input$season_team_shooting_stats)%>%dplyr::select(Team,Team_Average_F2M,Team_Average_opp_F2M)%>%
  dplyr::rename(F2M=Team_Average_F2M,opp_F2M=Team_Average_opp_F2M)%>%dplyr::select(Team,F2M,opp_F2M))%>%
  
      merge(compute_stats_teams(All_Seasons,Team,F3M,"F3M",input$home_away_team_shooting_stats,input$results_team_shooting_stats,input$phase_team_shooting_stats,input$season_team_shooting_stats)%>%dplyr::select(Team,Team_Average_F3M,Team_Average_opp_F3M)%>%
  dplyr::rename(F3M=Team_Average_F3M,opp_F3M=Team_Average_opp_F3M)%>%dplyr::select(Team,F3M,opp_F3M))%>%
  
     merge(compute_stats_teams(All_Seasons,Team,FTM,"FTM",input$home_away_team_shooting_stats,input$results_team_shooting_stats,input$phase_team_shooting_stats,input$season_team_shooting_stats)%>%dplyr::select(Team,Team_Average_FTM,Team_Average_opp_FTM)%>%
  dplyr::rename(FTM=Team_Average_FTM,opp_FTM=Team_Average_opp_FTM)%>%dplyr::select(Team,FTM,opp_FTM))%>%
  
  mutate(P2=round(F2M/F2A,2),P3=round(F3M/F3A,2),PFT=round(FTM/FTA,2),
            opp_P2=round(opp_F2M/opp_F2A,2),opp_P3=round(opp_F3M/opp_F3A,2),opp_PFT=round(opp_FTM/opp_FTA,2))%>%
  dplyr::select(Team,F2M,F2A,P2,F3M,F3A,P3,FTM,FTA,PFT,opp_F2M,opp_F2A,opp_P2,opp_F3M,opp_F3A,opp_P3,opp_FTM,opp_FTA,opp_PFT),options =list(searching = FALSE,autoWidth = FALSE,paging=FALSE,dom='tip',lengthChange = FALSE,info=FALSE))

```


# Team Advanced Stats {data-navmenu="Team Stats"}


## Column {data-width="8"}

```{r}
results_team_advanced_stats=rev(c("W","L",""))
selectInput("results_team_advanced_stats",label="Result",choices=results_team_advanced_stats)

home_away_team_advanced_stats=rev(c("H","A",""))
selectInput("home_away_team_advanced_stats",label="Η/Α",choices=home_away_team_advanced_stats)

phase_team_advanced_stats=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_advanced_stats",label="Phase",choices=phase_team_advanced_stats)

season_team_advanced_stats=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_advanced_stats",label="Select Season",choices = season_team_advanced_stats,selected = "2023-2024")
```



## Column {data-width="40"}

###

```{r}
renderDataTable(merge(compute_stats_teams(All_Seasons,Team,AS,"AS",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_AS,Team_Average_opp_AS)%>%
                  dplyr::rename(AS=Team_Average_AS,opp_AS=Team_Average_opp_AS)%>%dplyr::select(Team,AS,opp_AS),
                  
     compute_stats_teams(All_Seasons,Team,DR,"DR",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_DR,Team_Average_opp_DR)%>%
  dplyr::rename(DR=Team_Average_DR,opp_DR=Team_Average_opp_DR)%>%dplyr::select(Team,DR,opp_DR))%>%

  merge(compute_stats_teams(All_Seasons,Team,OR,"OR",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_OR,Team_Average_opp_OR)%>%
  dplyr::rename(OR=Team_Average_OR,opp_OR=Team_Average_opp_OR)%>%dplyr::select(Team,OR,opp_OR))%>%
    
    merge(compute_stats_teams(All_Seasons,Team,TR,"TR",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_TR,Team_Average_opp_TR)%>%
  dplyr::rename(TR=Team_Average_TR,opp_TR=Team_Average_opp_TR)%>%dplyr::select(Team,TR,opp_TR))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,PTS,"PTS","","","","")%>%dplyr::select(Team,Team_Average_PTS,Team_Average_opp_PTS)%>%
          dplyr::rename(PTS=Team_Average_PTS,opp_PTS=Team_Average_opp_PTS)%>%dplyr::select(Team,PTS,opp_PTS))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,ST,"ST",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_ST,Team_Average_opp_ST)%>%
  dplyr::rename(ST=Team_Average_ST,opp_ST=Team_Average_opp_ST)%>%dplyr::select(Team,ST,opp_ST))%>%
    
     merge(compute_stats_teams(All_Seasons,Team,TO,"TO",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_TO,Team_Average_opp_TO)%>%
  dplyr::rename(TO=Team_Average_TO,opp_TO=Team_Average_opp_TO)%>%dplyr::select(Team,TO,opp_TO))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,BLK,"BLK",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_BLK,Team_Average_opp_BLK)%>%
  dplyr::rename(BLK=Team_Average_BLK,opp_BLK=Team_Average_opp_BLK)%>%dplyr::select(Team,BLK,opp_BLK))%>%
    
      merge(compute_stats_teams(All_Seasons,Team,PF,"PF",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_PF,Team_Average_opp_PF)%>%
  dplyr::rename(PF=Team_Average_PF,opp_PF=Team_Average_opp_PF)%>%dplyr::select(Team,PF,opp_PF))%>%
    merge(compute_stats_teams(All_Seasons,Team,F2A,"F2A",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_F2A,Team_Average_opp_F2A)%>%
  dplyr::rename(F2A=Team_Average_F2A,opp_F2A=Team_Average_opp_F2A)%>%dplyr::select(Team,F2A,opp_F2A))%>%
  
merge(compute_stats_teams(All_Seasons,Team,F3A,"F3A",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_F3A,Team_Average_opp_F3A)%>%
  dplyr::rename(F3A=Team_Average_F3A,opp_F3A=Team_Average_opp_F3A)%>%dplyr::select(Team,F3A,opp_F3A))%>%
  
  merge(compute_stats_teams(All_Seasons,Team,FTA,"FTA",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_FTA,Team_Average_opp_FTA)%>%
  dplyr::rename(FTA=Team_Average_FTA,opp_FTA=Team_Average_opp_FTA)%>%dplyr::select(Team,FTA,opp_FTA))%>%
  
     merge(compute_stats_teams(All_Seasons,Team,F2M,"F2M",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_F2M,Team_Average_opp_F2M)%>%
  dplyr::rename(F2M=Team_Average_F2M,opp_F2M=Team_Average_opp_F2M)%>%dplyr::select(Team,F2M,opp_F2M))%>%
  
      merge(compute_stats_teams(All_Seasons,Team,F3M,"F3M",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_F3M,Team_Average_opp_F3M)%>%
  dplyr::rename(F3M=Team_Average_F3M,opp_F3M=Team_Average_opp_F3M)%>%dplyr::select(Team,F3M,opp_F3M))%>%
  
     merge(compute_stats_teams(All_Seasons,Team,FTM,"FTM",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_FTM,Team_Average_opp_FTM)%>%
  dplyr::rename(FTM=Team_Average_FTM,opp_FTM=Team_Average_opp_FTM)%>%dplyr::select(Team,FTM,opp_FTM))%>%
  merge(compute_stats_teams(All_Seasons,Team,PIR,"PIR",input$home_away_team_advanced_stats,input$results_team_advanced_stats,input$phase_team_advanced_stats,input$season_team_advanced_stats)%>%dplyr::select(Team,Team_Average_PIR,Team_Average_opp_PIR)%>%
  dplyr::rename(PIR=Team_Average_PIR,opp_PIR=Team_Average_opp_PIR)%>%dplyr::select(Team,PIR,opp_PIR))%>%
  mutate(ASFG=round(AS/(F3M+F2M),2),
         PPS=round(PTS/ (F3A +F2A+FTA),2),
         ASTOR=round(AS/TO,2),
         EFG=round((F2M+1.5*F3M)/(F2A+F3A),2),
         FTR=round(FTA/(F2A+F3A),2),
         POS=round(0.96*(F2A+F3A-OR+TO+0.44*FTA),1),
         OPP_POS=round(0.96*(opp_F2A+opp_F3A-opp_OR+opp_TO+0.44*opp_FTA),1),
         ASR=round(AS/POS,2),
         OFF_RAT=round((PTS*100)/POS,1),
         DEF_RAT=round((opp_PTS*100)/OPP_POS,1),
         NET_RAT=round(OFF_RAT-DEF_RAT,2),
         TOR=round(TO/POS,2),
         TS=round(PTS/(2*(F2A+F3A+0.44*FTA)),2),
         opp_ASFG=round(opp_AS/(opp_F3M+opp_F2M),2),
         opp_PPS=round(opp_PTS/ (opp_F3A +opp_F2A+opp_FTA),2),
         opp_ASTOR=round(opp_AS/opp_TO,2),
         opp_EFG=round((opp_F2M+1.5*opp_F3M)/(opp_F2A+opp_F3A),2),
         opp_FTR=round(opp_FTA/(opp_F2A+opp_F3A),2),
         opp_ASR=round(opp_AS/OPP_POS,2),
         opp_TOR=round(opp_TO/OPP_POS,2),
         opp_TS=round(opp_PTS/(2*(opp_F2A+opp_F3A+0.44*opp_FTA)),2))%>%
  dplyr::select(Team,PPS,opp_PPS,ASFG,opp_ASFG,ASR,opp_ASR,ASTOR,opp_ASTOR,EFG,opp_EFG,TS,opp_TS,FTR,opp_FTR,POS,OPP_POS,OFF_RAT,DEF_RAT,NET_RAT,TOR,opp_TOR,PIR,opp_PIR),options = list(scrollX = TRUE, sScrollY = '75vh', scrollCollapse = TRUE,searching = FALSE,autoWidth = FALSE,paging=FALSE,dom='tip',lengthChange = FALSE,info=FALSE))
```


# Team stats by a game {data-navmenu="Team Stats"}

## Column {data-width="8"}
```{r}

results_team_stats_by_a_game=rev(c("W","L",""))
selectInput("results_team_stats_by_a_game",label="Result",choices=results_team_stats_by_a_game)

phase_team_stats_by_a_game=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_stats_by_a_game",label="Phase",choices=phase_team_stats_by_a_game)

home_away_team_stats_by_a_game=rev(c("H","A",""))
selectInput("home_away_team_stats_by_a_game",label="Η/Α",choices=home_away_team_stats_by_a_game)

season_team_stats_by_a_game=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_stats_by_a_game",label="Select Season",choices = season_team_stats_by_a_game,selected = "2023-2024")

teams_team_stats_by_a_game=rev(unique(All_Seasons$Team))
selectInput("teams_team_stats_by_a_game",label="Select Player",choices = teams_team_stats_by_a_game)

```
## Column {data-width="8"}

```{r}
renderDataTable(team_stats_by_a_game(All_Seasons,All_Seasons_res,input$teams_team_stats_by_a_game,input$home_away_team_stats_by_a_game,input$phase_team_stats_by_a_game,input$results_team_stats_by_a_game,input$season_team_stats_by_a_game))
```


# Team stats by a game fewer columns {data-navmenu="Team Stats"}

## Column {data-width="20"}
```{r}

results_team_stats_by_a_game_fewer=rev(c("W","L",""))
selectInput("results_team_stats_by_a_game_fewer",label="Result",choices=results_team_stats_by_a_game_fewer)

phase_team_stats_by_a_game_fewer=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_stats_by_a_game_fewer",label="Phase",choices=phase_team_stats_by_a_game_fewer)

home_away_team_stats_by_a_game_fewer=rev(c("H","A",""))
selectInput("home_away_team_stats_by_a_game_fewer",label="Η/Α",choices=home_away_team_stats_by_a_game_fewer)

season_team_stats_by_a_game_fewer=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_stats_by_a_game_fewer",label="Select Season",choices = season_team_stats_by_a_game_fewer,selected = "2023-2024")

teams_team_stats_by_a_game_fewer=rev(unique(All_Seasons$Team))
selectInput("teams_team_stats_by_a_game_fewer",label="Select Team",choices = teams_team_stats_by_a_game_fewer)

stat_team_stats_by_a_game_fewer=rev(c("PTS","AS","F2","F3","FT","OR","DR","TR","TO","ST","BLK"))
selectInput("stat_team_stats_by_a_game_fewer",label="Stat",choices = stat_team_stats_by_a_game_fewer)
```
## Column {data-width="80"}

```{r}
renderDataTable(team_stats_by_a_game(All_Seasons,All_Seasons_res,input$teams_team_stats_by_a_game_fewer,input$home_away_team_stats_by_a_game_fewer,input$phase_team_stats_by_a_game_fewer,input$results_team_stats_by_a_game_fewer,input$season_team_stats_by_a_game_fewer)%>%
                  select(Season,Fixture,Phase,Result,HA,Against,tidyr::contains(input$stat_team_stats_by_a_game_fewer)))
```


# Head to Head {data-navmenu="Team Stats"}

## Column {data-width="200"}
```{r}
compare_Team1=rev(unique(All_Seasons$Team))
selectInput("compare_Team1",label="Select Team",choices = compare_Team1,selected = "PAN")
compare_Team2=rev(unique(All_Seasons$Team))
selectInput("compare_Team2",label="Select Team",choices = compare_Team2,selected = "OLY")

season_team_compare=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_team_compare",label="Select Season",choices = season_team_compare)

phase_team_compare=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_team_compare",label="Phase",choices=phase_team_compare)
```
## Column {data-width="300"}
### Games on Euroleague
```{r}
renderTable(data.frame(Games_summary_between_teams(All_Seasons_res,input$compare_Team1,input$compare_Team2,input$season_team_compare)[1]),spacing="xs")
```
### Games on Regular Season & Playoffs
```{r}
renderTable(data.frame(Games_summary_between_teams(All_Seasons_res,input$compare_Team1,input$compare_Team2,input$season_team_compare)[2]),spacing="xs")
```

### Home Games on Regular Season & Playoffs
```{r}
renderTable(data.frame(Games_summary_between_teams(All_Seasons_res,input$compare_Team1,input$compare_Team2,input$season_team_compare)[3]),spacing="xs")
```
### Away Games on Regular Season & Playoffs
```{r}
renderTable(data.frame(Games_summary_between_teams(All_Seasons_res,input$compare_Team1,input$compare_Team2,input$season_team_compare)[4]),spacing="xs")
```
### Games on Euroleague Final Four
```{r}
renderTable(data.frame(Games_summary_between_teams(All_Seasons_res,input$compare_Team1,input$compare_Team2,input$season_team_compare)[5]),spacing="xs")
```


## Column {data-width="450"}
###  {data-height=250}

```{r}
renderTable(data.frame(head_to_head_teams(All_Seasons,input$compare_Team1,input$compare_Team2,input$season_team_compare,input$phase_team_compare)[4]),spacing="xs")
```

###

```{r}
renderTable(data.frame(head_to_head_teams(All_Seasons,input$compare_Team1,input$compare_Team2,input$season_team_compare,input$phase_team_compare)[1]),spacing="xs")
```

## Column {data-width="450"}
###  {data-height=250}

```{r}
renderTable(data.frame(head_to_head_teams(All_Seasons,input$compare_Team1,input$compare_Team2,input$season_team_compare,input$phase_team_compare)[5]),spacing="xs")
```

###

```{r}
renderTable(data.frame(head_to_head_teams(All_Seasons,input$compare_Team1,input$compare_Team2,input$season_team_compare,input$phase_team_compare)[2]),spacing="xs")
```

## Column {data-width="450"}
### {data-height=250}

```{r}
renderTable(data.frame(head_to_head_teams(All_Seasons,input$compare_Team1,input$compare_Team2,input$season_team_compare,input$phase_team_compare)[6]),spacing="xs")
```

###

```{r}
renderTable(data.frame(head_to_head_teams(All_Seasons,input$compare_Team1,input$compare_Team2,input$season_team_compare,input$phase_team_compare)[3]),spacing="xs")
```



# Compare Teams {data-navmenu="Team Stats"}

## Column {data-width=20}
### First Team{data-height=400}
```{r}
Team1_compare_team=rev(unique(All_Seasons%>%dplyr::select(Team)))
selectInput("Team1_compare_team",label="Select Player",choices = Team1_compare_team)

season1_compare_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season1_compare_team",label="Select Season",choices = season1_compare_team)

phase1_compare_team=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase1_compare_team",label="Phase",choices=phase1_compare_team)

results1_compare_team=rev(c("W","L",""))
selectInput("results1_compare_team",label="Result",choices=results1_compare_team)

home_away1_compare_team=rev(c("H","A",""))
selectInput("home_away1_compare_team",label="Η/Α",choices=home_away1_compare_team)

```

### {data-height=100}
```{r}
renderTable(data.frame(Team1=c(paste0(input$Team1_compare_team," ",input$home_away1_compare_team," ",input$results1_compare_team,"(",input$season1_compare_team," ",input$phase1_compare_team,")"))))
```

### {data-height=200}
```{r}
renderTable(period_points(All_Seasons_res,input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team),spacing = "xs")
```
## Column {data-width=20}


### Second Team {data-height=400}
```{r}
Team2_compare_team=rev(unique(All_Seasons%>%dplyr::select(Team)))
selectInput("Team2_compare_team",label="Select Player",choices = Team2_compare_team)

season2_compare_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season2_compare_team",label="Select Season",choices = season2_compare_team)

phase2_compare_team=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase2_compare_team",label="Phase",choices=phase2_compare_team)

results2_compare_team=rev(c("W","L",""))
selectInput("results2_compare_team",label="Result",choices=results2_compare_team)

home_away2_compare_team=rev(c("H","A",""))
selectInput("home_away2_compare_team",label="Η/Α",choices=home_away2_compare_team)

```

### {data-height=100}
```{r}
renderTable(data.frame(Team2=c(paste0(input$Team2_compare_team," ",input$home_away2_compare_team," ",input$results2_compare_team,"(",input$season2_compare_team," ",input$phase2_compare_team,")"))))
```

### {data-height=200}
```{r}
renderTable(period_points(All_Seasons_res,input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team),spacing = "xs")
```

## Column {data-width=30}
### {data-height=800}
```{r}
renderTable(merge(data.frame(compare_teams(input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[1]),
      data.frame(compare_teams(input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[1])%>%
        dplyr::rename(Team2=Team1),all=TRUE)%>%
  mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"|Stats=="Points conceed"|Stats=="Assists allowed"|Stats=="Def Reb opp taken"|Stats=="Off Reb opp taken"|Stats=="Total Reb opp taken"|Stats=="Steals conceed"|Stats=="Blocks Against"|Stats=="2P made opp"|Stats=="2P attempt"|Stats=="2P(%) opp"|Stats=="3P made opp"|Stats=="3P attempt"|Stats=="3P(%) opp"|Stats=="Free throws made opp"|Stats=="Free throws attempt"|Stats=="FT(%) opp"|Stats=="PIR opp"|Stats=="Assists_ratio opp"|Stats=="Possesions opp"|Stats=="EFG opp"|Stats=="FT_ratio opp"|Stats=="Defensive_Rating"|Stats=="True_Shooting opp"|Stats=="As_To_Ratio opp"|Stats=="Assisted_FG opp"~1,
                              Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio"&Stats!="Points conceed"&Stats!="Assists allowed"&Stats!="Def Reb opp taken"&Stats!="Off Reb opp taken"&Stats!="Total Reb opp taken"&Stats!="Steals conceed"&Stats!="Blocks Against"&Stats!="2P made opp"&Stats!="2P attempt"&Stats!="2P(%) opp"&Stats!="3P made opp"&Stats!="3P attempt"&Stats!="3P(%) opp"&Stats!="Free throws made opp"&Stats!="Free throws attempt"&Stats!="FT(%) opp"&Stats!="PIR opp"&Stats!="Assists_ratio opp"&Stats!="Possesions opp"&Stats!="EFG opp"&Stats!="FT_ratio opp"&Stats!="Defensive_Rating"&Stats!="True_Shooting opp"&Stats!="As_To_Ratio opp"&Stats!="Assisted_FG opp" ~2),
         Better=case_when(Team1==Team2~"Identical",
                          First_case==1 & Team1>Team2~"Team2",
                          First_case==1 & Team1<Team2~"Team1",
                          First_case==2 & Team1<Team2~"Team2",
                          First_case==2 & Team1>Team2~"Team1"))%>%
  dplyr::select(-First_case)%>%
  add_column(arr=c(18,
17,
8,
7,
13,
16,
4,
3,
12,
15,
2,
1,
20,
19,
10,
9,
14,
11,
6,
5))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr),
  spacing = "xs")
```

### {data-height=200}
```{r}
renderTable(merge(data.frame(compare_teams(input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[1]),
      data.frame(compare_teams(input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[1])%>%
        dplyr::rename(Team2=Team1),all=TRUE)%>%
  mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"|Stats=="Points conceed"|Stats=="Assists allowed"|Stats=="Def Reb opp taken"|Stats=="Off Reb opp taken"|Stats=="Total Reb opp taken"|Stats=="Steals conceed"|Stats=="Blocks Against"|Stats=="2P made opp"|Stats=="2P attempt"|Stats=="2P(%) opp"|Stats=="3P made opp"|Stats=="3P attempt"|Stats=="3P(%) opp"|Stats=="Free throws made opp"|Stats=="Free throws attempt"|Stats=="FT(%) opp"|Stats=="PIR opp"|Stats=="Assists_ratio opp"|Stats=="Possesions opp"|Stats=="EFG opp"|Stats=="FT_ratio opp"|Stats=="Defensive_Rating"|Stats=="True_Shooting opp"|Stats=="As_To_Ratio opp"|Stats=="Assisted_FG opp"~1,
                              Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio"&Stats!="Points conceed"&Stats!="Assists allowed"&Stats!="Def Reb opp taken"&Stats!="Off Reb opp taken"&Stats!="Total Reb opp taken"&Stats!="Steals conceed"&Stats!="Blocks Against"&Stats!="2P made opp"&Stats!="2P attempt"&Stats!="2P(%) opp"&Stats!="3P made opp"&Stats!="3P attempt"&Stats!="3P(%) opp"&Stats!="Free throws made opp"&Stats!="Free throws attempt"&Stats!="FT(%) opp"&Stats!="PIR opp"&Stats!="Assists_ratio opp"&Stats!="Possesions opp"&Stats!="EFG opp"&Stats!="FT_ratio opp"&Stats!="Defensive_Rating"&Stats!="True_Shooting opp"&Stats!="As_To_Ratio opp"&Stats!="Assisted_FG opp" ~2),
         Better=case_when(Team1==Team2~"Identical",
                          First_case==1 & Team1>Team2~"Team2",
                          First_case==1 & Team1<Team2~"Team1",
                          First_case==2 & Team1<Team2~"Team2",
                          First_case==2 & Team1>Team2~"Team1"))%>%
  dplyr::select(-First_case)%>%group_by(Better)%>%summarise(Better_Team=n()),
  spacing = "xs")
```


## Column {data-width=30}
### {data-height=800}
```{r}
renderTable(merge(data.frame(compare_teams(input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[2]),
      data.frame(compare_teams(input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[2])%>%
        dplyr::rename(Team2=Team1),all=TRUE)%>%
  mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"|Stats=="Points conceed"|Stats=="Assists allowed"|Stats=="Def Reb opp taken"|Stats=="Off Reb opp taken"|Stats=="Total Reb opp taken"|Stats=="Steals conceed"|Stats=="Blocks Against"|Stats=="2P made opp"|Stats=="2P attempt"|Stats=="2P(%) opp"|Stats=="3P made opp"|Stats=="3P attempt"|Stats=="3P(%) opp"|Stats=="Free throws made opp"|Stats=="Free throws attempt"|Stats=="FT(%) opp"|Stats=="PIR opp"|Stats=="Assists_ratio opp"|Stats=="Possesions opp"|Stats=="EFG opp"|Stats=="FT_ratio opp"|Stats=="Defensive_Rating"|Stats=="True_Shooting opp"|Stats=="As_To_Ratio opp"|Stats=="Assisted_FG opp"~1,
                              Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio"&Stats!="Points conceed"&Stats!="Assists allowed"&Stats!="Def Reb opp taken"&Stats!="Off Reb opp taken"&Stats!="Total Reb opp taken"&Stats!="Steals conceed"&Stats!="Blocks Against"&Stats!="2P made opp"&Stats!="2P attempt"&Stats!="2P(%) opp"&Stats!="3P made opp"&Stats!="3P attempt"&Stats!="3P(%) opp"&Stats!="Free throws made opp"&Stats!="Free throws attempt"&Stats!="FT(%) opp"&Stats!="PIR opp"&Stats!="Assists_ratio opp"&Stats!="Possesions opp"&Stats!="EFG opp"&Stats!="FT_ratio opp"&Stats!="Defensive_Rating"&Stats!="True_Shooting opp"&Stats!="As_To_Ratio opp"&Stats!="Assisted_FG opp" ~2),
          Better=case_when(Team1==Team2~"Identical",
                          First_case==1 & Team1>Team2~"Team2",
                          First_case==1 & Team1<Team2~"Team1",
                          First_case==2 & Team1<Team2~"Team2",
                          First_case==2 & Team1>Team2~"Team1"))%>%
  dplyr::select(-First_case)%>%
  add_column(arr=c(23,
20,
24,
21,
22,
19,
17,
14,
18,
15,
16,
13,
4,
3,
11,
8,
12,
9,
10,
7,
6,
5,
2,
1))%>%
  arrange(desc(arr))%>%
  dplyr::select(-arr),
  spacing = "xs")
```
### {data-height=200}
```{r}
renderTable(merge(data.frame(compare_teams(input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[2]),
      data.frame(compare_teams(input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[2])%>%
        dplyr::rename(Team2=Team1),all=TRUE)%>%
  mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"|Stats=="Points conceed"|Stats=="Assists allowed"|Stats=="Def Reb opp taken"|Stats=="Off Reb opp taken"|Stats=="Total Reb opp taken"|Stats=="Steals conceed"|Stats=="Blocks Against"|Stats=="2P made opp"|Stats=="2P attempt"|Stats=="2P(%) opp"|Stats=="3P made opp"|Stats=="3P attempt"|Stats=="3P(%) opp"|Stats=="Free throws made opp"|Stats=="Free throws attempt"|Stats=="FT(%) opp"|Stats=="PIR opp"|Stats=="Assists_ratio opp"|Stats=="Possesions opp"|Stats=="EFG opp"|Stats=="FT_ratio opp"|Stats=="Defensive_Rating"|Stats=="True_Shooting opp"|Stats=="As_To_Ratio opp"|Stats=="Assisted_FG opp"~1,
                              Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio"&Stats!="Points conceed"&Stats!="Assists allowed"&Stats!="Def Reb opp taken"&Stats!="Off Reb opp taken"&Stats!="Total Reb opp taken"&Stats!="Steals conceed"&Stats!="Blocks Against"&Stats!="2P made opp"&Stats!="2P attempt"&Stats!="2P(%) opp"&Stats!="3P made opp"&Stats!="3P attempt"&Stats!="3P(%) opp"&Stats!="Free throws made opp"&Stats!="Free throws attempt"&Stats!="FT(%) opp"&Stats!="PIR opp"&Stats!="Assists_ratio opp"&Stats!="Possesions opp"&Stats!="EFG opp"&Stats!="FT_ratio opp"&Stats!="Defensive_Rating"&Stats!="True_Shooting opp"&Stats!="As_To_Ratio opp"&Stats!="Assisted_FG opp" ~2),
          Better=case_when(Team1==Team2~"Identical",
                          First_case==1 & Team1>Team2~"Team2",
                          First_case==1 & Team1<Team2~"Team1",
                          First_case==2 & Team1<Team2~"Team2",
                          First_case==2 & Team1>Team2~"Team1"))%>%
  dplyr::select(-First_case)%>%group_by(Better)%>%summarise(Better_Team=n()),
  spacing = "xs")
```

## Column {data-width=30}
### {data-height=800}
```{r}
renderTable(merge(data.frame(compare_teams(input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[3]),
      data.frame(compare_teams(input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[3])%>%
        dplyr::rename(Team2=Team1),all=TRUE)%>%
  mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"|Stats=="Points conceed"|Stats=="Assists allowed"|Stats=="Def Reb opp taken"|Stats=="Off Reb opp taken"|Stats=="Total Reb opp taken"|Stats=="Steals conceed"|Stats=="Blocks Against"|Stats=="2P made opp"|Stats=="2P attempt"|Stats=="2P(%) opp"|Stats=="3P made opp"|Stats=="3P attempt"|Stats=="3P(%) opp"|Stats=="Free throws made opp"|Stats=="Free throws attempt"|Stats=="FT(%) opp"|Stats=="PIR opp"|Stats=="Assists_ratio opp"|Stats=="Possesions opp"|Stats=="EFG opp"|Stats=="FT_ratio opp"|Stats=="Defensive_Rating"|Stats=="True_Shooting opp"|Stats=="As_To_Ratio opp"|Stats=="Assisted_FG opp"~1,
                              Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio"&Stats!="Points conceed"&Stats!="Assists allowed"&Stats!="Def Reb opp taken"&Stats!="Off Reb opp taken"&Stats!="Total Reb opp taken"&Stats!="Steals conceed"&Stats!="Blocks Against"&Stats!="2P made opp"&Stats!="2P attempt"&Stats!="2P(%) opp"&Stats!="3P made opp"&Stats!="3P attempt"&Stats!="3P(%) opp"&Stats!="Free throws made opp"&Stats!="Free throws attempt"&Stats!="FT(%) opp"&Stats!="PIR opp"&Stats!="Assists_ratio opp"&Stats!="Possesions opp"&Stats!="EFG opp"&Stats!="FT_ratio opp"&Stats!="Defensive_Rating"&Stats!="True_Shooting opp"&Stats!="As_To_Ratio opp"&Stats!="Assisted_FG opp" ~2),
         Better=case_when(Team1==Team2~"Identical",
                          First_case==1 & Team1>Team2~"Team2",
                          First_case==1 & Team1<Team2~"Team1",
                          First_case==2 & Team1<Team2~"Team2",
                          First_case==2 & Team1>Team2~"Team1"))%>%
  dplyr::select(-First_case),
  spacing = "xs")
```
### {data-height=200}
```{r}
renderTable(merge(data.frame(compare_teams(input$Team1_compare_team,input$season1_compare_team,input$phase1_compare_team,input$home_away1_compare_team,input$results1_compare_team)[3]),
      data.frame(compare_teams(input$Team2_compare_team,input$season2_compare_team,input$phase2_compare_team,input$home_away2_compare_team,input$results2_compare_team)[3])%>%
        dplyr::rename(Team2=Team1),all=TRUE)%>%
  mutate(First_case=case_when(Stats=="Turnovers"|Stats=="Fouls"|Stats=="Turnover_ratio"|Stats=="Points conceed"|Stats=="Assists allowed"|Stats=="Def Reb opp taken"|Stats=="Off Reb opp taken"|Stats=="Total Reb opp taken"|Stats=="Steals conceed"|Stats=="Blocks Against"|Stats=="2P made opp"|Stats=="2P attempt"|Stats=="2P(%) opp"|Stats=="3P made opp"|Stats=="3P attempt"|Stats=="3P(%) opp"|Stats=="Free throws made opp"|Stats=="Free throws attempt"|Stats=="FT(%) opp"|Stats=="PIR opp"|Stats=="Assists_ratio opp"|Stats=="Possesions opp"|Stats=="EFG opp"|Stats=="FT_ratio opp"|Stats=="Defensive_Rating"|Stats=="True_Shooting opp"|Stats=="As_To_Ratio opp"|Stats=="Assisted_FG opp"~1,
                              Stats!="Turnovers"&Stats!="Fouls"&Stats!="Turnover_ratio"&Stats!="Points conceed"&Stats!="Assists allowed"&Stats!="Def Reb opp taken"&Stats!="Off Reb opp taken"&Stats!="Total Reb opp taken"&Stats!="Steals conceed"&Stats!="Blocks Against"&Stats!="2P made opp"&Stats!="2P attempt"&Stats!="2P(%) opp"&Stats!="3P made opp"&Stats!="3P attempt"&Stats!="3P(%) opp"&Stats!="Free throws made opp"&Stats!="Free throws attempt"&Stats!="FT(%) opp"&Stats!="PIR opp"&Stats!="Assists_ratio opp"&Stats!="Possesions opp"&Stats!="EFG opp"&Stats!="FT_ratio opp"&Stats!="Defensive_Rating"&Stats!="True_Shooting opp"&Stats!="As_To_Ratio opp"&Stats!="Assisted_FG opp" ~2),
         Better=case_when(Team1==Team2~"Identical",
                          First_case==1 & Team1>Team2~"Team2",
                          First_case==1 & Team1<Team2~"Team1",
                          First_case==2 & Team1<Team2~"Team2",
                          First_case==2 & Team1>Team2~"Team1"))%>%
  dplyr::select(-First_case)%>%group_by(Better)%>%summarise(Better_Team=n()),
  spacing = "xs")
```

# Search Team {data-navmenu="Team Stats"}
##

```{r}

Teams_search_team=rev(unique(All_Seasons$Team))
selectInput("Teams_search_team",label="Select Team",choices = Teams_search_team)

phase_search_team=rev(c("Regular Season","Play offs","Final Four",""))
selectInput("phase_search_team",label="Phase",choices=phase_search_team)

results_search_team=rev(c("W","L",""))
selectInput("results_search_team",label="Result",choices=results_search_team)

home_away_search_team=rev(c("H","A",""))
selectInput("home_away_search_team",label="Η/Α",choices=home_away_search_team)

season_search_team=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_search_team",label="Select Season",choices = season_search_team,selected = "2023-2024")

```

##
###
```{r}
renderTable(data.frame(Games_summary(All_Seasons_res,input$Teams_search_team,input$season_search_team)[9]))
```

###
```{r}
renderTable(period_points(All_Seasons_res,input$Teams_search_team,input$season_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team),spacing = "xs")
```
##
###

```{r}
renderTable(data.frame(search_team(All_Seasons,input$Teams_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team,input$season_search_team)[1]),spacing="xs")
```
###

```{r}
renderTable(data.frame(search_team(All_Seasons,input$Teams_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team,input$season_search_team)[3]),spacing="xs")
```
###

```{r}
renderTable(data.frame(search_team(All_Seasons,input$Teams_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team,input$season_search_team)[5]),spacing="xs")
```
##
###

```{r}
renderTable(data.frame(search_team(All_Seasons,input$Teams_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team,input$season_search_team)[2]),spacing="xs")
```
###

```{r}
renderTable(data.frame(search_team(All_Seasons,input$Teams_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team,input$season_search_team)[4]),spacing="xs")
```
###

```{r}
renderTable(data.frame(search_team(All_Seasons,input$Teams_search_team,input$phase_search_team,input$home_away_search_team,input$results_search_team,input$season_search_team)[6]),spacing="xs")
```
# Record basic stats  {data-navmenu="Team Stats"}

## Column {data-width=20}
### {data-height=150}
```{r}
season_best_stats_teams=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("season_best_stats_teams",label="Select Season",choices = season_best_stats_teams)

```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,PTS,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(PTS=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,PTS,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(PTS=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,AS,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(AS=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,AS,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(AS=Total)%>%dplyr::select(-idseason),spacing ="xs")
```


## Column {data-width=20}

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F2M,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(F2M=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F2A,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(F2A=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F3M,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(F3M=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F3A,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(F3A=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

## Column {data-width=20}

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F2M,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(F2M=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F2A,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(F2A=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F3M,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(F3M=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,F3A,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(F3A=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

## Column {data-width=20}
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,FTM,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(FTM=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,FTA,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(FTA=Total)%>%dplyr::select(-idseason),spacing ="xs")
```


### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,FTM,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(FTM=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,FTA,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(FTA=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

## Column {data-width=20}

### {data-height=200}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(F2A=sum(F2A,na.rm=T),F2M=sum(F2M,na.rm=T),P2=100*round(F2M/F2A,3))%>%
  arrange(desc(P2))%>%head(5))%>%dplyr::select(Name,P2),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(F2A=sum(F2A,na.rm=T),F2M=sum(F2M,na.rm=T),P2=100*round(F2M/F2A,3))%>%
  arrange(desc(P2))%>%tail(5))%>%dplyr::select(Name,P2),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(F3A=sum(F3A,na.rm=T),F3M=sum(F3M,na.rm=T),P3=100*round(F3M/F3A,3))%>%
  arrange(desc(P3))%>%head(5))%>%dplyr::select(Name,P3),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(F3A=sum(F3A,na.rm=T),F3M=sum(F3M,na.rm=T),P3=100*round(F3M/F3A,3))%>%
  arrange(desc(P3))%>%tail(5))%>%dplyr::select(Name,P3),spacing ="xs")
```


### {data-height=200}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(FTA=sum(FTA,na.rm=T),FTM=sum(FTM,na.rm=T),PFT=100*round(FTM/FTA,3))%>%
  arrange(desc(PFT))%>%tail(5))%>%dplyr::select(Name,PFT),spacing ="xs")
```


## Column {data-width=20}

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,OR,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(OR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,OR,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(OR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,DR,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(DR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,DR,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(DR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,TR,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(TR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,TR,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(TR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

## Column {data-width=20}
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,TO,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(TO=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,TO,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(TO=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,ST,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(ST=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,BLK,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(BLK=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

## Column {data-width=20}

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,PIR,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(PIR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,PIR,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(PIR=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,PF,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(PF=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,PF,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(PF=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

# Record advanced stats {data-navmenu="Team Stats"}
## Column {data-width=20}
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,Possesions,input$season_best_stats_teams)[1])%>%
                         dplyr::rename(POS=Total)%>%dplyr::select(-idseason),spacing ="xs")
```
### {data-height=200}
```{r}
renderTable(data.frame(compute_best_stats_teams(All_Seasons,Possesions,input$season_best_stats_teams)[2])%>%
                         dplyr::rename(POS=Total)%>%dplyr::select(-idseason),spacing ="xs")
```

## Column {data-width=20}
### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(AS=sum(AS,na.rm=T),Possesions=sum(Possesions,na.rm=T),ASR=100*round(AS/Possesions,3))%>%
  arrange(desc(ASR))%>%head(5))%>%dplyr::select(Name,ASR),spacing ="xs")

```


### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(AS=sum(AS,na.rm=T),Possesions=sum(Possesions,na.rm=T),ASR=100*round(AS/Possesions,3))%>%
  arrange(desc(ASR))%>%tail(5))%>%dplyr::select(Name,ASR),spacing ="xs")

```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(AS=sum(AS,na.rm=T),F2M=sum(F2M,na.rm=T),F3M=sum(F3M,na.rm=T),ASFG=round(AS/(F2M+F3M),2))%>%
  arrange(desc(ASFG))%>%head(5))%>%dplyr::select(Name,ASFG),spacing ="xs")

```


### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(AS=sum(AS,na.rm=T),F2M=sum(F2M,na.rm=T),F3M=sum(F3M,na.rm=T),ASFG=round(AS/(F2M+F3M),2))%>%
  arrange(desc(ASFG))%>%tail(5))%>%dplyr::select(Name,ASFG),spacing ="xs")

```

## Column {data-width=20}
### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(AS=sum(AS,na.rm=T),TO=sum(TO,na.rm=T),ASTOR=round(AS/TO,1))%>%
  arrange(desc(ASTOR))%>%head(5))%>%dplyr::select(Name,ASTOR),spacing ="xs")

```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(AS=sum(AS,na.rm=T),TO=sum(TO,na.rm=T),ASTOR=round(AS/TO,1))%>%
  arrange(desc(ASTOR))%>%tail(5))%>%dplyr::select(Name,ASTOR),spacing ="xs")

```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(Possesions=sum(Possesions,na.rm=T),TO=sum(TO,na.rm=T),TOR = round((TO * 100) / Possesions,2))%>%
  arrange(desc(TOR))%>%
    head(5))%>%
    dplyr::select(Name,TOR),
  spacing ="xs")

```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(Possesions=sum(Possesions,na.rm=T),TO=sum(TO,na.rm=T),TOR = round((TO * 100) / Possesions,2))%>%
  arrange(desc(TOR))%>%
    tail(5))%>%
    dplyr::select(Name,TOR),
  spacing ="xs")

```


## Column {data-width=20}

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(F3A=sum(F3A,na.rm=T),F2A=sum(F2A,na.rm=T),F2M=sum(F2M,na.rm=T),F3M=sum(F3M,na.rm=T),EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1))%>%
  arrange(desc(EFG))%>%head(5))%>%
    dplyr::select(Name,EFG),spacing ="xs")

```


### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(F3A=sum(F3A,na.rm=T),F2A=sum(F2A,na.rm=T),F2M=sum(F2M,na.rm=T),F3M=sum(F3M,na.rm=T),EFG = round(100*(F2M + (1.5 * F3M)) / (F3A +F2A),1))%>%
  arrange(desc(EFG))%>%tail(5))%>%
    dplyr::select(Name,EFG),spacing ="xs")

```


### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(FTA=sum(FTA,na.rm=T),F2A=sum(F2A,na.rm=T),F3A=sum(F3A,na.rm=T),FTR =  round(FTA / (F3A +F2A),2))%>%
  arrange(desc(FTR))%>%head(5))%>%
    dplyr::select(Name,FTR),spacing ="xs")

```




### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(FTA=sum(FTA,na.rm=T),F2A=sum(F2A,na.rm=T),F3A=sum(F3A,na.rm=T),FTR =  round(FTA / (F3A +F2A),2))%>%
  arrange(desc(FTR))%>%tail(5))%>%
    dplyr::select(Name,FTR),spacing ="xs")

```


## Column {data-width=20}


### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(PTS=sum(PTS,na.rm=T),F2A=sum(F2A,na.rm=T),F3A=sum(F3A,na.rm=T),FTA=sum(FTA,na.rm=T),TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1))%>%
  arrange(desc(TS))%>%head(5))%>%
    dplyr::select(Name,TS),spacing ="xs")

```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(PTS=sum(PTS,na.rm=T),F2A=sum(F2A,na.rm=T),F3A=sum(F3A,na.rm=T),FTA=sum(FTA,na.rm=T),TS = round(100*PTS / (2 * ((F3A +F2A) + 0.44 * FTA)),1))%>%
  arrange(desc(TS))%>%tail(5))%>%
    dplyr::select(Name,TS),spacing ="xs")

```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(PTS=sum(PTS,na.rm=T),Possesions=sum(Possesions,na.rm=T),OFR=100*round(PTS/Possesions,3))%>%
  arrange(desc(OFR))%>%head(5))%>%dplyr::select(Name,OFR),spacing ="xs")
```

### {data-height=150}
```{r}
renderTable(data.frame(All_Seasons%>%mutate(Name=paste0(Team,"(",Season,") vs ",Against))%>%
  dplyr::filter(grepl(input$season_best_stats_teams,Season))%>%group_by(idseason,Name)%>%
  summarise(PTS=sum(PTS,na.rm=T),Possesions=sum(Possesions,na.rm=T),OFR=100*round(PTS/Possesions,3))%>%
  arrange(desc(OFR))%>%tail(5))%>%dplyr::select(Name,OFR),spacing ="xs")
```
  
# Fantasy Euroleague 

## Column {data-width="5"}

```{r}

Season_Fantasy=rev(c("2019-2020", "2020-2021", "2021-2022", "2022-2023","2023-2024",""))
selectInput("Season_Fantasy",label="Select Season",choices =Season_Fantasy)

```
## Column {data-width="40"}
### 
```{r}
renderDataTable(All_Seasons%>%dplyr::filter(grepl(input$Season_Fantasy,Season))%>%
  group_by(Player)%>%
  dplyr::summarise(Win_Pir=round(mean(PTS,na.rm=T)+mean(AS,na.rm=T)+mean(ST,na.rm=T)+mean(TR,na.rm=T)+mean(RF,na.rm=T)+mean(BLK,na.rm=T),1),
                   Lose_Pir=round(mean(TO,na.rm=T)+mean(PF,na.rm=T)+mean(BLKR,na.rm=T)+mean(BLKR,na.rm=T)-mean(F2M,na.rm=T)+mean(F2A,na.rm=T)-mean(F3M,na.rm=T)+mean(F3A,na.rm=T)-mean(FTM,na.rm=T)+mean(FTA,na.rm=T),1),
                   Diff=Win_Pir-Lose_Pir,
                   PIR=round(mean(PIR,na.rm=T),1)))
```

deployApp()